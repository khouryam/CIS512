!function(modules){function webpackJsonpCallback(data){for(var moduleId,chunkId,chunkIds=data[0],moreModules=data[1],executeModules=data[2],i=0,resolves=[];i<chunkIds.length;i++)chunkId=chunkIds[i],installedChunks[chunkId]&&resolves.push(installedChunks[chunkId][0]),installedChunks[chunkId]=0;for(moduleId in moreModules)Object.prototype.hasOwnProperty.call(moreModules,moduleId)&&(modules[moduleId]=moreModules[moduleId]);for(parentJsonpFunction&&parentJsonpFunction(data);resolves.length;)resolves.shift()();return deferredModules.push.apply(deferredModules,executeModules||[]),checkDeferredModules()}function checkDeferredModules(){for(var result,i=0;i<deferredModules.length;i++){for(var deferredModule=deferredModules[i],fulfilled=!0,j=1;j<deferredModule.length;j++){var depId=deferredModule[j];0!==installedChunks[depId]&&(fulfilled=!1)}fulfilled&&(deferredModules.splice(i--,1),result=__webpack_require__(__webpack_require__.s=deferredModule[0]))}return result}var installedModules={},installedChunks={87:0},deferredModules=[];function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.r=function(exports){Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/javascripts/build/shared/";var jsonpArray=window.socrataFrontendWebpackJsonp=window.socrataFrontendWebpackJsonp||[],oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback,jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;deferredModules.push([1661,0]),checkDeferredModules()}({1620:function(module,exports){"use strict";!function($){$.component.Component.extend("Sort","none",{_initDom:function(){var cObj=this;this._super.apply(this,arguments),$.isBlank(cObj.$dsListSection)&&(cObj.$dsListSection=cObj.$contents.find(".dsListSort"),cObj.$dsListSection.length<1&&(cObj.$dsListSection=$.tag({tagName:"div",class:"dsListSort"}),cObj.$contents.append(cObj.$dsListSection))),$.isBlank(cObj.$dsListDropdown)&&(cObj.$dsListDropdown=cObj.$dsListSection.find("select.dsListSort"),cObj.$dsListDropdown.length<1&&(cObj.$dsListDropdown=$.tag2({_:"select",id:cObj.id+"-dsListSort",name:"dsListSort",className:"dsListSort"}),cObj.$dsListSection.append(cObj.$dsListDropdown)),$.isBlank($.uniform)||cObj.$dsListDropdown.uniform(),cObj.$dsListDropdown.on("change",function(){_.defer(function(){handleChange(cObj)})})),$.isBlank(cObj.$dsListPeriodDropdown)&&(cObj.$dsListPeriodDropdown=cObj.$dsListSection.find("select.sortPeriod"),cObj.$dsListPeriodDropdown.length<1&&(cObj.$dsListPeriodDropdown=$.tag2({_:"select",id:cObj.id+"-dsListSortPeriod",name:"dsListSortPeriod",className:"sortPeriod"}),cObj.$dsListSection.append(cObj.$dsListPeriodDropdown)),$.isBlank($.uniform)||cObj.$dsListPeriodDropdown.uniform(),cObj.$dsListPeriodDropdown.on("change",function(){_.defer(function(){handleChange(cObj)})})),$.isBlank(cObj.$datasetSection)&&(cObj.$datasetSection=this.$contents.find(".datasetSort"),cObj.$datasetSection.length<1&&(cObj.$datasetSection=$.tag({tagName:"div",class:"datasetSort"}),this.$contents.append(cObj.$datasetSection))),$.isBlank(this.$dsDropdown)&&(this.$dsDropdown=cObj.$datasetSection.find("select"),this.$dsDropdown.length<1&&(this.$dsDropdown=$.tag({tagName:"select",id:this.id+"-datasetSort",name:"datasetSort"}),cObj.$datasetSection.append(this.$dsDropdown)),$.isBlank($.uniform)||this.$dsDropdown.uniform(),this.$dsDropdown.on("change",function(){_.defer(function(){handleChange(cObj)})})),$.isBlank(cObj.$sortLinks)&&(cObj.$sortLinks=this.$contents.find(".sortLinks"),cObj.$sortLinks.length<1&&(cObj.$sortLinks=$.tag({tagName:"div",class:["sortLinks","clearfix"]}),this.$contents.append(cObj.$sortLinks))),$.isBlank(cObj.$sortDir)&&(cObj.$sortDir=cObj.$sortLinks.find("a.sortDir"),cObj.$sortDir.length<1&&(cObj.$sortDir=$.tag({tagName:"a",href:"#sortDir",class:"sortDir",contents:{tagName:"span",class:"icon"}}),cObj.$sortLinks.append(cObj.$sortDir)),cObj.$sortDir.on("click",function(e){e.preventDefault(),handleSortDir(cObj)})),$.isBlank(cObj.$sortClear)&&(cObj.$sortClear=cObj.$sortLinks.find("a.sortClear"),cObj.$sortClear.length<1&&(cObj.$sortClear=$.tag({tagName:"a",href:"#sortClear",class:["sortClear","remove"],contents:{tagName:"span",class:"icon"}}),cObj.$sortLinks.append(cObj.$sortClear)),cObj.$sortClear.on("click",function(e){e.preventDefault(),handleSortClear(cObj)}))},_getAssets:function(){return{translations:["controls.browse"]}},_render:function(){if(!this._super.apply(this,arguments))return!1;this._updateDataSource(null,renderUpdate)||renderUpdate.apply(this)},_propWrite:function(properties){this._super.apply(this,arguments),this._updateDataSource(properties,renderUpdate)}});var renderUpdate=function renderUpdate(){var cObj=this;if(cObj._initialized)if(cObj.$dsListSection.addClass("hide"),cObj.$datasetSection.addClass("hide"),cObj.$sortDir.addClass("hide"),cObj.$sortClear.addClass("hide"),cObj.$sortLinks.removeClass("column dataset"),"dataset"==cObj._dataContext.type){var ds=cObj._dataContext.dataset;cObj._curDataset!=ds&&($.isBlank(cObj._curDataset)||cObj._curDataset.unbind(null,null,cObj),cObj._curDataset=ds,cObj._curDataset.bind("query_change",function(){renderUpdate.apply(cObj)}),cObj._curDataset.bind("columns_changed",function(){renderUpdate.apply(cObj)})),cObj.$datasetSection.removeClass("hide"),cObj.$sortLinks.addClass("dataset"),cObj.$dsDropdown.empty();var curSort=_.first(ds.query.orderBys||[])||{expression:{}},foundCur=!1,selVal="",exF=cObj._stringSubstitute(cObj._properties.excludeFilter),incF=cObj._stringSubstitute(cObj._properties.includeFilter);_.each(ds.visibleColumns,function(c){if(_.all(exF,function(v,k){return!_.include($.makeArray(v),$.deepGetStringField(c,k))})&&($.isBlank(cObj._properties.includeFilter)||_.any(incF,function(v,k){return _.include($.makeArray(v),$.deepGetStringField(c,k))}))){var sel=curSort.expression.columnId==c.id;foundCur=foundCur||sel,cObj.$dsDropdown.append($.tag({tagName:"option",value:c.fieldName,selected:sel,contents:$.htmlEscape(c.name)})),sel&&(cObj.$sortDir.removeClass("hide sortAsc sortDesc sortAscLight").addClass("sort"+(curSort.ascending?"Asc":"Desc")).attr("title","Sort "+(curSort.ascending?"Descending":"Ascending")),selVal=c.fieldName)}}),cObj.$dsDropdown.prepend($.tag({tagName:"option",value:"",class:"prompt",selected:!foundCur,contents:"(Unsorted)"})),cObj.$dsDropdown.value(selVal),$.subKeyDefined($,"uniform.update")&&$.uniform.update(cObj.$dsDropdown)}else if("column"==cObj._dataContext.type){var col=cObj._dataContext.column;cObj._curDataset!=col.view&&($.isBlank(cObj._curDataset)||cObj._curDataset.unbind(null,null,cObj),cObj._curDataset=col.view,cObj._curDataset.bind("query_change",function(){renderUpdate.apply(cObj)}),cObj._curDataset.bind("columns_changed",function(){renderUpdate.apply(cObj)})),cObj.$sortLinks.addClass("column"),cObj.$sortDir.removeClass("hide").toggleClass("sortAsc",!0===col.sortAscending).toggleClass("sortDesc",!1===col.sortAscending).toggleClass("sortAscLight",$.isBlank(col.sortAscending)).attr("title","Sort "+$.htmlEscape(col.name)+" "+(!0===col.sortAscending?"descending":"ascending")),cObj.$sortClear.toggleClass("hide",$.isBlank(col.sortAscending)).attr("title","Clear sort for "+$.htmlEscape(col.name))}else"datasetList"==cObj._dataContext.type&&(cObj.$dsListDropdown.children().length<1&&cObj.$dsListDropdown.append($.tag2(_.map(["relevance","most_accessed","alpha","newest","oldest","last_modified","rating","comments"],function(opt){return{_:"option",value:opt,contents:$.t("controls.browse.sorts."+opt)}}))),cObj.$dsListPeriodDropdown.children().length<1&&cObj.$dsListPeriodDropdown.append($.tag2(_.map(["week","month","year"],function(opt){return{_:"option",value:(opt+"ly").toUpperCase(),contents:$.t("controls.browse.sort_periods."+opt)}}))),cObj.$dsListDropdown.value((cObj._dataContext.config.search||{}).sortBy||cObj.$dsListDropdown.children(":first").value()),cObj.$dsListPeriodDropdown.value((cObj._dataContext.config.search||{}).sortPeriod||cObj.$dsListPeriodDropdown.children(":first").value()),cObj.$dsListPeriodDropdown.closest(".uniform").andSelf().toggleClass("hide","most_accessed"!=cObj.$dsListDropdown.value()),cObj.$dsListSection.removeClass("hide"),$.subKeyDefined($,"uniform.update")&&($.uniform.update(cObj.$dsListDropdown),$.uniform.update(cObj.$dsListPeriodDropdown)))},handleChange=function(cObj){if($.subKeyDefined(cObj,"_dataContext.dataset")){var cfn=cObj.$dsDropdown.value();cObj._dataContext.dataset.simpleSort(cfn,!0),cObj.$sortDir.toggleClass("hide",$.isBlank(cfn)).removeClass("sortDesc sortAscLight").addClass("sortAsc")}else if("datasetList"==cObj._dataContext.type){var c=$.extend(!0,{},cObj._dataContext.config);c.search=c.search||{},c.search.sortBy=cObj.$dsListDropdown.value(),"most_accessed"==c.search.sortBy?c.search.sortPeriod=cObj.$dsListPeriodDropdown.value():delete c.search.sortPeriod,cObj._dataContext.updateConfig(c),renderUpdate.apply(cObj)}},handleSortDir=function(cObj){var cfn,ds,isDesc=cObj.$sortDir.hasClass("sortAsc");cObj.$sortDir.removeClass("sortAscLight").toggleClass("sortDesc",isDesc).toggleClass("sortAsc",!isDesc),$.subKeyDefined(cObj,"_dataContext.column")?(cfn=cObj._dataContext.column.fieldName,ds=cObj._dataContext.column.view):$.subKeyDefined(cObj,"_dataContext.dataset")&&(cfn=cObj.$dsDropdown.value(),ds=cObj._dataContext.dataset),$.isBlank(cfn)||ds.simpleSort(cfn,!isDesc)},handleSortClear=function(cObj){if($.subKeyDefined(cObj,"_dataContext.column")){var ds=cObj._dataContext.column.view,md=$.extend(!0,{},ds.metadata),query=md.jsonQuery;query.order=_.reject(query.order||[],function(ob){return ob.columnFieldName==cObj._dataContext.column.fieldName}),0==query.order.length&&delete query.order,ds.update({metadata:md},!1,(query.order||[]).length<2)}}}(jQuery)},1621:function(module,exports){"use strict";!function($){$.component.Component.extend("Search","none",{_initDom:function(){var cObj=this;if(cObj._super.apply(cObj,arguments),$.isBlank(cObj.$input)){if(cObj.$input=cObj.$contents.find(":text"),cObj.$input.length<1){cObj.$contents.children("form").remove();var boxId=cObj.id+"_searchBox";cObj.$contents.append($.tag({tagName:"form",action:"#",class:"searchForm",contents:[{tagName:"div",class:["searchBoxContainer","hasSearchIcon","hasClearButton"],contents:[{tagName:"a",href:"#search",class:"searchIcon"},{tagName:"label",for:boxId,class:"accessible",contents:"Search text"},{tagName:"input",type:"text",id:boxId,class:["searchField","textPrompt"]},{tagName:"a",href:"#clear",class:["clearSearch","close","hide"],contents:{tagName:"span",class:"icon"}}]},{tagName:"input",type:"submit",class:["searchButton","button","hide"]}]})),cObj.$input=cObj.$contents.find(":input:text")}cObj.$searchIcon=cObj.$contents.find(".searchIcon"),cObj.$searchButton=cObj.$contents.find(".searchButton"),cObj.$clearButton=cObj.$contents.find(".clearSearch"),cObj.$contents.find("form").submit(function(e){e.preventDefault(),handleSearch(cObj)}),cObj.$searchIcon.click(function(e){e.preventDefault(),handleSearch(cObj)}),cObj.$clearButton.click(function(e){e.preventDefault(),cObj.$input.focus().val("").blur(),handleSearch(cObj)})}},_render:function(){return!!this._super.apply(this,arguments)&&(this._updateDataSource(null,renderUpdate)||renderUpdate.apply(this),!0)},_propWrite:function(properties){this._super.apply(this,arguments),this._updateDataSource(properties,renderUpdate)}});var renderUpdate=function renderUpdate(){var cObj=this;if("datasetList"==cObj._dataContext.type&&cObj._properties.isList)cObj.$input.focus().val((cObj._dataContext.config.search||{}).q).blur();else{var dsList=cObj._getDatasetListFromContext(cObj._dataContext);_.isEqual(cObj._dsList,dsList)||(_.each(cObj._dsList,function(ds){ds.unbind(null,null,cObj)}),cObj._dsList=dsList,_.each(cObj._dsList,function(ds){ds.bind("clear_temporary",function(){renderUpdate.apply(cObj)},cObj)}));var curVal=_.reduce(cObj._dsList,function(memo,ds){return _.isNull(memo)||ds.searchString==memo?ds.searchString:""},null);cObj.$input.focus().val(curVal).blur()}cObj.$searchIcon.attr("title",cObj._stringSubstitute(cObj._properties.iconPrompt||"Find")),cObj.$input.example(cObj._stringSubstitute(cObj._properties.searchPrompt||"Find")),cObj.$searchButton.val(cObj._stringSubstitute(cObj._properties.buttonText||"Find")),cObj.$clearButton.attr("title",cObj._stringSubstitute(cObj._properties.clearPrompt||"Clear")),cObj.$searchIcon.toggleClass("hide",!!cObj._properties.hideSearchIcon),cObj.$clearButton.toggleClass("hide",cObj.$input.hasClass("prompt")||$.isBlank(cObj.$input.val())||!!cObj._properties.hideClearButton),cObj.$searchButton.toggleClass("hide",!cObj._properties.showSearchButton),cObj.$contents.find(".searchBoxContainer").toggleClass("hasSearchIcon",!cObj._properties.hideSearchIcon).toggleClass("hasClearButton",!cObj._properties.hideClearButton)},handleSearch=function(cObj){var q=cObj.$input.val();if((cObj.$input.hasClass("prompt")||$.isBlank(q))&&(q=""),cObj.$clearButton.toggleClass("hide",$.isBlank(q)||!!cObj._properties.hideClearButton),!$.isBlank(q)&&cObj._properties.startsWith&&(q+="*"),"datasetList"==cObj._dataContext.type&&cObj._properties.isList){var c=$.extend(!0,{},cObj._dataContext.config);c.search=c.search||{},c.search.q=q,cObj._dataContext.updateConfig(c)}else _.each(cObj._dsList,function(ds){ds.update({searchString:q})})}}(jQuery)},1622:function(module,exports){"use strict";!function(){$.component.Component.extend("Pager","none",{_needsOwnContext:!0,_getAssets:function(){return{translations:["core.pagination"]}},isValid:function(){return $.isBlank(this._context)&&!$.isBlank(this._properties.pagedContainerId)&&this._setUpBinding(),!$.isBlank(this._context)},_setUpBinding:function(){var cObj=this,adjId=(cObj._properties.parentPrefix||"")+(cObj._properties.pagedContainerId||"");$.isBlank(adjId)||!$.isBlank(cObj._context)&&cObj._context.id==adjId||($.component.globalNotifier.unbind(null,null,cObj),$.component.globalNotifier.bind("component_added",function(comp){comp.id==adjId&&cObj._render()},cObj),$.component.globalNotifier.bind("component_removed",function(comp){comp.id==adjId&&(setUpComponent(cObj,null),cObj._render())},cObj),setUpComponent(cObj,adjId))},_initDom:function(){var cObj=this;cObj._super(),cObj._eventsBound||(cObj._eventsBound=!0,cObj.$contents.delegate(".navigateLink","click",function(e){e.preventDefault();var $a=$(this);$a.hasClass("disabled")||cObj.isValid()&&cObj._context["view"+$.hashHref($a.attr("href"))](!1===cObj._properties.navigateWrap)}),cObj.$contents.delegate(".navigatePaging .pageLink","click",function(e){e.preventDefault(),cObj.isValid()&&cObj._context.visibleIndex($.hashHref($(this).attr("href")))}),cObj.$contents.delegate(".childLink","click",function(e){e.preventDefault();var $a=$(this);$a.hasClass("active")||cObj.isValid()&&cObj._context.visibleId($.hashHref($a.attr("href")))}),cObj.$contents.delegate("input[type=radio]","change",function(){cObj.isValid()&&cObj._context.visibleId($(this).val())}))},_render:function(){var cObj=this;if(cObj._super(),cObj._setUpBinding(),cObj.$contents.empty(),cObj.isValid()){if("navigate"==cObj._properties.selectorStyle){var firstLastButtonsEnabled=!0===cObj._properties.showFirstLastPageLink,navigateLinksAsButtons=!0===cObj._properties.navigateLinksAsButtons;firstLastButtonsEnabled&&(navigateLinksAsButtons?cObj.$contents.append($.tag({tagName:"a",href:"#First",contents:{tagName:"span",class:["icon"],contents:$.t("core.pagination.first_page")},class:["button","navigateLink","firstLink","start"]})):cObj.$contents.append($.tag({tagName:"a",href:"#First",class:["navigateLink","firstLink"],contents:"&laquo; "+$.t("core.pagination.first_page")}))),navigateLinksAsButtons?cObj.$contents.append($.tag({tagName:"a",href:"#Previous",contents:{tagName:"span",class:["icon"],contents:$.t("core.pagination.previous_page")},class:["button","navigateLink","prevLink","previous"]})):cObj.$contents.append($.tag({tagName:"a",href:"#Previous",class:["navigateLink","prevLink"],contents:"&lt; "+$.t("core.pagination.previous_page")})),"paging"==cObj._properties.navigateStyle?cObj.$contents.append($.tag({tagName:"div",class:"navigatePaging"})):cObj.$contents.append($.tag({tagName:"div",class:"navigateInfo",contents:[{tagName:"span",class:"currentItem"},{tagName:"span",class:"separator",contents:"/"},{tagName:"span",class:"totalCount"}]})),navigateLinksAsButtons?cObj.$contents.append($.tag({tagName:"a",href:"#Next",contents:{tagName:"span",class:["icon"],contents:$.t("core.pagination.next_page")},class:["button","navigateLink","nextLink","next"]})):cObj.$contents.append($.tag({tagName:"a",href:"#Next",class:["navigateLink","nextLink"],contents:$.t("core.pagination.next_page")+" &gt;"})),firstLastButtonsEnabled&&(navigateLinksAsButtons?cObj.$contents.append($.tag({tagName:"a",href:"#Last",contents:{tagName:"span",class:["icon"],contents:$.t("core.pagination.last_page")},class:["button","navigateLink","lastLink","end"]})):cObj.$contents.append($.tag({tagName:"a",href:"#Last",class:["navigateLink","lastLink"],contents:$.t("core.pagination.last_page")+" &raquo;"})))}else if("buttons"==cObj._properties.selectorStyle){var $ul=$.tag({tagName:"ul",class:["clearfix",cObj._properties.buttonStyle||"pillButtons"]});cObj.$contents.append($ul),cObj._context.fetchAll(),cObj._context.eachPage(function(page){var icon=(cObj._properties.associatedIcons||{})[page.id]||page.properties().iconClass,text=(cObj._properties.associatedLabels||{})[page.id]||(cObj._properties.associatedLabels||{})[page.properties().label]||page.properties().label||page.id;$ul.append($.tag({tagName:"li",contents:{tagName:"a",href:"#"+page.id,title:text,class:["childLink",{value:"noText",onlyIf:!0===cObj._properties.hideButtonText},{value:icon,onlyIf:!$.isBlank(icon)}],contents:[{value:{tagName:"span",class:"icon"},onlyIf:!$.isBlank(icon)},{value:text,onlyIf:!0!==cObj._properties.hideButtonText||$.isBlank(icon)}]}}))})}else{var inputName=cObj.id+"_pager",curId=cObj._context.visibleId();cObj._context.fetchAll(),cObj._context.eachPage(function(page){var inputId=inputName+"_"+page.id;cObj.$contents.append($.tag({tagName:"div",class:"radioWrapper",contents:[{tagName:"input",type:"radio",checked:page.id==curId,name:inputName,id:inputId,value:page.id},{tagName:"label",for:inputId,contents:(cObj._properties.associatedLabels||{})[page.id]||(cObj._properties.associatedLabels||{})[page.properties().label]||page.properties().label||page.id}]}))}),cObj.$contents.find("input").uniform()}var vId=cObj._context.visibleId();$.isBlank(vId)||adjustIndex(cObj,vId)}cObj._updateValidity()},_propWrite:function(properties){this._super.apply(this,arguments),_.isEmpty(properties)||this._render()}});var adjustIndex=function(cObj,newChildId){var $statusItem,$navLinks,curIndex=cObj._context.visibleIndex(),pageCount=cObj._context.countPages();if(($navLinks=cObj.$contents.find(".navigateLink")).length>0){var atLowBoundary=!1===cObj._properties.navigateWrap&&0==curIndex,atHighBoundary=!1===cObj._properties.navigateWrap&&curIndex==pageCount-1;$navLinks.filter(".prevLink, .firstLink").toggleClass("disabled",atLowBoundary),$navLinks.filter(".nextLink, .lastLink").toggleClass("disabled",atHighBoundary)}if(($statusItem=cObj.$contents.find(".navigateInfo")).length>0)$statusItem.find(".currentItem").text(curIndex+1),$statusItem.find(".totalCount").text(pageCount);else if(($statusItem=cObj.$contents.find(".navigatePaging")).length>0){$statusItem.empty();var windowLimit=cObj._properties.pagingWindow||4,minI=Math.max(0,curIndex-windowLimit),maxI=Math.min(pageCount-1,curIndex+windowLimit),accessibleText=function(text){return{tagName:"span",class:"accessible",contents:text}},accessiblePageText=accessibleText($.t("core.pagination.page")),accessibleCurrentPageText=accessibleText($.t("core.pagination.current_page"));minI>0&&($statusItem.append($.tag({tagName:"a",href:"#0",class:"pageLink",contents:[accessiblePageText,1]})),minI>1&&$statusItem.append($.tag({tagName:"span",class:"pageFillIn",contents:"&hellip;"})));for(var i=minI;i<=maxI;i++)i==curIndex?$statusItem.append($.tag({tagName:"span",class:"currentPage",contents:[accessibleCurrentPageText,i+1]})):$statusItem.append($.tag({tagName:"a",href:"#"+i,class:"pageLink",contents:[accessiblePageText,i+1]}));maxI<pageCount-1&&(maxI<pageCount-2&&$statusItem.append($.tag({tagName:"span",class:"pageFillIn",contents:"&hellip;"})),$statusItem.append($.tag({tagName:"a",href:"#"+(pageCount-1),class:"pageLink",contents:[accessiblePageText,pageCount]})))}else($statusItem=cObj.$contents.find(".childLink")).length>0?($statusItem.removeClass("active"),$statusItem.filter("[href$="+newChildId+"]").addClass("active")):$.uniform.update(cObj.$contents.find("input[id$=_"+newChildId+"]").click())},setUpComponent=function(cObj,adjId){$.isBlank(cObj._context)||cObj._context.unbind(null,null,cObj),cObj._context=$.component(adjId,cObj._componentSet),cObj._context instanceof $.component.PagedContainer?(cObj._context.$dom.attr("aria-live","polite"),cObj._context.bind("page_shown",function(args){adjustIndex(cObj,args.newPage.id)},cObj),cObj._context.bind("page_added",function(){cObj._render()},cObj),cObj._context.bind("page_removed",function(){cObj._render()},cObj),cObj._context.bind("page_count_changed",function(){cObj._render()},cObj)):delete cObj._context}}(jQuery)},1623:function(module,exports){"use strict";!function($){$.component.Component.extend("Inline filter","input",{_needsOwnContext:!0,_getAssets:function(){return{javascripts:[{assets:"awesomecomplete"},{assets:"columnizer"},{assets:"base-control"},{assets:"shared-editors"},{assets:"unified-filter"}],stylesheets:[{assets:"base-control"},{sheet:"/webfonts/ss-standard.css",hasFonts:!0}],templates:["grid_sidebar","unified_filter"],translations:["controls.filter"]}},configurationSchema:function(){var dsList=this._getDatasetListFromContext(this._dataContext);return{schema:[{fields:[$.cf.contextPicker()]}],view:_.first(dsList)}},_initDom:function(){this._super.apply(this,arguments),this.$dom.attr("aria-live","polite")},_render:function(){return!!this._super.apply(this,arguments)&&(this._updateDataSource(this._properties,renderUpdate)||renderUpdate(),!0)},_propWrite:function(properties){this._super.apply(this,arguments),this._updateDataSource(properties,renderUpdate)},_hidden:function(){this._super.apply(this,arguments),renderUpdate.apply(this)},_shown:function(){this._super.apply(this,arguments),renderUpdate.apply(this)}});var renderUpdate=function(){if(this._isHidden)$.isBlank(this._uf)||this._uf.setView(null);else{var dcList=$.makeArray(this._dataContext);if(!(dcList.length<1)){var opts={},cf=this._stringSubstitute(this._properties.columnFilter),hideBase=!!_.isUndefined(this._properties.hideBase)||this._properties.hideBase,addCondition=function(tableColumnIds){$.isBlank(opts.rootCondition)&&(opts.rootCondition={type:"operator",value:"AND",children:[],metadata:{advanced:!1,hideBase:hideBase,unifiedVersion:2}}),opts.rootCondition.children.push({type:"operator",value:"OR",metadata:$.extend({operator:"EQUALS"},cf,{tableColumnId:tableColumnIds})}),opts.minimalDisplay=!0},firstDC=_.first(dcList);if("column"==firstDC.type)opts.datasets=[],_.each(dcList,function(dc){if("column"==dc.type){opts.datasets.push(dc.column.view);var tableColumnIds={};tableColumnIds[dc.column.view.publicationGroup]=dc.column.tableColumnId,addCondition(tableColumnIds)}});else if(("dataset"==firstDC.type||"datasetList"==firstDC.type)&&(opts.datasets=this._getDatasetListFromContext(dcList),!$.isBlank(cf))){var tcIds={};opts.datasets=_.select(opts.datasets,function(ds){var c=ds.columnForIdentifier(cf.column);return $.isBlank(c)||(tcIds[ds.publicationGroup]=c.tableColumnId),!$.isBlank(c)}),addCondition(tcIds)}opts.datasets.length<1||(opts.view=_.first(opts.datasets),$.isBlank(this._uf)?(this.$contents.empty(),this._uf=this.$contents.pane_unifiedFilter(opts),this._uf.render()):this._uf.setView(opts.view),this._updateValidity())}}}}(jQuery)},1624:function(module,exports){"use strict";$.component.Component.extend("Geolocator","none",{_needsOwnContext:!0,_init:function(){this._super.apply(this,arguments),this.registerEvent({geolocate:["where"]})},_getAssets:function(){return{stylesheets:[{assets:"display-map"},{assets:"render-images-bundle",hasImages:!0}]}},_render:function(){var cObj=this;if(!cObj._super.apply(cObj,arguments))return!1;if($.isBlank(cObj.$geolocator)){var radiusOptions=cObj._properties.radiusOptions||["auto","1mi","2mi","5mi","10mi","20mi","50mi"];cObj.$geolocator=$.tag({tagName:"div",class:"geolocator clearfix",contents:[{tagName:"input",class:"textPrompt",type:"text"},{tagName:"select",contents:_.map(radiusOptions,function(text){return{tagName:"option",contents:text}})},{tagName:"a",class:"button",contents:"Go"},{tagName:"a",class:"my_location",title:"Use current location"},{tagName:"div",class:"error"}]}),cObj.$geolocator.find("select").uniform(),cObj.$contents.append(cObj.$geolocator)}return cObj._eventsBound||(cObj._eventsBound=!0,cObj.$contents.find("input.textPrompt").example("Enter address here"),cObj.$contents.delegate("input.textPrompt","keypress",function(e){13==e.which&&doZoom(cObj,$(this).val())}),cObj.$contents.delegate("a.button","click",function(){doZoom(cObj,cObj.$contents.find("input.textPrompt").val())}),cObj.$contents.delegate("a.my_location","click",function(){doZoom(cObj)})),!0}});var doZoom=function(cObj,value){var where={radius:cObj.$contents.find("select option:selected").text()};if(value)if(value.match(/[+-]?\d+\.?\d*,[+-]?\d+\.?\d*/)){var coords=value.split(",");where.latlng={lat:coords[0],lon:coords[1]}}else where.address=value;cObj._properties.restrictedBounds&&$.extend(where,{bounds:cObj._properties.restrictedBounds}),cObj.trigger("geolocate",[{where:where}])}},1625:function(module,exports){"use strict";!function($){$.component.Component.extend("DatasetListFilter","none",{_needsOwnContext:!0,_initDom:function(){var cObj=this;if(this._super.apply(this,arguments),$.isBlank(cObj.$title)&&(cObj.$title=cObj.$contents.find(".title"),cObj.$title.length<1&&(cObj.$title=$.tag2({_:"div",className:"title"}),cObj.$contents.append(cObj.$title))),$.isBlank(cObj.$listSection)&&(cObj.$listSection=cObj.$contents.find(".listSection"),cObj.$listSection.length<1&&(cObj.$listSection=$.tag2({_:"ul",className:"listSection"}),cObj.$contents.append(cObj.$listSection)),cObj._existingData=cObj.$listSection.data("jsdata")||{},cObj.$listSection.on("click","a",function(e){filterClick(cObj,e)})),$.isBlank(cObj.$dialog)){var dialogId="browseDialog_"+cObj.id;cObj.$dialog=$.tag2({_:"div",id:dialogId,className:["socrataDialog","listFilterDialog"],contents:[{_:"a",href:"#close",className:["jqmClose","cornerClose"],contents:"Close"},{_:"div",className:"optionsContent"}]}),$("#newModals").append(cObj.$dialog),$(window).on("click","#"+dialogId+" .optionsContent a",function(e){filterClick(cObj,e),$.popModal()})}},_getAssets:function(){return{javascripts:[{assets:"tagcloud"}],translations:["controls.browse"]}},_assetsAvailable:function(){this._super.apply(this,arguments),this._rendered&&interactiveSetup.apply(this)},_render:function(){var isServerRendered=this.$dom.hasClass("serverRendered");if(!this._super.apply(this,arguments))return isServerRendered&&(this._updateDataSource(null,interactiveSetup)||interactiveSetup.apply(this)),!1;this._updateDataSource(null,renderUpdate)||renderUpdate.apply(this)},_propWrite:function(properties){this._super.apply(this,arguments),this._updateDataSource(properties,renderUpdate)}});var catConfig,listOptions={viewTypes:{translation:"controls.browse.facets.view_types_title",catalogKey:"view_type",useIcons:!0,items:function(callback,cObj){var i=[{translation:"controls.browse.facets.view_types.datasets",value:"datasets",className:"typeBlist"},{translation:"controls.browse.facets.view_types.charts",value:"charts",className:"typeChart"},{translation:"controls.browse.facets.view_types.maps",value:"maps",className:"typeMap"},{translation:"controls.browse.facets.view_types.calendars",value:"calendars",className:"typeCalendar"},{translation:"controls.browse.facets.view_types.filters",value:"filters",className:"typeFilter"},{translation:"controls.browse.facets.view_types.href",value:"href",className:"typeHref"},{translation:"controls.browse.facets.view_types.blob",value:"blob",className:"typeBlob"},{translation:"controls.browse.facets.view_types.forms",value:"forms",className:"typeForm"}],apiItem={translation:"controls.browse.facets.view_types.apis",value:"apis",className:"typeApi"};$.subKeyDefined(cObj,"_existingData.hasApi")?(cObj._existingData.hasApi&&i.push(apiItem),callback(i)):$.socrataServer.makeRequest({type:"GET",url:"/browse/domain_info.json",pageCache:!0,success:function(d){d.hasApi&&i.push(apiItem),callback(i)}})},updateFilter:function(obj,value){switch(delete obj.publication_stage,delete obj.datasetView,value){case"unpublished":obj.limitTo="tables",obj.datasetView="dataset",obj.publication_stage="unpublished";break;case"datasets":obj.limitTo="tables",obj.datasetView="dataset";break;case"filters":obj.limitTo="tables",obj.datasetView="view";break;default:obj.limitTo=value}},clearFilter:function(obj){delete obj.publication_stage,delete obj.datasetView,delete obj.limitTo},currentValue:function(obj){return"unpublished"==obj.publication_stage?"unpublished":"dataset"==obj.datasetView?"datasets":"view"==obj.datasetView?"filters":obj.limitTo}},categories:{translation:"controls.browse.facets.categories_title",catalogKey:"category",useCutoff:!0,items:function(callback,cObj){$.subKeyDefined(cObj,"_existingData.categories")?callback(cObj._existingData.categories):Configuration.findByType("view_categories",null,function(cats){var topLevel={};_.each(cats.properties,function(obj,cat){if(obj.enabled){cat=cat.displayable();var text=(obj.locale_strings||{})[blist.locale];if($.isBlank(text)&&(text=cat),$.isBlank(obj.parent))topLevel[cat]=topLevel[cat]||{},topLevel[cat].value=cat,topLevel[cat].text=text;else{var p=obj.parent.displayable();topLevel[p]=topLevel[p]||{},topLevel[p].children=topLevel[p].children||[],topLevel[p].children.push({value:cat,text:text})}}}),callback(_.sortBy(_.reject(topLevel,function(cat){return _.isNull(cat.value)}),"value"))})},updateFilter:function(obj,value){obj.category=value},clearFilter:function(obj){delete obj.category},currentValue:function(obj){return(obj.category||"").displayable()}},topics:{translation:"controls.browse.facets.topics_title",catalogKey:"topic",useCutoff:!0,useModal:!0,items:function(callback,cObj){$.subKeyDefined(cObj,"_existingData.tags")?callback(cObj._existingData.tags):$.socrataServer.makeRequest({type:"GET",url:"/api/tags.json?method=viewsTags",success:function(tags){callback(_.map(tags,function(t){return{text:t.name,value:t.name,count:t.frequency}}))}})},updateFilter:function(obj,value){obj.tags=value},clearFilter:function(obj){delete obj.tags},currentValue:function(obj){return obj.tags}},federatedDomains:{translation:"controls.browse.facets.federated_domains_title",catalogKey:"federation",useCutoff:!0,items:function(callback,cObj){var rawFeds,fedDomains,domain,processResults=_.after(2,function(){$.isBlank(fedDomains)&&(fedDomains=_.map(_.sortBy(_.select(rawFeds,function(f){return $.isBlank(f.lensName)&&!$.isBlank(f.acceptedUserId)&&f.targetDomainCName==domain.cname}),"sourceDomainCName"),function(f){return{text:f.sourceDomainCName,value:f.sourceDomainId,icon:"/api/domains/"+f.sourceDomainCName+"/icons/smallIcon"}})),callback([{text:"This site only",value:domain.id,icon:"/api/domains/"+domain.cname+"/icons/smallIcon"}].concat(fedDomains))});$.subKeyDefined(cObj,"_existingData.federatedDomains")?(fedDomains=cObj._existingData.federatedDomains,processResults()):$.socrataServer.makeRequest({type:"GET",url:"/api/federations.json",success:function(result){rawFeds=result,processResults()}}),$.subKeyDefined(cObj,"_existingData.currentDomain")?(domain=cObj._existingData.currentDomain,processResults()):$.socrataServer.makeRequest({type:"GET",url:"/browse/domain_info.json",pageCache:!0,success:function(result){domain=result,processResults()}})},updateFilter:function(obj,value){obj.federation_filter=value},clearFilter:function(obj){delete obj.federation_filter},currentValue:function(obj){return obj.federation_filter}}},renderUpdate=function renderUpdate(){var cObj=this;if(cObj._initialized){var newFacet=listOptions[cObj._stringSubstitute(cObj._properties.facet)];if(cObj._facet!=newFacet){if(!$.isBlank(cObj._facet)&&"datasetList"==cObj._dataContext.type){var c=$.extend(!0,{},cObj._dataContext.config);c.search=c.search||{},cObj._facet.clearFilter(c),cObj._dataContext.updateConfig(c),renderUpdate.apply(cObj)}if(cObj.$listSection.empty(),cObj._facet=newFacet,cObj.$title.toggleClass("hide",$.isBlank(cObj._facet)),cObj.$listSection.toggleClass("hide",$.isBlank(cObj._facet)),$.isBlank(cObj._facet))return;cObj.$title.text($.isBlank(cObj._facet.translation)?cObj._facet.title:$.t(cObj._facet.translation)),cObj.$listSection.append($.tag2({_:"li",contents:{_:"a",href:"#clear",className:"clearFacet",contents:$.t("controls.browse.actions.clear_facet")}}));var renderItems=function(items){cObj.finishLoading(),_.each(items,function(item){cObj.$listSection.append($.tag2(function itemHash(item){return{_:"li",contents:[{_:"a",href:"#"+item.value,className:item.className,"data-value":item.value,rel:item.count,contents:[{i:cObj._facet.useIcons,t:{_:"span",className:"icon"}},{i:!$.isBlank(item.icon),t:{_:"img",className:"customIcon",alt:"icon",src:item.icon}},$.isBlank(item.translation)?item.text:$.t(item.translation)]},{i:!$.isBlank(item.children),t:{_:"ul",className:"childList",contents:_.map(item.children,function(child){return itemHash(child)})}}]}}(item)))}),cObj._facet.useCutoff&&($.isBlank(catConfig)?Configuration.findByType("catalog",null,function(config){catConfig=config,setUpCutoff(cObj)}):setUpCutoff(cObj)),updateState(cObj)};cObj.startLoading(),_.isFunction(cObj._facet.items)?cObj._facet.items(renderItems,cObj):renderItems(cObj._facet.items)}updateState(cObj)}},interactiveSetup=function(){var cObj=this;cObj._loadingAssets||($.subKeyDefined(cObj,"_existingData.catalogConfig")&&(catConfig=new Configuration(cObj._existingData.catalogConfig)),cObj._facet=listOptions[cObj._stringSubstitute(cObj._properties.facet)],cObj._facet.useCutoff&&($.isBlank(catConfig)?Configuration.findByType("catalog",null,function(c){catConfig=c,setUpCutoff(cObj)}):setUpCutoff(cObj)),updateState(cObj))},setUpCutoff=function(cObj){var cutoff=$.deepGet(catConfig,"properties","facet_cutoffs",cObj._facet.catalogKey)||5;if(cObj.$listSection.children("li").slice(cutoff+1).addClass("cutoff"),cObj._facet.useModal){var links=cObj.$listSection.find("a:not(.clearFacet)").clone().toArray();links=_.sortBy(links,function(item){return $(item).text()}),cObj.$dialog.find(".optionsContent").empty().append(links)}cObj.$listSection.append($.tag2({_:"li",className:["viewAll",{i:cObj._facet.useModal,t:"viewCloud"}],contents:{_:"a",className:["viewAllLink",{i:cObj._facet.useModal,t:"cloudLink"},"ss-dropdown"],href:"#viewAll",contents:$.t("controls.browse.actions.all_options")}})),cObj.$listSection.append($.tag2({_:"li",className:"viewLess",contents:{_:"a",className:["viewLessLink","ss-directup"],href:"#viewLess",contents:$.t("controls.browse.actions.less_options")}}))},updateState=function(cObj){if(!$.isBlank(cObj._facet)&&(cObj.$listSection.find(".active").removeClass("active").parents("li").removeClass("activeItem"),$.subKeyDefined(cObj,"_dataContext.config"))){var cv=cObj._facet.currentValue(cObj._dataContext.config.search||{});$.isBlank(cv)?cObj.$listSection.find(".clearFacet").addClass("hide"):(cObj.$listSection.find('a[data-value="'+cv+'"]').addClass("active").parents("li").addClass("activeItem"),cObj.$listSection.find(".clearFacet").removeClass("hide"))}},filterClick=function(cObj,e){e.preventDefault();var $a=$(e.currentTarget);if(!$a.hasClass("active")){if($a.hasClass("cloudLink"))return cObj.$dialog.find(".optionsContent a").tagcloud({size:{start:1.2,end:2.8,unit:"em"}}),cObj.$dialog.showModal(),void _.defer(function(){cObj.$dialog.find(".optionsContent a:first").focus()});if($a.hasClass("viewAllLink"))cObj.$listSection.addClass("expanded");else if($a.hasClass("viewLessLink"))cObj.$listSection.removeClass("expanded");else if("datasetList"==cObj._dataContext.type&&!$.isBlank(cObj._facet)){var c=$.extend(!0,{},cObj._dataContext.config);c.search=c.search||{};var v=$a.data("value");$.isBlank(v)?cObj._facet.clearFilter(c.search):cObj._facet.updateFilter(c.search,v),cObj._dataContext.updateConfig(c),updateState(cObj)}}}}(jQuery)},1626:function(module,exports){"use strict";!function($){var t=function(str,props){return $.t("dataslate.component.share."+str,props)};$.component.Component.extend("Share","actions",{_needsOwnContext:!0,_initDom:function(){if(this._super.apply(this,arguments),$.isBlank(this.$shareOpts)){this.$shareOpts=this.$contents.children("ul"),this.$shareOpts.length<1&&(this.$shareOpts=$.tag({tagName:"ul",class:"hide",contents:[{tagName:"li",class:"subscribe","data-name":"subscribe",contents:[{tagName:"a",class:"subscribe",href:"#subscribe",title:t("subscribe"),contents:[{tagName:"span",class:"icon",contents:t("subscribe_text")}]}]},{tagName:"li",class:"facebook","data-name":"facebook",contents:[{tagName:"a",class:"facebook",rel:"external",title:t("facebook"),contents:[{tagName:"span",class:"icon",contents:t("facebook")}]}]},{tagName:"li",class:"twitter","data-name":"twitter",contents:[{tagName:"a",class:"twitter",rel:"external",title:t("twitter"),contents:[{tagName:"span",class:"icon",contents:t("twitter")}]}]},{tagName:"li",class:"email","data-name":"email",contents:[{tagName:"a",class:"email",href:"#email",title:t("email"),contents:[{tagName:"span",class:"icon",contents:t("email")}]}]}]}),this.$contents.append(this.$shareOpts));var cObj=this;cObj.$shareOpts.find("li[data-name=email] a").click(function(e){cObj._properties.currentPage||(e.preventDefault(),$.subKeyDefined(cObj,"_dataContext.dataset")&&_.isFunction(blist.dialog.sharing)&&blist.dialog.sharing(null,null,cObj._dataContext.dataset))}),cObj.$shareOpts.find("li[data-name=subscribe] a").click(function(e){e.preventDefault(),$.subKeyDefined(cObj,"_dataContext.dataset")&&_.isFunction(blist.dialog.subscribe)&&blist.dialog.subscribe(cObj._dataContext.dataset)})}},_getAssets:function(){return{javascripts:[{assets:"awesomecomplete"},{assets:"share-dialogs"}],stylesheets:[{assets:"share"}],modals:["email_dataset","subscribe_dataset"],translations:["dataslate.component.share"]}},configurationSchema:function(){return blist.configuration.govStat?null:{schema:[{name:"shareComponent_type",fields:[{type:"radioGroup",defaultValue:"currentPage",name:"shareType",text:t("share"),options:[{name:"currentPage",type:"static",value:t("this_page"),isInput:!0},$.cf.contextPicker()]}]}],view:this._dataset}},edit:function(){return!!this._super.apply(this,arguments)&&($.isBlank(this._properties.contextId)&&$.isBlank(this._properties.currentPage)&&this._executePropertyUpdate({currentPage:!0}),!0)},_render:function(){if(!this._super.apply(this,arguments))return!1;this._updateDataSource(null,renderUpdate)||renderUpdate.apply(this)},_propWrite:function(properties){_.isBoolean(properties.currentPage)||$.isBlank(properties.currentPage)||(properties.currentPage=!0),this._super.apply(this,arguments),this._updateDataSource(properties,renderUpdate)||renderUpdate.apply(this)}});var renderUpdate=function(){var facebookUrl,twitterUrl,cObj=this;if(!$.isBlank(cObj.$shareOpts))if(cObj._properties.currentPage||$.subKeyDefined(cObj,"_dataContext.dataset")){if(cObj.$shareOpts.removeClass("hide"),$.subKeyDefined(cObj._properties,"visibleItems")){var visItems=$.makeArray(cObj._properties.visibleItems);cObj.$shareOpts.children("li").addClass("hide"),_.each(visItems,function(name){cObj.$shareOpts.append(cObj.$shareOpts.find("li[data-name="+name+"]").removeClass("hide"))})}else{var hiddenItems=$.makeArray(cObj._properties.hiddenItems);cObj.$shareOpts.children("li").quickEach(function(){this.toggleClass("hide",_.include(hiddenItems,this.attr("data-name")))})}if(cObj._properties.currentPage){var pageUrl=window.location,pageName=$.stringSubstitute(blist.configuration.page.name,$.component.rootPropertyResolver),emailUrl="mailto:?subject="+escape(t("email_contents",{dataset:pageName,company:blist.configuration.strings.company}))+"&body="+escape(pageUrl);facebookUrl="https://www.facebook.com/dialog/feed?app_id=303443389788866&link="+escape(pageUrl)+"&name="+escape(pageName),twitterUrl="http://twitter.com/?status="+escape(t("tweet_contents",{dataset:pageName,company:blist.configuration.strings.company,url:pageUrl})),cObj.$shareOpts.find("li[data-name=facebook] a").attr("href",facebookUrl),cObj.$shareOpts.find("li[data-name=twitter] a").attr("href",twitterUrl),cObj.$shareOpts.find("li[data-name=subscribe]").addClass("hide"),cObj.$shareOpts.find("li[data-name=email]").find("a").attr("href",emailUrl)}else{var ds=cObj._dataContext.dataset;facebookUrl="http://www.facebook.com/share.php?u="+escape(ds.fullUrl),twitterUrl="http://twitter.com/?status="+escape(t("tweet_contents",{dataset:ds.name,company:blist.configuration.strings.company,url:ds.shortUrl})),cObj.$shareOpts.find("li[data-name=facebook] a").attr("href",facebookUrl),cObj.$shareOpts.find("li[data-name=twitter] a").attr("href",twitterUrl),cObj.$shareOpts.find("li[data-name=email]").find("a").attr("href","#email"),cObj.$shareOpts.find("li[data-name=subscribe], li[data-name=email]").find("a").toggleClass("hide",!ds.isPublic()||!ds.isTabular())}}else cObj.$shareOpts.addClass("hide")}}(jQuery)},1627:function(module,exports){"use strict";!function($){$.component.Component.extend("Select","actions",{_init:function(){this._super.apply(this,arguments),this.registerEvent({change:["selected","dataContext"]})},_initDom:function(){var cObj=this;cObj._super.apply(cObj,arguments),$.isBlank(cObj.$select)&&(cObj.$select=cObj.$contents.children("select"),cObj.$select.length<1&&(cObj.$select=$.tag({tagName:"select"}),cObj.$contents.append(cObj.$select)),$.isPresent($.uniform)&&cObj.$select.uniform(),cObj.$select.off(".compSelect"),cObj.$select.on("change.compSelect",function(){var selectedOption=cObj.$select.find("option:selected");cObj.trigger("change",[{dataContext:cObj._dataContext,selected:{index:selectedOption.index(),value:selectedOption.val(),label:selectedOption.text()}}])}))},_render:function(){var cObj=this;if(!cObj._super.apply(cObj,arguments))return!1;cObj._updateDataSource(cObj._properties,function(){doRender(cObj)})||doRender(cObj)},_propWrite:function(properties){this._super.apply(this,arguments),_.isEmpty(properties)||this._render()},_bindQueryChangeListener:function(){var cObj=this;if(cObj._dataContext&&"dataset"==cObj._dataContext.type){var dataset=cObj._dataContext.dataset;cObj._currentDataset!=dataset&&($.isPresent(cObj._currentDataset)&&cObj._currentDataset.unbind(null,null,cObj),dataset.bind("query_change",function(){doRender(cObj)},cObj),cObj._currentDataset=dataset)}},_dataReady:function(){},_addDataContext:function(){this._super.apply(this,arguments),this._bindQueryChangeListener(),this.$select.trigger("change.compSelect")}});var doRender=function(cObj){cObj.$select.empty();var postRender=function(){$.isPresent($.uniform)&&$.uniform.update(cObj.$select),cObj.$select.attr("disabled",cObj._properties.disabled)},setCurrentSelection=function(optionTag,value,index){value==cObj._stringSubstitute(cObj._properties.currentValue)&&optionTag.attr("selected",!0),index==cObj._stringSubstitute(cObj._properties.currentIndex)&&optionTag.attr("selected",!0)},setPlaceholderValue=function(){var placeholderValue=cObj._properties.placeholderValue;placeholderValue&&cObj.$select.prepend($.tag({tagName:"option",value:cObj._stringSubstitute(placeholderValue.value),contents:cObj._stringSubstitute(placeholderValue.label)}))},options=$.makeArray(cObj._stringSubstitute(cObj._properties.options||[]));if(_.isEmpty(options)&&$.isPresent(cObj._properties.rowFields)&&$.subKeyDefined(cObj,"_dataContext.dataset")){var view=cObj._dataContext.dataset,rowValueField=cObj._stringSubstitute(cObj._properties.rowFields.value),rowLabelField=cObj._stringSubstitute(cObj._properties.rowFields.label),start=cObj._stringSubstitute(cObj._properties.rowStart||0),length=cObj._stringSubstitute(cObj._properties.rowLength||10);view.getRows(start,length,function(rows){setPlaceholderValue(),_.each(rows,function(row,index){var soda2Row=view.rowToSODA2(row),optionTag=$.tag({tagName:"option",value:soda2Row[rowValueField],contents:soda2Row[rowLabelField||rowValueField]});setCurrentSelection(optionTag,soda2Row[rowValueField],index),cObj.$select.append(optionTag)}),postRender()})}else setPlaceholderValue(),_.each(options,function(option,index){var optionTag=$.tag({tagName:"option",value:option.value,contents:option.label});setCurrentSelection(optionTag,option.value,index),cObj.$select.append(optionTag)}),postRender()}}(jQuery)},1628:function(module,exports){"use strict";!function($){$.component.Component.extend("Print","actions",{_initDom:function(){this._super.apply(this,arguments),$.isBlank(this.$link)&&(this.$link=this.$contents.children("a"),this.$link.length<1&&(this.$link=$.tag({tagName:"a",href:"#print"}),this.$contents.append(this.$link)),this.$link.off(".printButton"),this.$link.on("click.printButton",function(e){e.preventDefault(),$.waypoints("trigger");setTimeout(function checkPrint(){if($.component.isLoading())setTimeout(checkPrint,3e3);else{var $wrapper=$(".siteOuterWrapper"),doPrint=function doPrint(){$.component.isLoading()?setTimeout(doPrint,1e3):(window.print(),$wrapper.width(""),$(window).resize())};$.browser.webkit||$.browser.mozilla?($wrapper.width("24cm"),$(window).resize(),setTimeout(doPrint,500)):doPrint()}},500)}))},_getAssets:function(){return{translations:["dataslate.component.print"]}},_render:function(){if(!this._super.apply(this,arguments))return!1;doRender(this)}});var doRender=function(cObj){cObj.$link.text(cObj._stringSubstitute(cObj._properties.text||$.t("dataslate.component.print.print"))),cObj.$link.attr("title",cObj._stringSubstitute(cObj._properties.title||$.t("dataslate.component.print.print_this_page"))),cObj.$link.toggleClass("button",!cObj._properties.notButton)}}(jQuery)},1629:function(module,exports){"use strict";$.component.Component.extend("Download","actions",{_getAssets:function(){return{javascripts:[{assets:"download-inline"}]}},_initDom:function(){this._super.apply(this,arguments),$.isBlank(this.$link)&&(this.$link=this.$contents.children("a.button"),this.$link.length<1&&(this.$link=$.tag({tagName:"a",class:"button",rel:"external"}),this.$contents.append(this.$link)))},_render:function(){var cObj=this;if(!cObj._super.apply(cObj,arguments))return!1;cObj._updateDataSource(cObj._properties,function(){if(!$.isBlank(cObj._dataContext)&&!$.isBlank(cObj._dataContext.dataset)){var ds=cObj._dataContext.dataset;cObj.$link.text(cObj._stringSubstitute(cObj._properties.text)||"Download this data"),cObj.$link.attr("href",ds.downloadUrl("csv")),GeoHelpers.isGeoDataset(ds)||cObj._properties.disableInlineDownload||cObj.$link.downloadToFormCatcher(ds)}})},_propWrite:function(properties){this._super.apply(this,arguments),_.isEmpty(properties)||this._render()}})},1630:function(module,exports){"use strict";!function($){$.component.Component.extend("Button","actions",{_init:function(){this._super.apply(this,arguments),this.registerEvent({click:["state","dataContext"]})},_initDom:function(){var cObj=this;cObj._super.apply(cObj,arguments),$.isBlank(cObj.$link)&&(cObj.$link=cObj.$contents.children("a"),cObj.$link.length<1&&(cObj.$link=$.tag({tagName:"a"}),cObj.$contents.append(cObj.$link)),cObj.$link.off(".compButton"),cObj.$link.on("click.compButton",function(e){cObj.$link.attr("href").indexOf("#")>-1&&e.preventDefault(),toggleState(cObj),cObj.trigger("click",[{dataContext:cObj._dataContext,state:cObj._state}])}),cObj._updateDataSource(cObj._properties,function(){setUpStates(cObj)})||setUpStates(cObj))},_render:function(){var cObj=this;if(!cObj._super.apply(cObj,arguments))return!1;cObj._updateDataSource(cObj._properties,function(){doRender(cObj)})||doRender(cObj)},_propWrite:function(properties){this._super.apply(this,arguments),_.isEmpty(properties)||this._render()}});var setUpStates=function(cObj){cObj._availStates=$.makeArray(cObj._stringSubstitute(cObj._properties.states||"state0")),_.include(cObj._availStates,cObj._state)||($.isBlank(cObj._state)||$.isBlank(cObj.$link)||cObj.$link.removeClass(cObj._state),cObj._state=_.first(cObj._availStates),$.isBlank(cObj.$link)||cObj.$link.addClass(cObj._state))},doRender=function(cObj){setUpStates(cObj),cObj.$link.text(cObj._stringSubstitute(getItem(cObj,"text"))),cObj.$link.attr("title",cObj._stringSubstitute(getItem(cObj,"title"))),cObj.$link.attr("href",cObj._stringSubstitute(getItem(cObj,"href"))||"#"),cObj.$link.attr("rel",cObj._properties.external?"external":""),cObj.$link.toggleClass("button",!cObj._properties.notButton)},getItem=function(cObj,key){var item=cObj._properties[key];return $.isPlainObject(item)&&(item=item[cObj._state]),item},toggleState=function(cObj){$.isBlank(cObj._state)||cObj.$link.removeClass(cObj._state),cObj._state=cObj._availStates[(_.indexOf(cObj._availStates,cObj._state)+1)%cObj._availStates.length],cObj.$link.addClass(cObj._state),cObj.$link.html(cObj._stringSubstitute(getItem(cObj,"text"))),cObj.$link.attr("title",cObj._stringSubstitute(getItem(cObj,"title"))),cObj.$link.attr("href",cObj._stringSubstitute(getItem(cObj,"href"))||"#")}}(jQuery)},1631:function(module,exports){"use strict";!function(){$.component.Component.extend("Visualization","data",{_init:function(){this._needsOwnContext=!0,this._delayUntilVisible=!0,this._noTransactionForUndo=!0,this._super.apply(this,arguments)},isValid:function(){return this._dataContext},configurationSchema:function(){return{schema:[{fields:[$.cf.contextPicker()]},{fields:[{name:"exploreLink",text:$.t("dataslate.component.visualization.exploreLink_prompt"),type:"checkbox"}]}],view:this._dataset}},_getAssets:function(){return{javascripts:[{assets:"shared-visualization"}],translations:["dataslate.component.visualization"]}},_render:function(){return _.isNumber(this._properties.height)||(this._properties.height=300),!!this._super.apply(this,arguments)&&(updateProperties(this,this._properties),!0)},_propWrite:function(properties){this._super.apply(this,arguments),this._rendered&&updateProperties(this,properties)},design:function(){this._super.apply(this,arguments),$.isBlank(this.$editOverlay)&&(this.$editOverlay=$.tag2({_:"div",className:"editOverlay"}),this.$dom.append(this.$editOverlay)),this.$editOverlay.toggleClass("hide",!this._designing)}});var updateProperties=function(lcObj){var renderViz=function(){if(lcObj.$contents.data("renderTypeManager")){var rtm=lcObj.$contents.data("renderTypeManager");rtm.hide(_.keys(rtm.settings.defaultTypes)[0]),lcObj.$contents.removeData("renderTypeManager"),lcObj.$contents.empty()}var ds=(lcObj._dataContext||{}).dataset;if(!$.isBlank(ds)){var visibleTypes=_.keys(ds.metadata.renderTypeConfig.visible),defaultTypes={},type=_.detect(visibleTypes,function(vt){return"table"!=vt});defaultTypes[type=type||"table"]=!0,lcObj._$container||lcObj.$contents.prepend(lcObj._$container=$("<div />")),lcObj._properties.exploreLink?(lcObj._$exploreLink?lcObj._$exploreLink.show().find("a").attr("href",ds.url):lcObj.$contents.append(lcObj._$exploreLink=$.tag2({_:"div",className:"exploreLink",contents:[{_:"a",className:"ss-navigateright",href:ds.url,contents:_.isString(lcObj._properties.exploreLink)?lcObj._properties.exploreLink:$.t("dataslate.component.visualization.exploreLink")}]})),lcObj._$container.height(lcObj._properties.height-lcObj._$exploreLink.outerHeight())):lcObj._$exploreLink?lcObj._$exploreLink.hide():lcObj._$container.height(lcObj._properties.height),lcObj._rtm=lcObj._$container.renderTypeManager({defaultTypes:defaultTypes,view:ds,width:lcObj._properties.width,height:lcObj._properties.height,map:{showRowLink:!1,interactToScroll:!0}})}};lcObj._updateDataSource(null,renderViz)||renderViz()}}(jQuery)},1632:function(module,exports){"use strict";!function(){$.component.Component.extend("Table","data",{_init:function(){this._needsOwnContext=!0,this._delayUntilVisible=!0,this._super.apply(this,arguments),this.registerEvent({display_row:["dataContext","row"]})},isValid:function(){return!$.isBlank(this._table)&&this._table.isValid()},configurationSchema:function(){return{schema:[{fields:[$.cf.contextPicker()]}],view:(this._dataContext||{}).dataset}},_initDom:function(){var lcObj=this;lcObj._super.apply(lcObj,arguments),lcObj.$contents.off(".table_"+lcObj.id),lcObj.$contents.on("display_row.table_"+lcObj.id,function(e,args){lcObj.trigger("display_row",[{dataContext:lcObj._dataContext,row:(args||{}).row}])})},_getAssets:function(){return{javascripts:[{assets:"shared-table-render"}],stylesheets:[{assets:"grid"},{assets:"render-images-bundle",hasImages:!0}],translations:["controls.grid"]}},_stylesLoaded:function(){this._super.apply(this,arguments),$.isBlank(this.$contents)||this.$contents.trigger("show")},_shown:function(){this._super(),$.isBlank(this.$contents)||this.$contents.trigger("show")},_hidden:function(){this._super(),$.isBlank(this.$contents)||this.$contents.trigger("hide")},_arrange:function(){this._super.apply(this,arguments),$.isBlank(this.$contents)||this.$contents.trigger("resize")},_render:function(){return _.isNumber(this._properties.height)||(this._properties.height=300),!!this._super.apply(this,arguments)&&(updateProperties(this,this._properties),!0)},_propWrite:function(properties){this._super.apply(this,arguments),this._rendered&&updateProperties(this,properties)}});var updateProperties=function(lcObj,properties){var setUpTable=function(){$.isBlank(lcObj.$contents)||$.isBlank(lcObj._dataContext)||($.isBlank(lcObj._table)?(lcObj._table=lcObj.$contents.datasetGrid({view:lcObj._dataContext.dataset,columnHideEnabled:!1,columnPropertiesEnabled:!1,editEnabled:!1,manualResize:!0}),lcObj._updateValidity()):lcObj._table.setView(lcObj._dataContext.dataset))};lcObj._updateDataSource(properties,setUpTable)||setUpTable()}}(jQuery)},1633:function(module,exports){"use strict";!function(){$.component.Component.extend("Simple Table","data",{_init:function(){this._delayUntilVisible=!0,this._super.apply(this,arguments)},_initDom:function(){this._super.apply(this,arguments),$.isBlank(this.$table)&&(this.$table=this.$contents.children("table"),this.$table.length<1&&(this.$table=$.tag({tagName:"table",contents:[{tagName:"caption"},{tagName:"colgroup"},{tagName:"thead"},{tagName:"tbody"},{tagName:"tfoot"}]}),this.$contents.append(this.$table)),this.$caption=this.$table.children("caption"),this.$colgroup=this.$table.children("colgroup"),this.$thead=this.$table.children("thead"),this.$tbody=this.$table.children("tbody"),this.$tfoot=this.$table.children("tfoot"))},_clearDataContext:function(){var cObj=this;$.subKeyDefined(cObj,"_dataContext.dataset")&&_.each($.makeArray(cObj._dataContext),function(dc){dc.dataset.unbind(null,null,cObj)}),cObj._super.apply(cObj,arguments)},_addDataContext:function(dc){var cObj=this;if(this._super.apply(this,arguments),$.subKeyDefined(dc,"dataset")){var doUpdate=function(){cObj._isDirty=!0,cObj._render()};dc.dataset.bind("query_change",doUpdate,cObj),dc.dataset.bind("columns_changed",doUpdate,cObj),cObj.$dom.attr("aria-live","polite")}},_render:function(){return!!this._super.apply(this,arguments)&&(updateProperties(this,this._properties),!0)},_propWrite:function(properties){this._super.apply(this,arguments),updateProperties(this,properties)}});var updateProperties=function(cObj,properties){var setUpTable=function(){if(!$.isBlank(cObj.$table)){if(cObj.$colgroup.empty(),_.isArray(cObj._properties.columns))cObj._columns=cObj._stringSubstitute(cObj._properties.columns);else if((cObj._properties.columns||{}).datasetColumns&&$.subKeyDefined(cObj,"_dataContext.dataset")){var exF=cObj._stringSubstitute(cObj._properties.columns.excludeFilter),incF=cObj._stringSubstitute(cObj._properties.columns.includeFilter);cObj._columns=_.chain(cObj._dataContext.dataset.visibleColumns).filter(function(col){return _.all(exF,function(v,k){return!_.include($.makeArray(v),$.deepGetStringField(col,k))})&&(!!$.isBlank(cObj._properties.columns.includeFilter)||_.any(incF,function(v,k){return _.include($.makeArray(v),$.deepGetStringField(col,k))}))}).map(function(col){return{id:col.fieldName,text:col.name}}).value()}if(_.each(cObj._columns,function(col){cObj.$colgroup.append($.tag({tagName:"col",class:col.id}))}),cObj.$caption.html(cObj._stringSubstitute(cObj._properties.caption)),cObj.$thead.empty(),(cObj._stringSubstitute(cObj._properties.header)||{}).columns&&!_.isEmpty(cObj._columns)){var $row=$.tag({tagName:"tr"});cObj.$thead.append($row),_.each(cObj._columns,function(col){$row.append($.tag({tagName:"th",scope:"col",class:col.id,contents:col.text}))})}else addRow(cObj,cObj.$thead,$.extend({isHeader:!0},cObj._properties.header));cObj.$thead.removeClass("hide"),cObj.$tfoot.removeClass("hide"),cObj.$caption.removeClass("hide");var callback,doneWithRowsCallback=function(count){var after=_.after(count,function(){if(count<1){var noResultsConf=cObj._stringSubstitute(cObj._properties.noResults||{});$.subKeyDefined(cObj._properties,"noResults.row")&&addRow(cObj,cObj.$tbody,cObj._properties.noResults.row),noResultsConf.hideHeader&&cObj.$thead.addClass("hide"),noResultsConf.hideFooter&&cObj.$tfoot.addClass("hide"),noResultsConf.hideCaption&&cObj.$caption.addClass("hide")}});return 0===count?after():after};if($.isBlank(cObj._dataContext))doneWithRowsCallback(0);else{if($.subKeyDefined(cObj,"_dataContext.dataset")){var view=cObj._dataContext.dataset,rowCount=cObj._stringSubstitute(cObj._properties.rowBodyCount||100);view.getRows((cObj._stringSubstitute(cObj._properties.rowBodyPage||1)-1)*rowCount,rowCount,function(rows){cObj.$tbody.empty(),callback=doneWithRowsCallback(rows.length),_.each(rows,function(r,i,list){addRow(cObj,cObj.$tbody,cObj._properties.row,view.rowToSODA2(r),i,list.length,callback)})})}else $.subKeyDefined(cObj,"_dataContext.datasetList")&&(cObj.$tbody.empty(),callback=doneWithRowsCallback(cObj._dataContext.datasetList.length),_.each(cObj._dataContext.datasetList,function(ds,i,list){addRow(cObj,cObj.$tbody,cObj._properties.row,ds,i,list.length,callback)}));cObj.$tfoot.empty(),addRow(cObj,cObj.$tfoot,cObj._properties.footer)}}};cObj._updateDataSource(properties,setUpTable)||setUpTable()},addRow=function(cObj,$parent,config,row,rowIndex,rowLength,callback){$.isBlank(rowIndex)||$.isBlank(rowLength)||(row=$.extend({},row,{_rowIndex:rowIndex,_rowDisplayIndex:rowIndex+1,_rowEvenOdd:rowIndex%2==0?"evenRow":"oddRow",_rowFirstLast:0==rowIndex?"firstRow":rowIndex==rowLength-1?"lastRow":"innerRow"}));var compRow=new $.component.PrivateSimpleTableRow($.extend(!0,{},config,{entity:row}),cObj._componentSet);if(compRow.parent=cObj,$.subKeyDefined(config,"valueRegex")){var r=new RegExp(compRow._stringSubstitute(config.valueRegex.regex)),v=compRow._stringSubstitute(config.valueRegex.value),result=r.test(v);if(config.valueRegex.invert&&(result=!result),!result)return compRow.destroy(),void(_.isFunction(callback)&&callback())}var $row=$.tag({tagName:"tr"});$parent.append($row);var addCell=function(cell,configuration,colIndex,colLength,colId){cell=cObj._stringSubstitute(cell||{},{_colIndex:colIndex,_colDisplayIndex:colIndex+1,_colEvenOdd:colIndex%2==0?"evenCol":"oddCol",_colFirstLast:0==colIndex?"firstCol":colIndex==colLength-1?"lastCol":"innerCol"}),$row.append($.tag({tagName:configuration.isHeader||cell.isHeader?"th":"td",class:_.compact([colId,cell.htmlClass]),scope:{onlyIf:configuration.isHeader&&cell.isColumn||cell.isHeader,value:configuration.isHeader&&cell.isColumn?"col":"row"},contents:cell.value}))},renderCells=function(){config=compRow._stringSubstitute(config),$.isBlank(config.htmlClass)||$row.addClass(config.htmlClass),$.isPlainObject(config.cells)&&!_.isEmpty(cObj._columns)?_.each(cObj._columns,function(col,i,list){addCell(config.cells[col.id],config,i,list.length,col.id)}):_.isArray(config.cells)&&_.each(config.cells,function(cell,i,list){addCell(cell,config,i,list.length)}),_.isFunction(callback)&&callback()};compRow._updateDataSource(null,renderCells)||renderCells()};$.component.FunctionalComponent.extend("PrivateSimpleTableRow","none",{})}(jQuery)},1634:function(module,exports){"use strict";!function($){$.component.Container.extend("Repeater","content",{_init:function(){var props=arguments[0],children=props.children||[];delete props.children,this._delayUntilVisible=!0,this._super.apply(this,arguments),this._map=[],this._idPrefix=this.id+"-",setUpProperties(this,children)},_initDom:function(){this._super.apply(this,arguments),$.isBlank(this._properties.height)&&this._isDirty&&!this.$dom.hasClass("serverRendered")&&(this._tempHeight=500,this.$dom.css("min-height",this._tempHeight)),$.isBlank(this._realContainer)&&this._properties.container&&$.isBlank(this.first)&&this._setUpRealContainer()},_dataReady:function(){},design:function(designing){if(this._designing&&!designing){this._cloneProperties.children=this._readChildren();!function cleanCId(item){_.each(item.children,function(c){$.isBlank(c.context)||$.isBlank(c.contextId)||delete c.contextId,cleanCId(c)})}(this._cloneProperties)}this._super.apply(this,arguments),$.subKeyDefined(this,"_delayUntilVisible")&&(this._delayUntilVisible=!this._designing),this._render()},fetchChildren:function(start,count,callback){var cObj=this;cObj.startLoading(),cObj._loadRows(start,count,function(renderedRows){renderedRows=_.select(renderedRows,function(r){return $.isPlainObject(r)}),callback(renderedRows),cObj.finishLoading()})},_clearDataContext:function(){var cObj=this;_.each($.makeArray(cObj._dataContext),function(dc){dc instanceof DataContext&&dc.unbind(null,null,cObj),$.isBlank(dc.dataset)||dc.dataset.unbind(null,null,cObj)}),cObj._super.apply(cObj,arguments)},_addDataContext:function(dc){var cObj=this;this._super.apply(this,arguments),$.subKeyDefined(dc,"dataset")&&"column"!=this._properties.repeaterType&&(dc.dataset.bind("query_change",function(){cObj._childrenDirty=!0,cObj._isDirty=!0,$.isBlank(cObj.$dom)||cObj.$dom.removeClass("serverRendered"),cObj._render()},this),cObj.$dom.attr("aria-live","polite")),"datasetList"==dc.type&&(dc.bind("data_change",function(){cObj._childrenDirty=!0,cObj._isDirty=!0,$.isBlank(cObj.$dom)||cObj.$dom.removeClass("serverRendered"),cObj._render()},this),cObj.$dom.attr("aria-live","polite"))},_setUpRealContainer:function(){this._realContainer=this.add(this._properties.container||{type:"Container"}),delete this._containerDirty},_loadRows:function(start,count,callback){var cObj=this,renderedRows=[];if($.isBlank(cObj._dataContext))callback();else if(_.isArray(cObj._dataContext.value))_.each(cObj._dataContext.value.slice(start,start+count),function(di,i){_.isObject(di)||(di={value:di}),renderedRows.push(cObj._createRow(di,i+start,di))}),callback(renderedRows);else if(_.isArray(cObj._dataContext.list))_.each(cObj._dataContext.list.slice(start,start+count),function(di,i){_.isObject(di)||(di={value:di}),renderedRows.push(cObj._createRow(di,i+start,di))}),callback(renderedRows);else if(_.isArray(cObj._dataContext.goalList)){var goalItems=cObj._dataContext.goalList.slice(start,start+count);$.isBlank(cObj._properties.groupBy)?(_.each(goalItems,function(di,i){_.isObject(di)||(di={value:di}),renderedRows.push(cObj._createRow(di,i+start,di))}),callback(renderedRows)):renderGroupItems(cObj,goalItems,callback)}else if("goalDashboard"==cObj._dataContext.type){var dashboardCatItems=cObj._dataContext.dashboard.categories.slice(start,start+count);$.isBlank(cObj._properties.groupBy)?(_.each(dashboardCatItems,function(di,i){_.isObject(di)||(di={value:di}),renderedRows.push(cObj._createRow(di,i+start,di))}),callback(renderedRows)):renderGroupItems(cObj,dashboardCatItems,callback)}else if(_.isArray(cObj._dataContext.categoryList)){var catItems=cObj._dataContext.categoryList.slice(start,start+count);$.isBlank(cObj._properties.groupBy)?(_.each(catItems,function(di,i){_.isObject(di)||(di={value:di}),renderedRows.push(cObj._createRow(di,i+start,di))}),callback(renderedRows)):renderGroupItems(cObj,catItems,callback)}else if((cObj._dataContext||{}).dataset){var view=(cObj._dataContext||{}).dataset;if("column"==cObj._properties.repeaterType){var exF=cObj._stringSubstitute(cObj._properties.excludeFilter),incF=cObj._stringSubstitute(cObj._properties.includeFilter);_.each(_.select(cObj._dataContext.dataset.visibleColumns,function(c){return!(!_.all(exF,function(v,k){return!_.include($.makeArray(v),$.deepGetStringField(c,k))})||!$.isBlank(cObj._properties.includeFilter)&&!_.any(incF,function(v,k){return _.include($.makeArray(v),$.deepGetStringField(c,k))}))}).slice(start,start+count),function(c,i){renderedRows.push(cObj._createRow(cObj._dataContext,i+start,{column:c}))}),callback(renderedRows)}else view.getRows(start,count,function(rows){rows=_.map(rows,function(r){return view.rowToSODA2(r)}),$.isBlank(cObj._properties.groupBy)?callback(_.map(rows,function(r){return cObj._createRow(r,r[":index"],r)})):renderGroupItems(cObj,rows,callback)})}else"datasetList"==cObj._dataContext.type&&cObj._dataContext.getItems(start,count,function(items){callback(_.map(items,function(ds,i){return cObj._createRow(ds,i+start,$.extend({},ds))}))})},_totalItems:function(callback){var cObj=this;if($.isBlank(cObj._dataContext))callback(0);else if(_.isArray(cObj._dataContext.value))callback(cObj._dataContext.value.length);else if(_.isArray(cObj._dataContext.list))callback(cObj._dataContext.list.length);else if("goalDashboard"==cObj._dataContext.type)callback(cObj._dataContext.dashboard.categories.length);else if(_.isArray(cObj._dataContext.goalList))callback(cObj._dataContext.goalList.length);else if(_.isArray(cObj._dataContext.categoryList))callback(cObj._dataContext.categoryList.length);else if((cObj._dataContext||{}).dataset){var view=(cObj._dataContext||{}).dataset;if("column"==cObj._properties.repeaterType){var exF=cObj._stringSubstitute(cObj._properties.excludeFilter),incF=cObj._stringSubstitute(cObj._properties.includeFilter);callback(_.select(cObj._dataContext.dataset.visibleColumns,function(c){return!(!_.all(exF,function(v,k){return!_.include($.makeArray(v),$.deepGetStringField(c,k))})||!$.isBlank(cObj._properties.includeFilter)&&!_.any(incF,function(v,k){return _.include($.makeArray(v),$.deepGetStringField(c,k))}))}).length)}else view.getTotalRows(function(){callback(view.totalRows())})}else"datasetList"==cObj._dataContext.type?callback(cObj._dataContext.count):callback(0)},_refresh:function(){var cObj=this;if($.isBlank(cObj._realContainer)||cObj._designing){for(;cObj.first;)cObj.first.destroy();_.each(cObj._funcChildren,function(fc){fc.destroy()}),cObj._funcChildren=[],cObj._map=[],delete cObj._realContainer}else $.isBlank(cObj._realContainer)||(cObj._containerDirty?(cObj._realContainer.destroy(),delete cObj._realContainer,cObj._map=[]):cObj._childrenDirty&&(cObj._realContainer.empty(),cObj._map=[]));if(cObj._designing){cObj.add(cObj._cloneProperties.children),$.isBlank(cObj._realContainer)||cObj._realContainer.design(!0),cObj.each(function(c){c.design(!0)}),$.isBlank(cObj._realContainer)||(cObj._realContainer._designSubsidiary=!0);!function addDesignSub(c){_.isFunction(c.each)&&c.each(function(cc){cc._designSubsidiary=!0,addDesignSub(cc)})}(cObj)}else $.isBlank(cObj._realContainer)&&cObj._setUpRealContainer(),cObj._totalItems(function(totalCount){var initCount,rowCount=cObj._stringSubstitute(cObj._properties.rowCount),pageCount=rowCount||100,start=(cObj._stringSubstitute(cObj._properties.rowPage||1)-1)*pageCount;$.isBlank(rowCount)||(totalCount=Math.min(totalCount,rowCount)),$.subKeyDefined(cObj,"_realContainer.setCount")&&cObj._realContainer.setCount(totalCount),initCount=$.subKeyDefined(cObj,"_realContainer.pageSize")&&$.isBlank(cObj._properties.groupBy)?cObj._realContainer.pageSize():Math.min(totalCount,pageCount),cObj.startLoading(),cObj._loadRows(start,initCount,function(renderedRows){if(renderedRows=_.compact(renderedRows),delete cObj._childrenDirty,renderedRows.length<1){var clone=new $.component.Repeater.Clone($.extend(!0,{},cObj._noChildrenCloneProperties),cObj._componentSet);cObj._realContainer.add(clone)}else _.each(renderedRows,function(r){$.isPlainObject(r)&&cObj._realContainer.add(r.row,r.index)});cObj.finishLoading(),_.defer(function(){$.isBlank(cObj._realContainer)||cObj._realContainer._render(),$.component.sizeRenderRefresh()})})})},_render:function(){if(!this._super.apply(this,arguments))return!1;var cObj=this,doRender=function(){$.isBlank(cObj._tempHeight)||(cObj.$dom.css("min-height",""),$(window).scroll()),cObj._refresh()};return cObj._updateDataSource(cObj._properties,doRender)||doRender(),!0},_createRow:function(row,index,entity){entity=entity||{},$.isBlank(entity._repeaterIndex)&&(entity._repeaterIndex=index),$.isBlank(entity._repeaterDisplayIndex)&&(entity._repeaterDisplayIndex=index+1),$.isBlank(entity._evenOdd)&&(entity._evenOdd=index%2==0?"even":"odd");var prefix=this._idPrefix+index+"-";var cloneProperties=function createTemplate(properties){(properties=_.clone(properties)).parentPrefix=prefix,properties.htmlClass=$.makeArray(properties.htmlClass),properties.htmlClass.push("id-"+properties.id),properties.id=prefix+(properties.id||$.component.allocateId()),properties.entity=entity;var children=properties.children;if("Repeater"!=properties.type&&children){$.isArray(children)||(children=[children]),children=properties.children=children.slice();for(var i=0;i<children.length;i++)children[i]=createTemplate(children[i])}return properties}($.extend({},this._stringSubstitute(this._properties.childProperties,entity),this._cloneProperties));if(this._map[index]){if(!this._childrenDirty&&this._map[index].id==cloneProperties.id)return!0;this._map[index].remove(),this._map[index]=void 0}cloneProperties.childContextId=(row.id||"").toString();var clone=this._map[index]=new $.component.Repeater.Clone(cloneProperties,this._componentSet);if(!$.isBlank(this._properties.valueRegex)){var r=new RegExp(this._stringSubstitute(this._properties.valueRegex.regex)),v=clone._stringSubstitute(this._properties.valueRegex.value),result=r.test(v);if(this._properties.valueRegex.invert&&(result=!result),!result)return clone.destroy(),null}return{row:clone,index:index}},_readChildren:function(){return this._designing?this._super():this._cloneProperties.children},_propWrite:function(properties){var cObj=this,origCloneProps=cObj._cloneProperties;properties=$.extend(!0,{},properties);var origProps=$.extend(!0,{},cObj._properties),children=properties.children;delete properties.children,cObj._super(properties),$.isBlank(children)||setUpProperties(this,children),cObj._containerDirty=!_.isEqual(cObj._properties.container,origProps.container),cObj._childrenDirty=!_.isEqual(cObj._cloneProperties,origCloneProps)||_.any(["context","contextId","parentPrefix","groupBy","repeaterType","excludeFilter","includeFilter","valueRegex","childProperties","childHtmlClass","childStyles"],function(p){return!_.isEqual(cObj._properties[p],origProps[p])}),(cObj._containerDirty||cObj._childrenDirty)&&cObj._render()}}),$.component.Repeater.Clone=$.component.Container.extend({_persist:!1});var setUpProperties=function(cObj,children){function allocateIds(childProperties){for(var i=0;i<childProperties.length;i++){var child=childProperties[i];void 0==child.id&&(child.id=$.component.allocateId()),child.children&&allocateIds(child.children)}}cObj._cloneProperties={id:"clone",children:children,htmlClass:cObj._properties.childHtmlClass,styles:cObj._properties.childStyles},cObj._noChildrenCloneProperties={id:cObj.id+"_noChildren-clone",children:cObj._properties.noResultsChildren},allocateIds(cObj._cloneProperties),allocateIds(cObj._noChildrenCloneProperties),updateContainerPrefix(cObj)},renderGroupItems=function(cObj,items,callback){var groupConfig=cObj._properties.groupBy,groupIndex={},groups=[];_.each(items,function(item){var group=cObj._stringSubstitute(groupConfig.value,item);if(!$.isBlank(group)){var addGroupItem=function(g){$.isBlank(groupIndex[g])?(groups.push(g),groupIndex[g]=[item]):groupIndex[g].push(item)};$.isBlank(groupConfig.splitOn)?addGroupItem(group):_.each(group.split(groupConfig.splitOn),function(g){addGroupItem(g)})}}),groupConfig.sortAlpha&&(groups=groups.sort()),callback(_.map(groups,function(g,i){return cObj._createRow({id:g},i,{_groupValue:g,_groupItems:groupIndex[g]})}))},updateContainerPrefix=function(cObj){var parPrefix=cObj._properties.parentPrefix||"";$.subKeyDefined(cObj,"_properties.container.id")&&!cObj._properties.container.id.startsWith(parPrefix)&&(cObj._properties.container.id=(cObj._properties.parentPrefix||"")+cObj._properties.container.id)}}(jQuery)},1635:function(module,exports){"use strict";!function(){$.component.Component.extend("Map Layer","data",{_init:function(){this._needsOwnContext=!0,this._delayUntilVisible=!0,this._super.apply(this,arguments),this.registerEvent({display_row:["dataContext","row","datasetId"]})},_displayFormat:function(){return $.extend(!0,{},this._properties.displayFormat,{context:{dataset:(this._dataContext||{}).dataset},component:this})},setDataObj:function(dataObj){this._dataObj=dataObj},isValid:function(){var properties,valid=!$.isBlank(this._dataContext)&&(GeoHelpers.isArcGISOrGeoDataset(this._dataContext.dataset)||(properties=this._properties,$.subKeyDefined(properties,"displayFormat.plot.locationId")&&$.subKeyDefined(properties,"displayFormat.plotStyle")));return"heatmap"==$.deepGet(this._properties,"displayFormat","plotStyle")&&(valid=valid&&$.subKeyDefined(this._properties,"displayFormat.heatmap.type")),valid},configurationSchema:function(){if(!1===this._super.apply(this,arguments))return!1;var retVal={schema:[{fields:[$.cf.contextPicker()]}],view:(this._dataContext||{}).dataset};if(blist.configuration.canvasX||blist.configuration.govStat){if($.isBlank(this._dataContext))return retVal;this._dataType&&"socrata"!=this._dataType?retVal.schema=retVal.schema.concat({title:"Config",fields:blist.configs.map.dataLayer[this._dataType]({view:this._dataContext.dataset})}):retVal.schema=retVal.schema.concat({title:"Basic Configuration",fields:blist.configs.map.dataLayer.socrataBase({view:this._dataContext.dataset})}).concat({title:"Advanced Configuration",fields:blist.configs.map.dataLayer.socrata({view:this._dataContext.dataset})})}return retVal},dragFocus:function(){this.$dom.isControlClass("nativeDraggable")&&this.$dom.nativeDraggable().disable()},_getEditAssets:function(){return{javascripts:[{assets:"shared-map-configuration"}]}},_render:function(){return!!this._super()&&(updateProperties(this),!0)},_propWrite:function(){this._super.apply(this,arguments),this._rendered&&updateProperties(this)},_updateDataSource:function(){var rv=this._super.apply(this,arguments);if($.subKeyDefined(this,"_dataContext.dataset")){var ds=this._dataContext.dataset;GeoHelpers.isArcGISDataset(ds)?this._dataType="esri":GeoHelpers.isGeoDataset(ds)?this._dataType="mondara":this._dataType="socrata"}return rv}});var updateProperties=function(lcObj){var updateMap=function(){var text,ds;if($.subKeyDefined(lcObj._dataContext,"dataset"))if("esri"==lcObj._dataType)text="ESRI Layer: <b>"+lcObj._dataContext.dataset.name+"</b>";else if("mondara"==lcObj._dataType)text="Mondara Layer Set: <b>"+lcObj._dataContext.dataset.name+"</b>";else if($.subKeyDefined(lcObj._properties,"displayFormat.plotStyle")){if(!lcObj._dataType||"socrata"==lcObj._dataType){ds=lcObj._dataContext.dataset;var df=lcObj._properties.displayFormat,info=[];"point"==df.plotStyle?info.push("Point map for dataset "):"heatmap"==df.plotStyle?info.push("Boundary map for dataset "):"rastermap"==df.plotStyle&&info.push("Heat map for dataset "),info.push("<b>"+ds.name||ds.id+"</b>"),text=info.join("")}}else text="Layer for dataset "+((ds=lcObj._dataContext.dataset).name||ds.id)+". No plot style selected";else text="No dataset selected";lcObj.$contents.html(text),lcObj.isValid()&&lcObj.parent.updateDisplayFormat()};lcObj._updateDataSource(null,updateMap)||updateMap()}}(jQuery)},1636:function(module,exports){"use strict";!function(){$.component.Component.extend("Map","data",{_init:function(){this._needsOwnContext=!0,this._delayUntilVisible=!0,arguments[0]=convertLegacy($.extend(!0,{},arguments[0])),this._vdefsToLoad=arguments[0].viewDefinitions||[],this._super.apply(this,arguments),this.registerEvent({display_row:["dataContext","row","datasetId"]})},updateDisplayFormat:function(){$.isBlank(this._map)||this._map.updateDisplayFormat(this._displayFormat()),this._updateValidity()},_displayFormat:function(){var df=this._stringSubstitute(this._properties.displayFormat);return df.viewDefinitions=df.viewDefinitions||[],_.each(this._viewDefinitions||[],function(vd){df.viewDefinitions.push(vd._displayFormat())}),df},isValid:function(){return!$.isBlank(this._viewDefinitions)||!$.isBlank(this._vdefsToLoad)||!$.isBlank(this._map)&&this._map.isValid()},configurationSchema:function(){if(!1===this._super.apply(this,arguments))return!1;var retVal={schema:[]};return(blist.configuration.canvasX||blist.configuration.govStat)&&(retVal.schema=retVal.schema.concat(blist.configs.map.config({canvas:!0}))),retVal},_getAssets:function(){return{javascripts:["https://serverapi.arcgisonline.com/jsapi/arcgis/?v=2.3",!1,{assets:"shared-map"}],stylesheets:["https://serverapi.arcgisonline.com/jsapi/arcgis/1.5/js/dojo/dijit/themes/tundra/tundra.css",{assets:"render-images-bundle",hasImages:!0},{assets:"display-map"},{assets:"rich-render-bundle"}],translations:["controls.map"]}},_getEditAssets:function(){return{javascripts:[{assets:"shared-map-configuration"}]}},_initDom:function(){var lcObj=this;lcObj._super.apply(lcObj,arguments),!lcObj.$overlay&&lcObj._designing&&(lcObj.$overlay=$.tag({tagName:"div",class:"mapBoxOverlay"}),lcObj.$dom.append(lcObj.$overlay),lcObj.$overlay.append($.tag({tagName:"div",class:"mapOverlayTitle",contents:"Layers in this Map:"})),lcObj.$contents.css("zIndex",1)),lcObj.$contents.off(".map_"+lcObj.id),lcObj.$contents.on("display_row.map_"+lcObj.id,function(e,args){var vd=_.detect(lcObj._viewDefinitions,function(layer){return(layer._dataContext||{}).dataset==(args||{}).dataset});lcObj.trigger("display_row",[{dataContext:vd?vd._dataContext:lcObj._dataContext,row:(args||{}).row,datasetId:(args||{}).datasetId}]),$.subKeyDefined(vd,"_dataContext")&&vd.trigger("display_row",[{dataContext:vd._dataContext,row:(args||{}).row,datasetId:(args||{}).datasetId}])}),lcObj.$contents.on("render_started.map_"+lcObj.id,function(){lcObj.startLoading()}),lcObj.$contents.on("render_finished.map_"+lcObj.id,function(){lcObj.finishLoading()}),lcObj._addDefinitions(lcObj._vdefsToLoad)},add:function(viewdef){if(!$.isBlank(viewdef))return $.isArray(viewdef)?_.map(viewdef.slice(),function(l){return this.add(l)},this):(viewdef instanceof $.component.MapLayer||(viewdef=$.component.create(viewdef,this._componentSet)),viewdef.parent=this,this._viewDefinitions=this._viewDefinitions||[],_.include(this._viewDefinitions,viewdef)||this._viewDefinitions.push(viewdef),this._moveChildDom(viewdef),!$.isBlank(this._map)&&$.isBlank(this._map.map)&&this._map._librariesLoaded(),viewdef)},destroy:function(){this._empty(),this._super()},_empty:function(){_.each(this._viewDefinitions||[],function(child){delete child.parent,child.destroy(),child=child.next}),delete this._viewDefinitions,delete this.first,delete this.last},_addDefinitions:function(){$.isBlank(this._vdefsToLoad)||(this.add(this._vdefsToLoad),delete this._vdefsToLoad)},_render:function(){var lcObj=this;return _.isNumber(lcObj._properties.height)||(lcObj._properties.height=300),!!lcObj._super.apply(lcObj,arguments)&&(_.each(lcObj._viewDefinitions||[],function(l){lcObj._moveChildDom(l)}),updateProperties(lcObj,lcObj._properties),!0)},_moveChildDom:function(child){child._initialized||(child._initDom(),this._designing&&child.design(!0)),this.$overlay&&0==child.$dom.parent().length&&this.$overlay[0].appendChild(child.dom),this._designing&&this.$overlay&&!child._rendered&&child._render()},_childRemoved:function(child){var index=this._viewDefinitions.indexOf(child);this._viewDefinitions.splice(index,1),this.updateDisplayFormat()},_shown:function(){this._super(),$.isBlank(this.$contents)||this.$contents.trigger("show")},_hidden:function(){this._super(),$.isBlank(this.$contents)||this.$contents.trigger("hide")},_propRead:function(){var properties=this._super(),children=this._readChildren();return children&&(properties.viewDefinitions=children),properties},_readChildren:function(){var children=[];return _.each(this._viewDefinitions,function(child){child&&children.push(child.properties())}),children},_propWrite:function(properties){this._super.apply(this,arguments),$.subKeyDefined(properties,"viewDefinitions")&&this._empty(),this._rendered&&updateProperties(this,properties)},_arrange:function(){this._super.apply(this,arguments),$.isBlank(this.$contents)||this.$contents.trigger("resize")},design:function(designing){var cObj=this;this._super.apply(this,arguments),_.each(this._viewDefinitions||[],function(child){child.design(designing)}),$.isBlank(this.$dom)||!this.canEdit("drop")||this.$dom.isControlClass("nativeDropTarget")?!$.isBlank(this.$dom)&&this.$dom.isControlClass("nativeDropTarget")&&(designing?this.$dom.nativeDropTarget().enable():this.$dom.nativeDropTarget().disable()):designing&&this.$dom.nativeDropTarget({contentEditable:!1,acceptCheck:function($item){return"MapLayer"==$item.data("typename")&&($item.hasClass("socrata-component")||$item.hasClass("componentCreate"))},dropCallback:function(dropId,dropType){"copy"==dropType&&$.cf.edit.execute("add",{container:cObj,childTemplate:{type:"MapLayer"}})}})}});var updateProperties=function(lcObj){var setUpMap=function(){if(!lcObj._isHidden){var df=lcObj._displayFormat();$.isBlank(lcObj._map)?(lcObj.$contents.empty(),lcObj._map=lcObj.$contents.socrataMap({showRowLink:!1,interactToScroll:!0,displayFormat:df,view:$.isBlank(df)?(lcObj._dataContext||{}).dataset:null}),lcObj._updateValidity()):lcObj._map.updateDisplayFormat(df)}},after=_.after((lcObj._viewDefinitions||[]).length,function(){lcObj._updateDataSource(null,setUpMap)||setUpMap()});_.isEmpty(lcObj._viewDefinitions)&&after(),_.each(lcObj._viewDefinitions||[],function(l){l._updateDataSource(null,after)||after()})},convertLegacy=function(props){if($.subKeyDefined(props,"displayFormat.bkgdLayers")&&props.displayFormat.bkgdLayers.forEach(function(layer){$.isBlank(layer.layerKey)&&!$.isBlank(layer.layerName)&&(layer.layerKey=layer.layerName,delete layer.layerName)}),props.viewDefinitions)return props;var contextId;if($.subKeyDefined(props,"displayFormat.viewDefinitions"))contextId=props.contextId,props.viewDefinitions=_.map(props.displayFormat.viewDefinitions,function(vd){return $.isBlank(vd.displayFormat)&&((vd={displayFormat:vd}).uid=vd.displayFormat.uid,vd.contextId=vd.displayFormat.contextId),$.isBlank(vd.contextId)&&!$.isBlank(contextId)&&(vd.contextId=contextId),vd.type="MapLayer",vd}),delete props.displayFormat.viewDefinitions;else if($.subKeyDefined(props,"displayFormat.type")){var df=props.displayFormat;contextId=props.contextId,props.viewDefinitions=[$.extend(!0,{type:"MapLayer",contextId:contextId},{displayFormat:props.displayFormat})],"heatmap"!=df.plotStyle&&("google"===df.type||"bing"===df.type?(df.type="google",df.exclusiveLayers=!0,df.bkgdLayers=Dataset.map.backgroundLayerSet.Google):df.bkgdLayers=_.map(df.layers,function(layer){return layer.custom_url?{custom_url:layer.custom_url}:{layerKey:(_.detect(Dataset.map.backgroundLayers,function(lConfig){return layer.url.indexOf((lConfig.options||{}).url)>-1})||{}).key}}))}return props.displayFormat&&delete props.contextId,props}}(jQuery)},1637:function(module,exports){"use strict";var $;($=jQuery).component.Component.extend("GovStat","none",{_needsOwnContext:!0,_getAssets:function(){return{javascripts:["/asset/js/socket.io","/asset/js/client-bridge"]}},_render:function(){if(!this._super.apply(this,arguments))return!1;this._updateDataSource(this._properties,this._gsRender)||this._gsRender()},_gsRender:function(){},_gsLoad:function(objReq,opts){var cObj=this,app=blist.require("app");app.set("locale",blist.locale),objReq.map(function(result){if(result instanceof blist.require("janus").store.Request.state.type.Success){cObj.$contents.empty();var obj=result.result,view=app.getView(obj,$.extend({attributes:cObj._stringSubstitute(cObj._properties.attributes),constructorOpts:cObj._stringSubstitute(cObj._properties.constructorOpts)},opts));$.isBlank(view)||cObj.$contents.append(view.artifact())}else result instanceof blist.require("janus").store.Request.state.type.Error&&cObj.$contents.empty()}),app.getStore(objReq).handle()},_propWrite:function(properties){this._super(properties),_.isEmpty(properties)||this._render()}}),$.component.GovStat.extend("GovStat Goal","none",{_gsRender:function(){var goalRequest=new(blist.require("govstat").models.goal.request.Fetch)({goalId:this._stringSubstitute(this._properties.goalId)}),context=this._stringSubstitute(this._properties.viewType);"card"!=context&&"detail"!=context&&(context="card"),this._gsLoad(goalRequest,{context:context})}}),$.component.GovStat.extend("GovStat Dashboard","none",{_gsRender:function(){var dbReq=new(blist.require("govstat").models.dashboard.request.Fetch)({dashboardId:this._stringSubstitute(this._properties.dashboardId)});this._gsLoad(dbReq,{context:"default"})},_getAssets:function(){return{javascripts:this._super().javascripts.concat([{assets:"sanitize-html"},{assets:"autolink-html"},{assets:"markdown-render"}])}}}),$.component.GovStat.extend("GovStat Category","none",{_gsRender:function(){var catReq=new(blist.require("govstat").models.category.request.Fetch)({dashboardId:this._stringSubstitute(this._properties.dashboardId),categoryId:this._stringSubstitute(this._properties.categoryId)});this._gsLoad(catReq,{context:"default"})}})},1638:function(module,exports){"use strict";!function(){_.each($.extend({chart:{value:"Chart"}},Dataset.chart.types),function(value,localChartType){var typeName=value.value.toLowerCase().displayable();switch(value.value){case"timeline":break;case"treemap":typeName="Tree Map";break;case"Chart":typeName="Chart";break;case"stackedcolumn":typeName="Stacked Column Chart";break;case"stackedbar":typeName="Stacked Bar Chart";break;default:typeName+=" Chart"}$.component.Component.extend(typeName,_.include(["area","bar","donut","stackedcolumn","stackedbar"],value.value.toLowerCase())?"none":"data",{catalogName:(value.text||"Chart").toLowerCase().displayable(),_init:function(){this._needsOwnContext=!0,this._delayUntilVisible=!0,this._noTransactionForUndo=!0,this._super.apply(this,arguments),this.registerEvent({display_row:["dataContext","row"]}),this._chartType=this._stringSubstitute(this._properties.chartType)||("chart"==localChartType?null:localChartType)},isValid:function(){return!$.isBlank(this._chart)&&this._chart.isValid()},configurationSchema:function(){var retVal={schema:[{fields:[$.cf.contextPicker()]}],view:(this._dataContext||{}).dataset};if(blist.configuration.canvasX||blist.configuration.govStat){if($.isBlank(this._dataContext))return retVal;retVal.schema=retVal.schema.concat(blist.configs.chart.configForType(this._chartType,{view:this._dataContext.dataset}))}return retVal},_initDom:function(){var lcObj=this;lcObj._super.apply(lcObj,arguments),lcObj.$contents.off(".chart_"+lcObj.id),lcObj.$contents.on("display_row.chart_"+lcObj.id,function(e,args){lcObj.trigger("display_row",[{dataContext:lcObj._dataContext,row:(args||{}).row}])}),lcObj.$contents.on("render_started.chart_"+lcObj.id,function(){lcObj.startLoading()}),lcObj.$contents.on("render_finished.chart_"+lcObj.id,function(){lcObj.finishLoading()})},_getAssets:function(){return{javascripts:[{assets:"shared-chart"}],stylesheets:["/stylesheets/chart-screen.css",{assets:"rich-render-bundle"},{assets:"display-chart"}],translations:["controls.charts"]}},_shown:function(){this._super(),$.isBlank(this.$contents)||this.$contents.trigger("show")},_hidden:function(){this._super(),$.isBlank(this.$contents)||this.$contents.trigger("hide")},_arrange:function(){this._super(),$.isBlank(this.$contents)||this.$contents.trigger("resize")},_render:function(){return _.isNumber(this._properties.height)||(this._properties.height=300),!!this._super.apply(this,arguments)&&(updateProperties(this,this._properties),!0)},_propWrite:function(properties){this._super.apply(this,arguments),this._chartType=this._stringSubstitute(this._properties.chartType)||this._chartType,this._rendered&&updateProperties(this,properties)},design:function(){this._super.apply(this,arguments),$.isBlank(this.$editOverlay)&&(this.$editOverlay=$.tag({tagName:"div",class:"editOverlay"}),this.$dom.append(this.$editOverlay)),this.$editOverlay.toggleClass("hide",!this._designing)}})});var updateProperties=function(lcObj,properties){var setUpChart=function(){if($.isBlank(lcObj._dataContext))lcObj.$contents.empty();else if($.isBlank(lcObj._chart))lcObj._chartType=lcObj._stringSubstitute(lcObj._properties.chartType)||lcObj._chartType,lcObj.$contents.empty(),lcObj._chart=lcObj.$contents.socrataChart({chartType:lcObj._chartType,displayFormat:lcObj._stringSubstitute(lcObj._properties.displayFormat),view:lcObj._dataContext.dataset}),lcObj._updateValidity();else{var newChart=lcObj._chart.setView(lcObj._dataContext.dataset);$.isBlank(newChart)||(lcObj._chart=newChart)}};if(!lcObj._updateDataSource(properties,setUpChart))if($.isBlank(properties.displayFormat)||$.isBlank(lcObj._chart))setUpChart();else{var newC=lcObj._chart.reload(lcObj._stringSubstitute(lcObj._properties.displayFormat));$.isBlank(newC)||(lcObj._chart=newC)}}}(jQuery)},1639:function(module,exports){"use strict";var $;($=jQuery).component.Component.extend("Title","content",{_needsOwnContext:!0,_initDom:function(){if(this._super.apply(this,arguments),$.isBlank(this.$title)){var tag=this._properties.tagName||"h2";this.$title=this.$contents.children(tag),this.$title.length<1&&(this.$contents.empty().append($.tag({tagName:tag})),this.$title=this.$contents.children(tag))}},_getEditAssets:function(){return{javascripts:[{assets:"content-editable"}]}},_render:function(){var cObj=this;if(!cObj._super.apply(cObj,arguments))return!1;var doRender=function(){var t=$.isBlank(cObj._properties.text)?"":cObj._properties.text;cObj.$title.text(cObj._stringSubstitute(t))};cObj._updateDataSource(cObj._properties,doRender)||doRender()},_propWrite:function(properties){var cObj=this;if(cObj._super(properties),!_.isEmpty(properties))if(cObj._editing){var doEdit=function(){cObj.edit(!0),cObj.editFocus(!0)};cObj._updateDataSource(cObj._properties,doEdit)||doEdit()}else cObj._render()},design:function(){this._super.apply(this,arguments),this._render()},_valueKey:function(){return"text"},configurationSchema:function(){return{schema:[{fields:[$.extend($.cf.contextPicker(),{required:!1})]}]}},editFocus:function(focused){return!(!this._super.apply(this,arguments)||!focused&&($.cf.extractProperties(this.$title),this._updatePrimaryValue(this.$title.text()),0))},edit:function(){var cObj=this,wasEditable=cObj._editing;if(!cObj._super.apply(cObj,arguments))return!1;cObj.$title.toggleClass("socrata-cf-mouse",cObj._editing);var origHeight=cObj.$dom.height();cObj._editing?wasEditable||(cObj.$title.text(cObj._properties.text),$.cf.enhanceProperties(cObj.$title)):wasEditable&&cObj._render();var newHeight=cObj._getNumericalPropertyWithFallback("height",cObj.$dom.height());cObj.$dom.height(origHeight),cObj.$dom.animate({height:newHeight},"slow",function(){cObj.$dom.height(cObj._getNumericalPropertyWithFallback("height",""))})},asString:function(){return this._stringSubstitute(this._properties.text)}})},1640:function(module,exports){"use strict";$.component.Component.extend("Safe Html","none",{_needsOwnContext:!0,_getAssets:function(){return{javascripts:[{assets:"sanitize-html"},{assets:"autolink-html"}]}},_sanitizeDisplayHtml:function(unsafeHtml){return blist.util.htmlSanitizer.sanitizeHtmlPermissive(unsafeHtml)},_render:function(){if(!this._super.apply(this,arguments))return!1;var cObj=this,doRender=function(){var unsafeHtmlResult,safeHtmlResult,substitutionTarget=cObj._properties.html,finalHtmlResult="";$.isBlank(substitutionTarget)||(unsafeHtmlResult=cObj._stringSubstitute(substitutionTarget),safeHtmlResult=cObj._sanitizeDisplayHtml(unsafeHtmlResult),finalHtmlResult=cObj._properties.autoLink?blist.util.autolinker.autoLinkHtml(safeHtmlResult):safeHtmlResult),cObj.$contents.html(finalHtmlResult)};return cObj._updateDataSource(cObj._properties,doRender)||doRender(),!0},_propWrite:function(properties){var cObj=this;if(cObj._super(properties),!_.isEmpty(properties))if(cObj._editing){var doEdit=function(){cObj.edit(!0),cObj.editFocus(!0)};cObj._updateDataSource(cObj._properties,doEdit)||doEdit()}else cObj._render()},_valueKey:function(){return"html"},configurationSchema:function(){return{}},editFocus:function(){return!1},edit:function(){return!1}})},1641:function(module,exports){"use strict";$.component.Component.extend("Formatted Text","content",{_needsOwnContext:!0,_getAssets:function(){return{javascripts:[{assets:"sanitize-html"},{assets:"autolink-html"},{assets:"markdown-render"}]}},_getEditAssets:function(){return{javascripts:[{assets:"content-editable"},{assets:"markdown-create"}],stylesheets:[{assets:"markdown-create"}],translations:["plugins.hallo"]}},_sanitizeDisplayHtml:function(unsafeHtml){return blist.util.htmlSanitizer.sanitizeHtmlPermissive(unsafeHtml)},_safeRenderMarkdown:function(markdownDocument){var safeMarkdown=blist.util.htmlSanitizer.sanitizeHtmlRestrictive(markdownDocument),unsafeHtmlResult=blist.util.markdown.convertMarkdownToHtml(safeMarkdown);return this._sanitizeDisplayHtml(unsafeHtmlResult)},_render:function(){if(!this._super.apply(this,arguments))return!1;var cObj=this,doRender=function(){var markdown,safeHtmlResult,finalHtmlResult,substitutionTarget=cObj._properties.markdown;$.isBlank(substitutionTarget)||(markdown=blist.util.markdown.escapeLinksInMarkdown(cObj._stringSubstitute(substitutionTarget)),safeHtmlResult=cObj._safeRenderMarkdown(markdown),finalHtmlResult=blist.util.autolinker.autolinkHtml(safeHtmlResult)),cObj.$contents.html(finalHtmlResult||"")};return cObj._updateDataSource(cObj._properties,doRender)||doRender(),!0},_propWrite:function(properties){var cObj=this;if(cObj._super(properties),!_.isEmpty(properties))if(cObj._editing){var doEdit=function(){cObj.edit(!0),cObj.editFocus(!0)};cObj._updateDataSource(cObj._properties,doEdit)||doEdit()}else cObj._render()},_valueKey:function(){return"markdown"},configurationSchema:function(){return{schema:[{fields:[$.extend($.cf.contextPicker(),{required:!1})]}]}},editFocus:function(focused){if(!this._super.apply(this,arguments))return!1;if(focused)return!0;$.cf.extractProperties(this.$contents);var contHtml=this.$contents.html(),sanitizedHtml=this._sanitizeDisplayHtml(contHtml),markdown="";return sanitizedHtml&&(markdown=HTML2Markdown(sanitizedHtml)),this._updatePrimaryValue(markdown),!0},edit:function(){var cObj=this,wasEditable=cObj._editing;if(!cObj._super.apply(cObj,arguments))return!1;cObj.$contents.toggleClass("socrata-cf-mouse",cObj._editing);var origHeight=cObj.$dom.height();if(cObj._editing){if(!wasEditable){var safeHtmlResult,markdown=cObj._properties.markdown;$.isBlank(markdown)||(safeHtmlResult=cObj._safeRenderMarkdown(blist.util.markdown.escapeLinksInMarkdown(markdown))),cObj.$contents.html(safeHtmlResult),$.cf.enhanceProperties(cObj.$contents,!0),cObj.$contents.hallo({editable:!0,toolbar:"halloToolbarContextual",forceStructured:!0,execCommandOverride:_.bind(this._onEditorExecCommand,this),plugins:{halloformat:{formatting:{bold:!0,italic:!0}},halloheadings:{},halloreundo:{},hallolists:{},halloplainpaster:{},hallobetterlink:{}}})}}else wasEditable&&(cObj.$contents.hallo({editable:!1}),cObj._render());var newHeight=cObj._getNumericalPropertyWithFallback("height",cObj.$dom.height());cObj.$dom.height(origHeight),cObj.$dom.animate({height:newHeight},"slow",function(){cObj.$dom.height(cObj._getNumericalPropertyWithFallback("height",""))})},_onEditorExecCommand:function(command,useDefaultUi,value){var retVal=!1;if($.browser.webkit){this.$dom.css("font-weight","lighter");try{retVal=document.execCommand(command,useDefaultUi,value),this.$dom.find("span[style*=lighter]:first-child").filter(function(){return 1==this.attributes.length}).contents().unwrap()}finally{this.$dom.css("font-weight","")}}else retVal=document.execCommand(command,useDefaultUi,value);return retVal},_onUiResizableResizeStart:function(){this.$dom.css("min-height","")},_onUiResizableResizeStop:function(){var newPropertyValues={minHeight:this.$dom.height(),height:void 0};this._executePropertyUpdate(newPropertyValues),delete this._properties.height,this.$dom.height("")}})},1642:function(module,exports){"use strict";$.component.Component.extend("Text","content",{_needsOwnContext:!0,_getEditAssets:function(){return{javascripts:[{assets:"content-editable"}]}},_render:function(){if(!this._super.apply(this,arguments))return!1;var cObj=this,doRender=function(){var html=cObj._properties.html;$.isBlank(html)||(html=cObj._stringSubstitute(html)),cObj._properties.isPlainText&&(html=html.plainTextToHtml()),cObj.$contents.html(html)};return cObj._updateDataSource(cObj._properties,doRender)||doRender(),!0},_propWrite:function(properties){var cObj=this;if(cObj._super(properties),!_.isEmpty(properties))if(cObj._editing){var doEdit=function(){cObj.edit(!0),cObj.editFocus(!0)};cObj._updateDataSource(cObj._properties,doEdit)||doEdit()}else cObj._render()},_valueKey:function(){return"html"},configurationSchema:function(){return{schema:[{fields:[$.extend($.cf.contextPicker(),{required:!1})]}]}},editFocus:function(focused){if(!this._super.apply(this,arguments))return!1;if(focused)return!0;$.cf.extractProperties(this.$contents);var contHtml=$.htmlStrip(this.$contents.html());return contHtml=contHtml.replace(/&nbsp;/g," "),this._updatePrimaryValue($.htmlUnescape(contHtml)),!0},edit:function(){var cObj=this,wasEditable=cObj._editing;if(!cObj._super.apply(cObj,arguments))return!1;cObj.$contents.toggleClass("socrata-cf-mouse",cObj._editing);var origHeight=cObj.$dom.height();cObj._editing?wasEditable||(cObj.$contents.html($.htmlEscape(cObj._properties.html)),$.cf.enhanceProperties(cObj.$contents)):wasEditable&&cObj._render();var newHeight=cObj._properties.height||cObj.$dom.height();cObj.$dom.height(origHeight),cObj.$dom.animate({height:newHeight},"slow",function(){cObj.$dom.height(cObj._properties.height||"")})}})},1643:function(module,exports){"use strict";var $;($=jQuery).component.Picture.extend("Header","content",{_needsOwnContext:!0,_initDom:function(){this._super.apply(this,arguments),$("body").addClass("hasHeader")},_getEditAssets:function(){var assets=this._super()||{};return assets.translations=assets.translations||[],assets.translations.push("dataslate.component.header"),assets},destroy:function(){this._super.apply(this,arguments),$("body").removeClass("hasHeader")},configurationSchema:function(){var retVal=this._super.apply(this,arguments);return!1!==retVal&&(retVal.schema.push({fields:[{text:$.t("dataslate.component.header.height"),type:"text",name:"height"}]}),retVal)}})},1644:function(module,exports){"use strict";!function($){var t=function(str){return $.t("dataslate.component.picture."+str)};$.component.Component.extend("Picture","content",{_initDom:function(){this._super.apply(this,arguments),($.isBlank(this.$img)||this.$img.parents("body").length<1)&&(this.$img=this.$contents.children("img"),this.$img.length<1&&(this.$img=$.tag({tagName:"img"}),this.$contents.append(this.$img)))},_getEditAssets:function(){return{javascripts:[{assets:"image-uploader"}],translations:["dataslate.component.picture"]}},configurationSchema:function(){return!1!==this._super.apply(this,arguments)&&{schema:[{title:t("image_source"),fields:[{type:"radioGroup",name:"imageSource",required:!0,lineClass:"noLabel",options:[{type:"group",options:[{name:"asset.id",type:"custom",required:!0,editorCallbacks:{create:createAssetUploader,value:assetValue}},{name:"asset.size",type:"select",prompt:null,options:[{text:t("original"),value:""},{text:t("tiny"),value:"tiny"},{text:t("thumb"),value:"thumb"},{text:t("medium"),value:"medium"},{text:t("large"),value:"large"}]}]},{name:"url",type:"text",extraClass:"url",required:!0,prompt:t("full_url")}]}]},{fields:[{name:"title",type:"text",text:t("title_attr"),prompt:t("title_attr_prompt")},{name:"alt",type:"text",text:t("alt_attr"),prompt:t("alt_attr_prompt")}]}]}},_render:function(){var cObj=this;if(!cObj._super.apply(cObj,arguments))return!1;var doRender=function(){var url;$.isBlank((cObj._properties.asset||{}).id)?$.isBlank(cObj._properties.url)||(url=cObj._stringSubstitute(cObj._properties.url)):(url="/api/assets/"+cObj._stringSubstitute(cObj._properties.asset.id),$.isBlank(cObj._properties.asset.size)||(url+="?s="+cObj._stringSubstitute(cObj._properties.asset.size)));var title=cObj._stringSubstitute(cObj._properties.title),alt=cObj._stringSubstitute(cObj._properties.alt);cObj.$img.attr({src:url||"",title:title,alt:alt||title})};return cObj._updateDataSource(cObj._properties,doRender)||doRender(),!0},_propWrite:function(properties){this._super(properties),_.isEmpty(properties)||this._render()}});var createAssetUploader=function($field,vals,curValue){$field.addClass("imageUploaderField");var $preview=$.tag({tagName:"span",class:"imagePreview",contents:{tagName:"img",src:"/api/assets/"+curValue+"?s=tiny"}});$field.append($preview);var $upload=$.tag({tagName:"input",type:"file","data-endpoint":"/api/assets"});$field.append($upload);var $hiddenInput=$.tag({tagName:"input",type:"hidden",name:$field.attr("name"),class:"required",value:curValue});return $field.append($hiddenInput),$upload.imageUploader({containerSelector:".inputItem",inputClass:"socrata-cf-mouse",$image:$preview,success:function($container,$image,response){$hiddenInput.value(response.id),$hiddenInput.change()},urlProcessor:function(response){return"/api/assets/"+response.id+"?s=tiny"}}),!0},assetValue=function($field){var $editor=$field.find("input[type=hidden]");return $editor.length<1?null:$editor.value()}}(jQuery)},1645:function(module,exports){"use strict";$.component.Component.extend("Menu","none",{_needsOwnContext:!0,_render:function(){if(!this._super.apply(this,arguments))return!1;var cObj=this,doRender=function(){var createMenu=function(menuOpts){cObj.$contents.addClass("menu").menu(menuOpts)},opts={};if(_.each(["Class","Contents","Title"],function(v){$.isBlank(cObj._properties["button"+v])||(opts["menuButton"+v]=cObj._stringSubstitute(cObj._properties["button"+v]))}),_.isArray(cObj._properties.contents))opts.contents=cObj._stringSubstitute(cObj._properties.contents),createMenu(opts);else if($.isPlainObject(cObj._properties.contents)&&!$.isBlank(cObj._dataContext))switch(opts.contents=[],cObj._dataContext.type){case"dataset":var start=cObj._stringSubstitute(cObj._properties.rowStart||0),length=cObj._stringSubstitute(cObj._properties.rowLength||100);cObj._dataContext.dataset.getRows(start,length,function(rows){var columnMap=this.columnMap={};_.each(cObj._dataContext.dataset.visibleColumns,function(c){columnMap[c.id]=c.fieldName}),_.each(rows,function(r){var entity={};_.each(columnMap,function(to,from){entity[to]=r[from],void 0==entity[to]&&(entity[to]=null)}),opts.contents.push(cObj._stringSubstitute(cObj._properties.contents,entity))}),createMenu(opts)})}};return cObj._updateDataSource(cObj._properties,doRender)||doRender(),!0},_propWrite:function(properties){this._super(properties),_.isEmpty(properties)||this._render()}})},1646:function(module,exports){"use strict";!function($){$.component.Container.extend("Grid Container","content",{_renderStatus:{},_getContainer:function(){return this._gotContainer||(1==this.$contents.children(".row").length&&this.$contents.find(".row > .socrata-component").unwrap(),this._gotContainer=!0),this.$contents},_arrange:function(){var cObj=this;cObj._super();var cw=valOrDef(cObj._properties.cellWidth,300),ch=valOrDef(cObj._properties.cellHeight,300),cspace=valOrDef(cObj._properties.cellSpacing,10),cvspace=valOrDef(cObj._properties.cellVSpacing,cspace),cborder=valOrDef(cObj._properties.cellBorderWidth,0),innerCW=2*cspace+cborder,rspace=valOrDef(cObj._properties.rowSpacing,0),rborder=valOrDef(cObj._properties.rowBorderWidth,cborder);_.defer(function(){var rowItems,mainW=cObj.$contents.width();for(rowItems=0;rowItems*cw+(rowItems-1)*innerCW<=mainW;rowItems++);if(!(--rowItems<1)){var visibleChildren=[];cObj.each(function(c){c._isHidden||visibleChildren.push(c)});var rows=Math.ceil(1*visibleChildren.length/rowItems);if(cObj._renderStatus.layoutStale||rowItems!=cObj._renderStatus.rowItems||rows!=cObj._renderStatus.rows||visibleChildren.length!=cObj._renderStatus.numChildren){var $rows=cObj.$contents.children(".row");for($rows.slice(rows-1).detach(),$rows=$rows.slice(0,rows-1);$rows.length<rows;){var $r=$.tag({tagName:"div",class:["row","clearfix"]});cObj.$contents.append($r),$rows=$rows.add($r)}$rows.removeClass("first last").css({paddingTop:rspace,paddingBottom:rspace,borderBottomWidth:rborder,width:rowItems*cw+(rowItems-1)*innerCW}),$rows.first().addClass("first").css({paddingTop:0}),$rows.last().addClass("last").css({paddingBottom:0,borderBottomWidth:0}),_.each(visibleChildren,function(c,i){if(!$.isBlank(c.$dom)){var $r2=$rows.eq(Math.floor(i/rowItems)),firstRow=$r2.hasClass("first"),lastRow=$r2.hasClass("last");$r2.append(c.$dom);var firstCol=i%rowItems==0,lastCol=(i+1)%rowItems==0;c.$dom.css({height:ch,width:cw,paddingLeft:firstCol?0:cspace,paddingTop:firstRow?0:cvspace,paddingRight:lastCol?0:cspace,paddingBottom:lastRow?0:cvspace,borderRightWidth:lastCol?0:cborder}),c.$dom.toggleClass("first",firstCol),c.$dom.toggleClass("last",lastCol)}}),cObj._renderStatus={layoutStatus:!1,numChildren:visibleChildren.length,rows:rows,rowItems:rowItems}}}})},_moveChildDom:function(){this._renderStatus.layoutStale=!0,this._super.apply(this,arguments)},_removeChildDom:function(child){this._renderStatus.layoutStale=!0,child.$dom.css({height:"",width:"",paddingLeft:"",paddingTop:"",paddingRight:"",paddingBottom:"",borderRightWidth:""}),child.$dom.removeClass("first last"),this._super.apply(this,arguments)},_propWrite:function(){this._renderStatus.layoutStale=!0,this._super.apply(this,arguments)},_drawDropCursor:function(child){this._super.apply(this,arguments),child.$dom.closest(".row").append(this._$dropCursor)},_testChildHit:function(child,pos,inSequence){var $row=child.$dom.closest(".row"),rowOffset=$row.offset();if(!(inSequence&&rowOffset.top>pos.y||rowOffset.top<=pos.y&&rowOffset.top+$row.outerHeight(!0)>=pos.y))return!1;var childOffset=child.$dom.offset();return inSequence&&childOffset.left>pos.x||childOffset.left<=pos.x&&childOffset.left+child.$dom.outerWidth(!0)>=pos.x||childOffset.left<=pos.x&&child.$dom.hasClass("last")},_dropCursorDirection:function(){return"vertical"}});var valOrDef=function(val,def){return $.isBlank(val)?def:val}}(jQuery)},1647:function(module,exports){"use strict";$.component.Container.extend("Fixed Container","none",{_needsOwnContext:!0,_render:function(){var cObj=this;if(!cObj._super.apply(cObj,arguments))return!1;var $b=$("body");cObj.$dom.waypoint(function(ev,dir){"down"===dir?(cObj.$dom.height(cObj.$contents.height()),cObj.$contents.width(cObj.$dom.width()),cObj.$contents.css({top:$b.css("padding-top"),left:cObj.$dom.offset().left})):(cObj.$dom.height(""),cObj.$contents.width("").css({top:"",left:""})),cObj._floating="down"===dir,cObj.$contents.toggleClass("sticky","down"===dir)},{offset:parseInt($b.css("padding-top"))});var key=".fixedContainer_"+cObj.id;return $(window).off(key).on("resize"+key,function(){cObj._floating&&cObj.$contents.css("left",cObj.$dom.offset().left)}),!0}})},1648:function(module,exports){"use strict";!function($){$.component.Component.extend("Comments","content",{_init:function(){this._needsOwnContext=!0,this._delayUntilVisible=!0,this._super.apply(this,arguments)},_getAssets:function(){return{javascripts:[{assets:"feed-list"}],stylesheets:[{assets:"feed"}],templates:["feed?allow_comments=true"],translations:["controls.feed"]}},_render:function(){return!!this._super.apply(this,arguments)&&(this._updateDataSource(this._properties,renderUpdate)||this.$contents.empty(),!0)},_propWrite:function(properties){this._super.apply(this,arguments),this._updateDataSource(properties,renderUpdate)}});var renderUpdate=function(){var cObj=this,datasets=cObj._getDatasetListFromContext(cObj._dataContext);if(!(datasets.length<1)){var comments=[],numDatasetsToFetch=cObj._properties.hideComments?0:datasets.length,gotComments=_.after(numDatasetsToFetch,function(){cObj.finishLoading(),$.isBlank(cObj._feed)&&(cObj.$contents.empty(),cObj.$contents.addClass("feedList clearfix").append($.renderTemplate("feedList")),cObj._properties.hideCommenting&&cObj.$contents.find(".feedNewCommentButton").remove(),cObj._properties.hideReplies&&cObj.$contents.find(".feed").addClass("noReplies"),cObj._feed=cObj.$contents.find(".feed").feedList({filterCategories:null,comments:comments,mainView:_.first(datasets),views:datasets,pageSize:cObj._properties.pageSize||10,hideFeed:cObj._properties.hideComments,alwaysShowNewCommentForm:cObj._properties.alwaysShowCommenting})),cObj._updateValidity()});0===numDatasetsToFetch&&gotComments(),cObj._properties.hideComments||(cObj.startLoading(),_.each(datasets,function(ds){ds.getComments(function(responseData){comments=comments.concat(responseData),gotComments()})}))}}}(jQuery)},1649:function(module,exports){"use strict";!function($){$.component.Component.extend("Catalog","data",{_needsOwnContext:!0,_initDom:function(){var cObj=this;cObj._super.apply(cObj,arguments),cObj._$iframe||(cObj._$iframe=cObj.$contents.children("iframe"),cObj._$iframe.length<1&&(cObj._$iframe=$.tag({tagName:"iframe",frameborder:0,title:"Catalog"}),cObj.$contents.append(cObj._$iframe)),cObj._$iframe.attr("scrolling","no"),cObj._$iframe.removeAttr("width"),cObj._$iframe.removeAttr("height"),cObj._$iframe.width(cObj.$contents.width()),cObj._$iframe.bind("load",function(){var height=this.contentDocument?this.contentDocument.body.offsetHeight:this.contentWindow.document.body.scrollHeight;cObj._$iframe.height(height)}))},_render:function(){if(!this._super.apply(this,arguments))return!1;var props=this._stringSubstitute(this._properties),params={};return _.isEmpty(props.defaults)||$.extend(params,props.defaults),_.isEmpty(props.disabledItems)||(params.disable=$.arrayToObjKeys(props.disabledItems,!0)),_.isEmpty(props.disabledSections)||(params.suppressed_facets=$.arrayToObjKeys(props.disabledSections,!0)),this._$iframe.attr("src",$.path("/browse/embed?"+$.param(params))),!0},_arrange:function(){this._super.apply(this,arguments),this._$iframe.width(this.$contents.width())}}),$.component.Container.extend("NewCatalog","data",{_init:function(){this._delayUntilVisible=!0,this._super.apply(this,arguments)},_getAssets:function(){return{translations:["controls.browse","core.analytics"]}},_render:function(){var cObj=this;if(!cObj._super.apply(cObj,arguments))return!1;if(!cObj._setUp){var setDatasetList=function(){$.subKeyDefined(cObj,"_context.datasetList")||cObj.properties({context:{id:"context-"+cObj.id,type:"datasetList",search:{limit:20},noFail:!0}});var conf=cObj.$contents.find(".dataCarrier").data("catalogconfig")||defaultConfig(cObj._stringSubstitute(cObj._properties),(cObj._context||{}).id||cObj._properties.context.id);cObj.add(conf),cObj._setUp=!0};return cObj._updateDataSource(null,setDatasetList)||setDatasetList(),!0}}});var defaultConfig=function(props,dcId){var disabledSections={};_.isEmpty(props.disabledSections)||(disabledSections=$.arrayToObjKeys(props.disabledSections,!0));var disabledItems={};_.isEmpty(props.disabledItems)||(disabledItems=$.arrayToObjKeys(props.disabledItems,!0));var defaults=props.defaults||{};return{type:"HorizontalContainer",children:[{weight:2,type:"Container",htmlClass:"sidebar",children:[disabledItems.sort?null:{type:"Sort"},{type:"Search",isList:!0},disabledSections[$.t("controls.browse.facets.view_types_singular_title")]?null:{type:"DatasetListFilter",facet:"viewTypes"},disabledSections[$.t("controls.browse.facets.categories_singular_title")]?null:{type:"DatasetListFilter",facet:"categories"},disabledSections[$.t("controls.browse.facets.topics_singular_title")]?null:{type:"DatasetListFilter",facet:"topics"},disabledSections[$.t("controls.browse.facets.federated_domains_singular_title")]?null:{type:"DatasetListFilter",facet:"federatedDomains"}]},{weight:8,type:"Container",children:[disabledItems.table_header?null:{type:"HorizontalContainer",htmlClass:"header",children:[{type:"FormattedText",markdown:"Name",weight:8},{type:"FormattedText",markdown:"Popularity",weight:1},{type:"FormattedText",markdown:"RSS",weight:1}]},{type:"Repeater",htmlClass:"results",container:{type:"MultiPagedContainer",id:"catalogPagedContainer",pageSize:10},noResultsChildren:[{type:"Title",customClass:"noResults",text:defaults.no_results_text||$.t("controls.browse.listing.no_results")}],children:[{type:"HorizontalContainer",htmlClass:"item {dataset.domainCName /.+/federated/ ||}",children:[{type:"Container",weight:8,children:[{type:"Picture",customClass:"largeImage",htmlClass:"datasetImage datasetIcon {dataset.preferredImageType}",url:"{dataset.preferredImage}",alt:"{dataset.name}",ifValue:"dataset.preferredImage"},{type:"SafeHtml",customClass:"largeImage",html:'<div class="datasetIcon type type{dataset.styleClass}" title="{dataset.displayName $[u]}"><span class="icon"></span></div>',ifValue:{key:"dataset.preferredImage",negate:!0}},{type:"Picture",customClass:"domainIcon",url:"/api/domains/{dataset.domainCName}/icons/smallIcon",alt:$.t("controls.browse.listing.federation_source",{source:"{dataset.domainCName}"}),ifValue:"dataset.domainCName"},{type:"Button",notButton:!0,customClass:"datasetLink",external:props.externalLinks,href:"/d/{dataset.id}",text:"{dataset.name ||(unnamed)}"},{type:"SafeHtml",customClass:"federationSource",html:$.t("controls.browse.listing.federation_source_html",{source_link:'<a href="https://{dataset.domainCName}">{dataset.domainCName}</a>'}),ifValue:"dataset.domainCName"},{type:"FormattedText",customClass:"description",markdown:"{dataset.description ||}"}]},{type:"FormattedText",weight:1,customClass:"views",markdown:"{dataset.viewCount %[,] || 0} "+$.t("core.analytics.visits")},{type:"SafeHtml",weight:1,customClass:"rss",html:'<a href="/api/views/{dataset.id}/rows.rss" title="'+$.t("controls.browse.actions.dataset_subscribe")+'"><div class="subscribe"><span class="icon"></span></div></a>'}]}]},{type:"EventConnector",sourceContextId:dcId,sourceEvent:"data_change",destComponentId:"catalogPager",transformations:[{sourceKey:"count",destProperty:"hidden",rules:[{result:!0,operator:"equals",value:0},{result:!1,operator:"not_equals",value:0}]}]},disabledItems.pagination?null:{type:"Pager",id:"catalogPager",pagedContainerId:"catalogPagedContainer",selectorStyle:"navigate",navigateStyle:"paging",navigateWrap:!1,showFirstLastPageLink:!0,navigateLinksAsButtons:!0}]}]}}}(jQuery)},1650:function(module,exports){"use strict";var $;($=jQuery).component.PagedContainer.extend("Multi-Paged Container","none",{countPages:function(){return $.isBlank(this._childCount)?this._pages.length:Math.ceil(this._childCount/this.pageSize())},pageSize:function(){return this._properties.pageSize||5},children:function(){return this._contentChildren},each:function(fn,scope){var result,cObj=this;return _.any(cObj._contentChildren,function(c){var r=fn.call(scope||cObj,c);if(void 0!==r)return result=r,!0}),result},empty:function(){this._super.apply(this,arguments),this._contentChildren=[]},add:function(child,position){if(child._parCont==this)return this._super.apply(this,arguments);this._contentChildren=this._contentChildren||[];var index=_.isNumber(position)?position:this._contentChildren.length;if(this._contentChildren[index]=child,$.isBlank(child.$dom)){var $existDom=this.$contents.children("#"+child.id+":visible");$existDom.length>0&&(child._carouselHidden=$existDom,$existDom.addClass("hide"))}var pageSize=this.pageSize(),pageIndex=Math.floor(index/pageSize);if($.isBlank(this._pages[pageIndex])&&this._super($.component.create(this._properties.container||{type:"Container"},this._componentSet),pageIndex),child._indexInPage=(index-pageIndex*pageSize)%pageSize,$.subKeyDefined(this,"_pages."+pageIndex+".$dom")){$.isBlank(child._carouselHidden)||child._carouselHidden.removeClass("hide");var p=this._pages[pageIndex],after=_.detect(p.children(),function(c){return c._indexInPage>child._indexInPage});p.add(child,after)}},_showPage:function(page){if(!page._initialized){var i=_.indexOf(this._pages,page),numItems=this.pageSize(),c=this._contentChildren.slice(i*numItems,(i+1)*numItems);_.each(c,function(_c){$.isBlank(_c._carouselHidden)||_c._carouselHidden.removeClass("hide")}),page.add(c)}this._super.apply(this,arguments)},_getPage:function(newPage,callback){newPage=parseInt(newPage);var cObj=this,p=cObj.pages();$.isBlank(p[newPage])?$.isBlank(cObj.parent)||cObj.parent.fetchChildren(newPage*cObj.pageSize(),cObj.pageSize(),function(items){_.each(items,function(item){cObj.add(item.row,item.index)}),callback(p[newPage])}):callback(p[newPage])},_moveChildDom:function(child){child._parCont==this&&this._super.apply(this,arguments)}})},1651:function(module,exports){"use strict";var $;($=jQuery).component.PagedContainer.extend("Carousel","none",{pause:function(){this._paused=!0,this._cancelSwitch()},resume:function(){delete this._paused,this._startSwitch()},_initDom:function(){var cObj=this;cObj._super.apply(cObj,arguments),cObj.$dom.hover(function(){cObj._properties.forceSwitch||cObj.pause()},function(){cObj._properties.forceSwitch||cObj.resume()})},_cancelSwitch:function(){$.isBlank(this._switchTimeout)||(clearTimeout(this._switchTimeout),delete this._switchTimeout)},_startSwitch:function(){var cObj=this;!cObj._paused&&_.isNumber(cObj._properties.switchInterval)&&$.isBlank(cObj._switchTimeout)&&(cObj._switchTimeout=setTimeout(function(){cObj.viewNext()},cObj._properties.switchInterval))},_getContainer:function(){var ct=$.tag({tagName:"div",class:"component-Carousel-container"});return this.$contents.append(ct),ct},_hidePage:function(page){var cObj=this;if(page.$dom.is(":visible")){var savedSuper=cObj._super;return function(doAnimate){doAnimate?(page.$dom.css({width:cObj.$ct.width(),position:"absolute",left:0}),page.$dom.animate({left:-cObj.$ct.width()},1e3,function(){page.$dom.css({position:"",width:""}),savedSuper(page),cObj._startSwitch()})):(savedSuper(page),cObj._startSwitch())}}this._super(page)},_showPage:function(page,finalCallback){var cObj=this,firstLoad=!page._rendered;$.isBlank(page.$dom)||page.$dom.stop(),cObj._super(page);var isAnimate=!1;firstLoad||!1===cObj._properties.animate||(cObj.$ct.height(cObj.$ct.height()),page.$dom.css({width:cObj.$ct.width(),position:"absolute",left:cObj.$ct.width()}),page.$dom.animate({left:0},1e3,function(){page.$dom.css({position:"",width:""}),cObj.$ct.css("height","")}),isAnimate=!0),cObj._startSwitch(),_.isFunction(finalCallback)&&finalCallback(isAnimate)},_arrange:function(){this._cancelSwitch(),this._super(),this.$ct.removeClass("hide"),this._startSwitch()}})},1652:function(module,exports){"use strict";var $;($=jQuery).component.Container.extend("Paged Container","none",{_init:function(){this._pages=[],this._super.apply(this,arguments),this.registerEvent({page_shown:"newPage",page_added:"pages",page_removed:"pages",page_count_changed:[]})},visibleId:function(newId){var newP;return $.isBlank(newId)||this.eachPage(function(p){p.id==newId&&(newP=p)}),(this._visiblePage(newP)||{}).id},visibleIndex:function(newIndex){var p=this.pages();if($.isBlank(newIndex))return _.indexOf(p,this._visiblePage());var cObj=this;cObj._getPage(newIndex,function(page){cObj._visiblePage(page)})},viewNext:function(preventWrap){var p=this.pages(),cp=this.countPages(),newI=_.indexOf(p,this._visiblePage())+1;if(!(preventWrap&&newI>=cp)){var cObj=this;cObj._getPage(newI%cp,function(page){cObj._visiblePage(page)})}},viewPrevious:function(preventWrap){var p=this.pages(),newI=_.indexOf(p,this._visiblePage())-1;if(!(preventWrap&&newI<0)){var cp=this.countPages(),cObj=this;cObj._getPage((newI+cp)%cp,function(page){cObj._visiblePage(page)})}},viewFirst:function(){if(0!=this.countPages()){var cObj=this;cObj._getPage(0,function(page){cObj._visiblePage(page)})}},viewLast:function(){var p=this.countPages();if(0!=p){var cObj=this;cObj._getPage(p-1,function(page){cObj._visiblePage(page)})}},pageSize:function(){return 1},count:function(){return $.isBlank(this._childCount)?this._super.apply(this,arguments):this._childCount},setCount:function(newCount){this._childCount=newCount,this.trigger("page_count_changed")},pages:function(){return this._pages},countPages:function(){return $.isBlank(this._childCount)?this._pages.length:this._childCount},eachPage:function(fn,scope){var result,cObj=this;return _.any(cObj._pages,function(p){var r=fn.call(scope||cObj,p);if(void 0!==r)return result=r,!0}),result},mapPage:function(fn,scope){var result=[];return this.eachPage(function(page){result.push(fn.call(scope,page))}),result},each:function(fn,scope){var result,cObj=this;return _.any(cObj._pages,function(c){var r=fn.call(scope||cObj,c);if(void 0!==r)return result=r,!0}),result},add:function(child,position,forceAdd){var r,$existDom,cObj=this;return forceAdd&&(child._domAdded=!0,r=this._super(child)),_.isArray(child)?(_.each(child,function(c){cObj.add(c)}),r):child._parCont==this?r:(child instanceof $.component.Component||(child=$.component.create(child,cObj._componentSet)),child instanceof $.component.FunctionalComponent?(this._funcChildren=this._funcChildren||[],this._funcChildren.push(child),null):($.isBlank(child.$dom)&&($existDom=this.$contents.children("#"+child.id)).length>0&&$existDom.addClass("hide"),child._parCont=this,_.isNumber(position)?this._pages[position]=child:this._pages.push(child),this.trigger("page_added",[{pages:[child]}]),r))},empty:function(){this.eachPage(function(child){delete child.parent,child.destroy()}),this.trigger("page_removed",[{pages:this._pages}]),this._pages=[],delete this._currentPage,this._super()},fetchAll:function(){var cObj=this;$.isBlank(cObj.parent)||cObj.parent.fetchChildren(0,cObj.count(),function(items){_.each(items,function(item){cObj.add(item.row,item.index)})})},_getPage:function(newIndex,callback){newIndex=parseInt(newIndex);var cObj=this,p=cObj.pages();$.isBlank(p[newIndex])?$.isBlank(cObj.parent)||cObj.parent.fetchChildren(newIndex,1,function(items){_.each(items,function(item){cObj.add(item.row,item.index)}),callback(p[newIndex])}):callback(p[newIndex])},_visiblePage:function(newPage){return $.isBlank(newPage)||newPage==this._currentPage||(this._currentPage=newPage,this._arrange()),this._currentPage},_hidePage:function(page){page.$dom.addClass("hide"),page.$contents.trigger("hide")},_showPage:function(page,finalCallback){page._initialized||this.add(page,null,!0),page.properties({height:this._properties.height,hidden:!1}),page._rendered||page._render(),page.$dom.removeClass("hide"),_.isFunction(page.each)&&page.each(function(child){child.$dom.removeClass("hide")}),this.trigger("page_shown",[{newPage:page}]),page.$contents.trigger("show"),$.component.sizeRenderRefresh(),_.isFunction(finalCallback)&&finalCallback()},_arrange:function(){var finalHide,cObj=this;if($.isBlank(cObj._currentPage)&&!_.isEmpty(cObj._pages)){if(cObj.$dom.children().addClass("hide"),$.subKeyDefined(cObj,"_properties.defaultPage")){var defPage=cObj._stringSubstitute(cObj._properties.defaultPage);if(cObj._currentPage=_.detect(cObj._pages,function(p){return p.id==defPage}),$.isBlank(cObj._currentPage)){var pageNum=parseInt(defPage);_.isNumber(pageNum)&&pageNum<cObj._pages.length&&pageNum>=0&&(cObj._currentPage=cObj._pages[pageNum])}}$.isBlank(cObj._currentPage)&&(cObj._currentPage=_.first(cObj._pages)),$.subKeyDefined(cObj,"_currentPage.$dom")&&cObj._currentPage.$dom.addClass("hide")}cObj.eachPage(function(page){if(page&&page!=cObj._currentPage&&!$.isBlank(page.$dom)){var callback=cObj._hidePage(page);$.isBlank(finalHide)?finalHide=callback:_.isFunction(callback)&&callback()}}),cObj._rendered&&(!$.isBlank(cObj._currentPage)&&cObj._currentPage.domOrAnyChildrenHidden()?cObj._showPage(cObj._currentPage,finalHide):_.isFunction(finalHide)&&finalHide()),cObj._super()},_childRemoved:function(child){this._super.apply(this,arguments),this.trigger("page_removed",[{pages:[child]}])},_moveChildDom:function(child){this._initialized?child._domAdded&&(child._initialized||(child._initDom(),child.$dom.addClass("hide"),this._designing&&child.design(!0)),$.subKeyDefined(child,"next.$dom")&&child.next.$dom.parent().index(this.$ct)>=0?child.next.$dom.before(child.$dom):$.isBlank(this.$ct)||this.$ct.append(child.$dom)):child._initialized&&child.$dom.remove()},_testChildHit:function(child,pos,inSequence){var childOffset=child.$dom.offset();return inSequence&&childOffset.left>pos.x||childOffset.left<=pos.x&&childOffset.left+child.$dom.outerWidth(!0)>=pos.x},_dropCursorDirection:function(){return"vertical"}})},1653:function(module,exports){"use strict";!function($){$.component.Container.extend("List Item Container","none",{_itemClass:"liWrapper",_getContainer:function(){if($.isBlank(this.$ct)){var tag=getListTag(this);this.$ct=this.$contents.children(tag),1!=this.$ct.length&&(this.$ct=$.tag({tagName:tag,class:this._stringSubstitute(this._properties.listCustomClass)}),this.$contents.append(this.$ct))}return this.$ct},_moveChildDom:function(child){if(child._initialized||(child._initDom(),this._designing&&child.design(!0)),!child.$wrapper){var itemTag=getItemTag(this,child),$w=child.$dom.parent(itemTag);$w.length<1?(child.$wrapper=$.tag({tagName:itemTag,class:this._itemClass}),child.$wrapper.append(child.$dom)):child.$wrapper=$w}$.subKeyDefined(child,"next.$wrapper")&&child.next.$wrapper.parent().index(this.$ct)>=0?child.next.$wrapper.parent()[0].insertBefore(child.$wrapper[0],child.next.$wrapper[0]):$.isBlank(this.$ct)||this.$ct[0].appendChild(child.$wrapper[0]),child.$wrapper.parent().length>0&&this._rendered&&!child._rendered&&child._render(),this._arrange()},_removeChildDom:function(child){child.$wrapper&&(child.$wrapper.detach(),delete child.$wrapper),this._arrange()},_arrange:function(){var cObj=this;cObj._blockArrange||(cObj.each(function(child){if(!$.isBlank(child.$wrapper)){var itemTag=getItemTag(cObj,child);if(itemTag!=child.$wrapper.tagName()){var $oldW=child.$wrapper;child.$wrapper=$.tag({tagName:itemTag}),child.$wrapper.append(child.$dom),cObj.$ct.append(child.$wrapper),$oldW.remove()}child.$wrapper.removeClass(),child.$wrapper.addClass(cObj._itemClass),$.subKeyDefined(cObj._properties,"itemCustomClass")&&child.$wrapper.addClass(child._stringSubstitute(this._properties.itemCustomClass))}}),cObj._super())},_propWrite:function(properties){var $oldCt;properties.listTag!=this._properties.listTag?($oldCt=this.$ct,this.$ct.detach(),delete this.$ct,this._initialized=!1):properties.listCustomClass!=this._properties.listCustomClass&&this.$ct.removeClass(this._stringSubstitute(this._properties.listCustomClass)),this._super.apply(this,arguments),$.isBlank($oldCt)?this.$ct.addClass(this._stringSubstitute(this._properties.listCustomClass)):(this._initDom(),this.$ct.append($oldCt.children())),this._arrange()}});var getItemTag=function(cObj,child){return child._stringSubstitute(cObj._properties.itemTag)||{ul:"li",ol:"li",dl:"dd"}[getListTag(cObj)]||"div"},getListTag=function(cObj){return cObj._properties.listTag||"ul"}}(jQuery)},1654:function(module,exports){"use strict";!function($){$.component.FunctionalComponent.extend("EventConnector","functional",{_propWrite:function(properties){var cObj=this,oldEvent=cObj._properties.sourceEvent,parSuper=cObj._super,doUpdate=function(){var origTransforms=$.extend(!0,[],properties.transformations);parSuper.call(cObj,cObj._stringSubstitute(properties));var srcCompId=(cObj._properties.parentPrefix||"")+cObj._properties.sourceComponentId;srcCompId!=(cObj._sourceComponent||{}).id&&($.isBlank(cObj._sourceComponent)||cObj._sourceComponent.unbind(null,null,cObj),$.isBlank(srcCompId)||(cObj._sourceComponent=$.component(srcCompId,cObj._componentSet)),oldEvent=null);var srcContextId=cObj._properties.sourceContextId;srcContextId!=(cObj._sourceContext||{}).id?($.isBlank(cObj._sourceContext)||cObj._sourceContext.unbind(null,null,cObj),delete cObj._sourceContext,$.isBlank(srcContextId)||$.dataContext.getContext(cObj._properties.sourceContextId,function(sc){cObj._sourceContext=sc,"dataset"==sc.type?eventChanged(cObj,cObj._sourceContext.dataset,oldEvent,origTransforms):eventChanged(cObj,cObj._sourceContext,oldEvent,origTransforms)}),oldEvent=null):$.isBlank(cObj._sourceContext)||oldEvent==cObj._properties.sourceEvent||eventChanged(cObj,"dataset"==cObj._sourceContext.type?cObj._sourceContext.dataset:cObj._sourceContext,oldEvent,origTransforms),oldEvent==cObj._properties.sourceEvent||$.isBlank(cObj._sourceComponent)||eventChanged(cObj,cObj._sourceComponent,oldEvent,origTransforms);var destCompId=(cObj._properties.parentPrefix||"")+cObj._properties.destComponentId;destCompId!=(cObj._destComponent||{}).id&&(cObj._destComponent=$.component(destCompId,cObj._componentSet),$.isBlank(cObj._destComponent)||cObj._destComponent.$dom.attr("aria-live","polite")),cObj._properties.destContextId!=(cObj._destContext||{}).id&&(delete cObj._destContext,$.dataContext.getContext(cObj._properties.destContextId,function(dc){cObj._destContext=dc}))};cObj._updateDataSource(properties,doUpdate)||doUpdate()}});var eventChanged=function(cObj,sourceItem,oldEvent,origTransforms){sourceItem.unbind(oldEvent,null,cObj),sourceItem.bind(cObj._properties.sourceEvent,function(args){if(args=args||sourceItem,!$.isBlank(cObj._destComponent)){var p={};_.each(cObj._properties.transformations,function(t){$.deepSet.apply($,[p,getValue(t,args)].concat(t.destProperty.split(".")))}),cObj._destComponent.properties(p)}$.subKeyDefined(cObj,"_destContext.dataset")&&_.each(origTransforms,function(origT){var t={};_.each(origT,function(value,key){key.startsWith("dest")?t[key]=cObj._stringSubstitute(value,cObj._destContext):t[key]=cObj._stringSubstitute(value)});var colParts=t.destColFilter.split(":"),dc=cObj._destContext.dataset.columnForIdentifier(colParts[0]);if(!$.isBlank(dc)){var v=getValue(t,args);if(colParts.length>2){for(var o={},orig=o,i=2;i<colParts.length-1;i++)o[colParts[i]]={},o=o[colParts[i]];o[colParts[i]]=v,v=orig}dc.filter(v,colParts[1],t.destOperator)}})},cObj)},getValue=function(trans,args){var v,row,col;if($.isBlank(trans.sourceColumn)||$.isBlank(args.row)||!$.subKeyDefined(args,"dataContext.dataset"))$.isBlank(trans.sourceKey)||(v=$.deepGet.apply($,[args].concat(trans.sourceKey.split("."))));else if(col=args.dataContext.dataset.columnForIdentifier(trans.sourceColumn),$.isBlank(col))row=args.row;else if(v=args.row.data[col.lookup],!$.isBlank(trans.sourceValue))for(var keys=trans.sourceValue.split("."),i=0;i<keys.length&&(_.isString(v)&&(v=JSON.parse(v)),!$.isBlank(v));i++)v=v[keys[i]];return _.detect(trans.rules,function(r){var expr={operator:r.operator,value:r.value};$.isBlank(col)||(expr.columnFieldName=col.columnFieldName);var matches=blist.filter.matchesExpression(expr,(args.dataContext||{}).dataset)(row||v);return matches&&(v=r.result),matches}),_.isUndefined(v)?null:v}}(jQuery)},1655:function(module,exports){"use strict";$.cf={},$(function(){$.cf.top=function(){var $editLink=$.tag({tagName:"a",href:"#edit",class:"cfEditSwitch",title:"Edit Page"});$(document.body).append($editLink);var loading=!1,initializeEditMode=function(){if($.subKeyDefined($.cf,"edit"))$.cf.edit(!0);else if(!loading){loading=!0,$(".socrata-page").loadingSpinner().showHide(!0);var stylesheets=[{assets:"colorpicker"},{assets:"base-control-third-party"},{assets:"base-control"},{assets:"configurator"}],translations=[{key:"dataslate",force:!0},"controls.common.sidebar.tabs"];blist.configuration.govStat?translations.push("govstat.reports.component"):stylesheets.unshift({sheet:"/webfonts/ss-standard.css",hasFonts:!0}),blist.util.assetLoading.loadAssets({javascripts:[{assets:"configurator"},{assets:"shared-editors"}],stylesheets:stylesheets,translations:translations,templates:["grid_sidebar"],newModals:["configurator_permissions","configurator_settings"],modals:["select_dataset?federate=true"]},function(){$(".socrata-page").loadingSpinner().showHide(!1),$.cf.initialize(),loading=!1},function(){$(window).trigger("resize")})}};$editLink.click(function(e){e.preventDefault(),initializeEditMode()}),blist.configuration.immediateEdit&&initializeEditMode()},blist.configuration.onCurrentUser(function(user){blist.configuration.designerEnabled&&!$.isBlank(user)&&(user.hasRight(blist.rights.user.EDIT_PAGES)||user.id==blist.configuration.page.owner||user.id==(blist.configuration.page.owner||{}).id)&&($(document.body).addClass("socrata-page"),$.cf.top(),_.defer(function(){$(document.body).addClass("configurable")}))})})},1656:function(module,exports){"use strict";var $;($=jQuery).component.Component.extend("Container","content",{_init:function(){var props=arguments[0];this._childrenToLoad=props.children,delete props.children,this._super.apply(this,arguments)},_initDom:function(){this._super(),this.$ct=this._getContainer(),this.$ct.addClass("socrata-container"),this._addChildren()},add:function(child,position){if(!$.isBlank(child)){if($.isArray(child)){if(!this._blockArrange)var arrange=this._blockArrange=!0;var result=_.map(child.slice(),function(c){return this.add(c,position)},this);return arrange&&(this._blockArrange=!1,this._arrange()),result}return child instanceof $.component.Component||(child=$.component.create(child,this._componentSet)),child instanceof $.component.FunctionalComponent?(this._funcChildren=this._funcChildren||[],this._funcChildren.push(child),null):(this._visibility||child.hide(),child._move(this,position),child)}},_addChildren:function(){$.isBlank(this._childrenToLoad)||(this.add(this._childrenToLoad),delete this._childrenToLoad)},_move:function(){this._super.apply(this,arguments),this._addChildren()},_childMoved:function(child,oldParent,oldPrev,oldNext){this.first?(this.first==child?child.prev&&(this.first=oldNext):child.prev||(this.first=child),this.last==child?child.next&&(this.last=oldPrev):child.next||(this.last=child)):this.first=this.last=child,oldParent==this&&oldNext==child.next||!this._initialized||this._moveChildDom(child)},_childRemoved:function(child,oldPrev,oldNext){this.first==child&&(this.first=oldNext),this.last==child&&(this.last=oldPrev),this._removeChildDom(child)},_moveChildDom:function(child){if(this._initialized){child._initialized||(child._initDom(),this._designing&&child.design(!0)),$.subKeyDefined(child,"next.$dom")&&child.next.$dom.parent().index(this.$ct)>=0?child.next.$dom.parent()[0].insertBefore(child.$dom[0],child.next.$dom[0]):!$.isBlank(this.$ct)&&(child.$dom.parent().index(this.$ct)<0||child.hasOwnProperty("next")&&$.isBlank(child.next))&&this.$ct[0].appendChild(child.$dom[0]),child.$dom.parent().length>0&&this._rendered&&!child._rendered&&child._render();var cObj=this;child.bind("shown",function(){cObj._arrange()},this),child.bind("hidden",function(){cObj._arrange()},this),this._arrange()}else child._initialized&&$(child.dom).detach()},_removeChildDom:function(child){this._initialized&&(child.$dom.detach(),child.unbind(null,null,this),this._arrange())},each:function(fn,scope){for(var child=this.first;child;){var result=fn.call(scope||this,child);if(void 0!==result)return result;child=child.next}},map:function(fn,scope){var result=[];return this.each(function(child){result.push(fn.call(scope,child))}),result},children:function(){return this.map(function(child){return child})},count:function(){var count=0;return this.each(function(){count++}),count},visit:function(fn,scope){this.each(function(child){fn.call(this,child),child.visit&&child.visit(fn,scope)},scope)},destroy:function(){this.empty(),this._super()},empty:function(){this.each(function(child){delete child.parent,child.destroy()}),delete this.first,delete this.last,$.isBlank(this.$contents)||this.$contents.empty(),_.each(this._funcChildren,function(c){c.destroy()}),delete this._funcChildren},setVisibility:function(){var origArgs=arguments;this._super.apply(this,origArgs),this.each(function(c){c.setVisibility.apply(c,origArgs)})},fetchChildren:function(){},_render:function(){return!!this._super()&&(this.each(this._moveChildDom,this),this._arrange(),!0)},_getContainer:function(){return this.$contents},_propRead:function(){var properties=this._super(),children=this._readChildren();return children&&(properties.children=children),properties},_readChildren:function(){var children=[];return this.each(function(child){child&&children.push(child.properties())}),_.each(this._funcChildren,function(child){child&&children.push(child.properties())}),children},_shown:function(){this._super(),this.each(function(child){child._shown()})},_hidden:function(){this._super(),this.each(function(child){child._hidden()})},domOrAnyChildrenHidden:function(){var domIsBlankOrHidden=$.isBlank(this.$dom)||this.$dom.hasClass("hide"),anyChildIsHidden=_.any(this.children()||[],function(child){return child&&child.$dom&&child.$dom.hasClass("hide")});return domIsBlankOrHidden||anyChildIsHidden},_propWrite:function(properties){if(this._super(properties),properties.children){for(;this.first;)this.first.destroy();this.add(properties.children)}},_arrange:function(){this.each(function(child){child&&child._arrange&&child._arrange()}),this._super(),$.isBlank(this.$dom)||this.$dom.trigger("canvas_container_updated")},design:function(designing){var cObj=this;this._super.apply(this,arguments),this.each(function(child){child.design(designing)}),$.isBlank(this.$dom)||!this.canEdit("drop")||this.$dom.isControlClass("nativeDropTarget")?!$.isBlank(this.$dom)&&this.$dom.isControlClass("nativeDropTarget")&&(designing?this.$dom.nativeDropTarget().enable():this.$dom.nativeDropTarget().disable()):designing&&this.$dom.nativeDropTarget({contentEditable:!1,acceptCheck:function($item){return!$item.find(cObj.$dom).exists()&&$item[0]!=cObj.$dom[0]&&"MapLayer"!=$item.data("typename")&&($item.hasClass("socrata-component")||$item.hasClass("componentCreate"))},dragOverCallback:function(){return cObj._handleDragOver.apply(cObj,arguments)},dragLeaveCallback:function(){$.isBlank(cObj._$dropCursor)||cObj._$dropCursor.addClass("hide"),_.defer(function(){delete cObj._dropPosition,delete cObj._dropChild})},dropCallback:function(dropId,dropType){if($.isBlank(cObj._$dropCursor)||cObj._$dropCursor.addClass("hide"),"move"==dropType){var moveComp=$.component(dropId,cObj._componentSet);$.isBlank(moveComp)||moveComp.parent==cObj&&(moveComp==cObj._dropPosition||moveComp.next==cObj._dropPosition)||$.cf.edit.execute("move",{newContainer:cObj,newPosition:cObj._dropPosition,oldContainer:moveComp.parent,oldPosition:moveComp.next,child:moveComp})}else"copy"==dropType&&($.cf.edit.beginTransaction(),$.cf.edit.execute("add",{container:cObj,position:cObj._dropPosition,childTemplate:{type:dropId}}))}})},_handleDragOver:function(pos,dropInfo){if($.isBlank(this._dropChild)||this._testChildHit(this._dropChild,pos)||delete this._dropChild,$.isBlank(this._dropChild)&&(this._dropChild=this._getDropChild(pos)),$.isBlank(this._dropChild))this._dropPosition=null;else{var targetOrientation=this._getDropOrientation(this._dropChild,pos);if(this._dropPosition=this._getDropPosition(this._dropChild,targetOrientation),"move"==dropInfo.type){var moveChild=$.component(dropInfo.id,this._componentSet);if(!$.isBlank(moveChild)&&moveChild.parent==this&&(this._dropPosition==moveChild||this._dropPosition==moveChild.next))return delete this._dropPosition,delete this._dropChild,$.isBlank(this._$dropCursor)||this._$dropCursor.addClass("hide"),!1}this._drawDropCursor(this._dropChild,targetOrientation)}},_getDropChild:function(pos){var lastChild,cObj=this,result=cObj.each(function(child){if(cObj._testChildHit(child,pos,!0))return child;lastChild=child});return $.isBlank(result)&&!$.isBlank(lastChild)?lastChild:result},_testChildHit:function(child,pos,inSequence){var childOffset=child.$dom.offset();return inSequence&&childOffset.top>pos.y||childOffset.top<=pos.y&&childOffset.top+child.$dom.outerHeight(!0)>=pos.y},_getDropOrientation:function(child,pos){var offs=child.$dom.offset(),mpX=offs.left+child.$dom.outerWidth(!0)/2;return{vPos:offs.top+child.$dom.outerHeight(!0)/2>=pos.y?"top":"bottom",hPos:mpX>=pos.x?"left":"right"}},_getDropPosition:function(child,targetOrientation){var cursorDir=this._dropCursorDirection();return"horizontal"==cursorDir&&"top"==targetOrientation.vPos||"vertical"==cursorDir&&"left"==targetOrientation.hPos?child:child.next},_drawDropCursor:function(child,targetOrientation){$.isBlank(this._$dropCursor)&&(this._$dropCursor=$.tag({tagName:"div",class:"dropCursor"}),this.$dom.append(this._$dropCursor));var direction=this._dropCursorDirection();this._$dropCursor.removeClass("horizontal vertical hide").addClass(direction);var side,pos=0;switch(direction){case"horizontal":side="top","bottom"==targetOrientation.vPos&&(pos=child.$dom.outerHeight());break;case"vertical":side="left","right"==targetOrientation.hPos&&(pos=child.$dom.outerWidth())}pos+=child.$dom.offset()[side]-this.$dom.offset()[side],this._$dropCursor.css(side,pos)},_dropCursorDirection:function(){return"horizontal"},listTemplateSubstitutions:function(list){this._super(list),this.each(function(child){child.listTemplateSubstitutions(list)})}}),$.component.Container.extend("Horizontal Container","content",{_initDom:function(){this._super.apply(this,arguments);var $clear=this.$dom.children(".socrata-ct-clear");$clear.length<1?(this.$dom.append('<div class="socrata-ct-clear"></div>'),$clear=$(this.dom.lastChild)):$clear.is(":last-child")||this.$dom.append($clear),this._$clear=$clear},_moveChildDom:function(child){if(child._initialized||(child._initDom(),this._designing&&child.design(!0)),!child.wrapper){var $w=child.$dom.parent(".component-wrapper");$w.length<1?(child.wrapper=document.createElement("div"),child.wrapper.className="component-wrapper",child.wrapper.appendChild(child.dom),child.$wrapper=$(child.wrapper)):(child.$wrapper=$w,child.wrapper=$w[0])}$.subKeyDefined(child,"next.$wrapper")&&child.next.$wrapper.parent().index(this.$ct)>=0?child.next.$wrapper.parent()[0].insertBefore(child.$wrapper[0],child.next.$wrapper[0]):$.isBlank(this._$clear)?$.isBlank(this.$ct)||this.$ct[0].appendChild(child.$wrapper[0]):this._$clear.parent()[0].insertBefore(child.$wrapper[0],this._$clear[0]),child.$wrapper.parent().length>0&&this._rendered&&!child._rendered&&child._render();var cObj=this;child.bind("shown",function(){cObj._arrange()},this),child.bind("hidden",function(){cObj._arrange()},this),this._arrange()},_removeChildDom:function(child){child.$wrapper&&(child.$wrapper.detach(),delete child.wrapper,delete child.$wrapper,child.unbind(null,null,this)),this._arrange()},_arrange:function(){var cObj=this;if(!this._blockArrange){this._initialized&&this.$contents.toggleClass("inlineDisplay",!!this._properties.inlineDisplay);var visibleChildren=[],totalWeight=0;this.each(function(child){!child._isHidden&&child._isRenderable()&&(visibleChildren.push(child),totalWeight+=child.properties().weight||1)});var pos=0;_.each(visibleChildren,function(child){var isWrapped=$.subKeyDefined(child,"$wrapper");if(cObj._properties.inlineDisplay)isWrapped&&child.$wrapper.css({marginLeft:0,width:"auto"});else{var weight=child.properties().weight||1;isWrapped&&child.$wrapper.css({marginLeft:-(100-pos/totalWeight*100)+"%",width:weight/totalWeight*100+"%"}),pos+=weight}}),this._super(),visibleChildren.length>0&&($(this.dom).children("first-child").removeClass("first-child"),$(_.first(visibleChildren).wrapper).addClass("first-child"))}},_testChildHit:function(child,pos,inSequence){var childOffset=child.$dom.offset();return inSequence&&childOffset.left>pos.x||childOffset.left<=pos.x&&childOffset.left+child.$dom.outerWidth(!0)>=pos.x},_dropCursorDirection:function(){return"vertical"}}),$.extend($.component.Container,{wrap:function(child,wrapperConfig){var parent=child.parent;if(!parent)throw new Error("Cannot wrap unparented child");var position=child.next;parent._blockArrange=!0;try{void 0===wrapperConfig.weight&&(wrapperConfig.weight=child.properties().weight);var wrapper=$.component.create(wrapperConfig,this._componentSet);wrapper.add(child),parent.add(wrapper,position),parent._blockArrange=!1,parent._arrange()}finally{parent._blockArrange=!1}return wrapper},unwrap:function(child){if(child.prev||child.next)throw new Error("Cannot unwrap child with siblings");var wrapper=child.parent;if(!wrapper)throw new Error("Cannot unwrap unparented child");var parent=wrapper.parent;if(!wrapper)throw new Error("Cannot unwrap child with root parent");parent._blockArrange=!0;try{parent.add(child,wrapper.next),wrapper.destroy(),parent._blockArrange=!1,parent._arrange()}finally{parent._blockArrange=!1}}})},1657:function(module,exports){"use strict";!function($){var nextAutoID=1,componentSets={__primary:{}},roots={},winSpin=$("body").loadingSpinner({metric:"dataslate-global"}),wsCounter=0;var queryParams,envItems,Component=Model.extend({_init:function(properties,componentSet){var cObj=this;if(cObj._super.apply(this,arguments),cObj._eventKeys={},cObj.registerEvent({start_loading:[],finish_loading:[],update_properties:[],shown:[],hidden:[]}),cObj._visibility=!0,cObj._componentSet=componentSet||"__primary",cObj._updateProperties(properties),cObj.id=cObj._properties.id,cObj.id){if("c"==cObj.id.charAt(0)){var sequence=parseInt(cObj.id.substring(1));sequence>=nextAutoID&&(nextAutoID=sequence+1)}}else cObj.id=$.component.allocateId();if(componentSets[cObj._componentSet][cObj.id])throw new Error("Duplicate component ID in "+cObj._componentSet+": "+cObj.id);componentSets[cObj._componentSet][cObj.id]=cObj,cObj._isDirty=!0,_.isFunction(cObj._dataReady)&&_.defer(function(){cObj._updateDataSource(properties,cObj._dataReady)});var assets=cObj._getAssets();_.isEmpty(assets)||(cObj._loadingAssets=!0,cObj.startLoading(),blist.util.assetLoading.loadAssets(assets,function(){cObj.finishLoading(),delete cObj._loadingAssets,cObj._assetsAvailable(),cObj._needsRender&&_.defer(function(){cObj._render()}),cObj._needsEdit&&_.defer(function(){cObj.edit(!0)})},function(){cObj._stylesLoaded()})),cObj._properties.setup&&(_.each(cObj._properties.setup,function(definitions,key){var props={};_.each(definitions,function(template,propName){template.type||(template.type="StringResolver");var resolver=$.component.create(template,cObj._componentSet);props[propName]=resolver.asString()}),cObj[key](props)}),delete properties.setup),_.defer(function(){$.component.globalNotifier.trigger("component_added",[cObj])})},isValid:function(){return!0},startLoading:function(){this._loadingSuspended||$.isBlank(this.$dom)||(this._lsInit?this.$dom.loadingSpinner().showHide(!0):(this.$dom.loadingSpinner({metric:"dataslate-component",showInitially:!0,minimal:!0}),this._lsInit=!0)),this._loading||(this._loading=!0,this.trigger("start_loading"),wsCounter<1&&winSpin.showHide(!0),wsCounter++)},finishLoading:function(){!$.isBlank(this.$dom)&&this._lsInit&&this.$dom.loadingSpinner().showHide(!1),this._loading&&(this._loading=!1,this.trigger("finish_loading"),--wsCounter<1&&winSpin.showHide(!1),this._updateValidity())},suspendLoading:function(doSuspend){this._loadingSuspended=doSuspend,this._loading&&($.isBlank(this.$dom)||(this._lsInit?this.$dom.loadingSpinner().showHide(!doSuspend):doSuspend||(this.$dom.loadingSpinner({metric:"dataslate-component",showInitially:!0}),this._lsInit=!0)))},destroy:function(){this.remove(),$.isBlank(this.$dom)||this.$dom.remove(),delete componentSets[this._componentSet][this.id],this._destroyed=!0;var cObj=this;_.defer(function(){$.component.globalNotifier.trigger("component_removed",[cObj])})},properties:function(_properties){return _properties&&this._propWrite(_properties),this._propRead()},remove:function(){var parent=this.parent;if($(window).unbind("scroll.component-"+this.id),parent){this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev);var prev=this.prev,next=this.next;delete this.parent,delete this.prev,delete this.next,parent._childRemoved(this,prev,next)}},design:function(designing){this._designing=designing,this.properties({__hidden:!1}),$.isBlank(this.$dom)||(designing&&this.canEdit("drag")&&!this.$dom.isControlClass("nativeDraggable")&&this.$dom.nativeDraggable({dropId:this.id,dropType:"move",startDisabled:!0}),!designing&&this.$dom.isControlClass("nativeDraggable")&&this.$dom.nativeDraggable().disable())},dragFocus:function(isFocus){this.$dom.isControlClass("nativeDraggable")&&(isFocus?this.$dom.nativeDraggable().enable():this.$dom.nativeDraggable().disable())},select:function(selected){this._selected=selected,this._updateSelectedIcons(),this.$dom.toggleClass("cf-selected",this._selected),this.canEdit("resize")&&(selected?this.$dom.hasClass("ui-resizable")?this.$dom.children(".ui-resizable-handle").show():(this.$dom.resizable({handles:"s",start:_.bind(this._onUiResizableResizeStart,this),stop:_.bind(this._onUiResizableResizeStop,this),zIndex:3001}),this.$dom.find(".socrata-component .ui-resizable-handle").hide()):this.$dom.hasClass("ui-resizable")&&this.$dom.children(".ui-resizable-handle").hide())},edit:function(editing){var cObj=this;if(editing==(cObj._editing||!1))return!1;if(!editing||cObj._disableEditCapture||cObj._boundEditEvent||(cObj.$contents.click(function(e){(cObj._editing||cObj._needsEdit)&&e.preventDefault()}),cObj._boundEditEvent=!0),cObj._loadingAssets||cObj._loadingEditAssets)return cObj._needsEdit=!0,!1;if(editing&&!cObj._loadedEditAssets){cObj._loadedEditAssets=!0;var assets=cObj._getEditAssets();if(!_.isEmpty(assets))return cObj._loadingEditAssets=!0,cObj._needsEdit=!0,cObj.startLoading(),blist.util.assetLoading.loadAssets(assets,function(){cObj.finishLoading(),delete cObj._loadingEditAssets,cObj._needsEdit&&_.defer(function(){cObj.edit(!0),cObj._isActiveEdit&&$.cf.side.enableProperties(!0)})}),!1}if(delete cObj._needsEdit,cObj._editing=editing,cObj._supportsCustomEditors()&&cObj._properties.editor){if(editing){cObj._prepareCustomEdit(),cObj.$customEditContents=$.tag({tagName:"div",class:"socrata-component-edit"}),cObj.$contents.append(cObj.$customEditContents);var props=$.extend(!0,{},cObj._properties.editor,{value:cObj.asString(),type:blist.datatypes[cObj._properties.editor.dataType]});cObj._customEditor=cObj.$customEditContents.blistEditor(props)}else cObj._customEditor.finishEdit(),cObj._customEditFinished(cObj._customEditor),cObj.$customEditContents.remove();return!1}return!0},isEditing:function(){return this._editing},canEdit:function(type){if(this._locked||this._properties.locked||!$.isBlank(this.parent)&&!this.parent.canEdit("locked"))return!1;switch(type){case"resize":return!$.isBlank(this.parent);case"drag":case"drop":case"locked":return!0;default:return!this._editDisabled&&!this._properties.editDisabled}},editFocus:function(focused){return focused!=(this._focused||!1)&&(this._focused=focused,!!focused||(!this._supportsCustomEditors()||!this._properties.editor||(this._updatePrimaryValue(this._customEditor.currentValue()),!1)))},hide:function(){this.setVisibility(!1)},show:function(){this.setVisibility(!0)},setVisibility:function(isVisible){this._visibility=isVisible,this._propWrite({})},_stylesLoaded:function(){},_updatePrimaryValue:function(value){var propKey=this._valueKey(),properties={};$.isBlank(propKey)||this._properties[propKey]==value||(properties[propKey]=value,this._executePropertyUpdate(properties))},_executePropertyUpdate:function(properties){$.cf.edit.execute("properties",{component:this,properties:properties}),$.cf.edit.commit()},_prepareCustomEdit:function(){this.$contents.empty()},_updateSelectedIcons:function(){var cObj=this;$.isBlank(cObj._$editIcon)&&(cObj._$editIcon=$.tag2({_:"a",className:["actionIcon","editIcon","ss-write"],href:"#",title:$.t("dataslate.component.edit")}),cObj.$dom.append(cObj._$editIcon),cObj._$editIcon.click(function(e){e.preventDefault(),$.cf.focus(cObj)})),cObj.$dom.toggleClass("editActive",!$.isBlank(cObj.parent)&&cObj._selected),$.isBlank(cObj._$removeIcon)&&(cObj._$removeIcon=$.tag2({_:"a",className:["actionIcon","removeIcon","ss-delete"],href:"#",title:$.t("dataslate.component.remove")}),cObj.$dom.append(cObj._$removeIcon),cObj._$removeIcon.click(function(e){e.preventDefault(),$.cf.blur(!0),$.cf.edit.execute("remove",{component:cObj,container:cObj.parent,position:cObj.next})})),cObj.$dom.toggleClass("removeActive",!$.isBlank(cObj.parent)&&cObj._selected)},_stringSubstitute:function(obj,resolver){return $.stringSubstitute(obj,resolver||this._propertyResolver(),this._substitutionHelpers())},_evalIf:function(ifValue){var cObj=this;return _.all($.makeArray(ifValue),function(v){var r=!$.isBlank(cObj._stringSubstitute("{"+(v.key||v)+" ||}"));return v.negate&&(r=!r),r})},_valueKey:function(){},setActiveEdit:function(isActive){this._isActiveEdit=isActive},configurationSchema:function(){return!this._loadingAssets&&!this._loadingEditAssets&&null},registerEvent:function(evHashes){var cObj=this;if(!$.isPlainObject(evHashes))throw new Error("registerEvent requires a hash of event names to array of field names");var evNames=[];return _.each(evHashes,function(fields,name){evNames.push(name),cObj._eventKeys[name]=$.makeArray(fields)}),cObj._super(evNames)},getEvents:function(){return this._eventKeys},_getAssets:function(){return null},_assetsAvailable:function(){},_getEditAssets:function(){return null},_initDom:function(){var domId=("__primary"==this._componentSet?"":this._componentSet+"_")+this.id,$dom=this.$dom;if($.isBlank($dom)&&($dom=$("#"+domId)),$dom.length<1&&($dom=$.tag({tagName:"div",id:domId})),$.isBlank(this.$dom)&&(this.$dom=$dom,this.dom=$dom[0],this.dom._comp=this,this.$dom.addClass("socrata-component component-"+this.typeName+" "+(this._properties.customClass||"")+" "+(this._isHidden?"hide":"")),this._needsOwnContext?(this.$contents=this.$dom.children(".content-wrapper"),this.$contents.length<1&&(this.$contents=$.tag({tagName:"div",class:"content-wrapper"}),this.$dom.append(this.$contents))):this.$contents=this.$dom,$.isBlank(this._properties.htmlClass)||this.$contents.addClass($.makeArray(this._properties.htmlClass).join(" ")),this._loading&&this.startLoading(),this._updateValidity(),this._delayUntilVisible)){var cObj=this;_.defer(function(){var sp=cObj.$dom.scrollParent()[0];cObj.$dom.waypoint({delayRefresh:!0,offset:"100%",checkTop:!0,context:9==sp.nodeType?window:sp,handler:function(){cObj.$dom.parent().exists()&&(delete cObj._delayUntilVisible,cObj.$dom.waypoint("destroy"),!cObj._destroyed&&cObj._needsRender&&cObj._render())}})})}if(this.parent||this._resizeBound)this._resizeBound||(this.$contents.resize(function(e){e.stopPropagation()}),this._resizeBound=!0);else{var self=this;$(window).bind("resize",function(e,source){source!=$.component&&self._arrange()}),this._resizeBound=!0}this._initialized=!0},_isRenderable:function(){return!0},_supportsCustomEditors:function(){return!1},_getNumericalProperty:function(propName,onValidValue,onInvalidValue){var value=this._properties[propName],parsed=parseInt(value);return _.isNaN(parsed)?_.isFunction(onInvalidValue)?onInvalidValue(value,propName):_.isUndefined(onInvalidValue)?null:onInvalidValue:_.isFunction(onValidValue)?onValidValue(parsed,propName):_.isUndefined(onValidValue)?parsed:onValidValue},_getNumericalPropertyWithFallback:function(propName,onInvalidValue){this._getNumericalProperty(propName,void 0,onInvalidValue)},_onUiResizableResizeStart:function(){},_onUiResizableResizeStop:function(){this._executePropertyUpdate({height:this.$dom.height()})},_applyHeightProperties:function(){var cObj=this,applyFunc=function(value,propName){cObj.$dom.css(propName,value)},unApplyFunc=function(value,propName){applyFunc("",propName)};this._getNumericalProperty("height",applyFunc,unApplyFunc),this._getNumericalProperty("minHeight",applyFunc,unApplyFunc),this._getNumericalProperty("maxHeight",applyFunc,unApplyFunc)},_render:function(){var cObj=this;if(!this._isRenderable()||!this._isDirty)return!1;if(this._initDom(),this.$dom.hasClass("serverRendered")&&(this.$dom.removeClass("serverRendered"),!this._designing&&!this._properties.requiresContext))return this._rendered=!0,this._isDirty=!1,delete this._needsRender,!1;if(this._applyHeightProperties(),this._loadingAssets||this._isHidden||this._delayUntilVisible)return this._needsRender=!0,!1;if(cObj._properties.forceContext&&$.isBlank(cObj._dataContext)&&(cObj._needsRender=!0,cObj._updateDataSource(cObj._properties,function(){cObj._render()})))return!1;if(cObj._properties.requiresContext||cObj._properties.ifValue||!$.isBlank(cObj._properties.htmlClass)||!_.isEmpty(cObj._properties.htmlAttributes)||!_.isEmpty(cObj._properties.styles)||!_.isEmpty(cObj._properties.styleDimensions)){var finishedDCGet=function(){!cObj._designing&&(cObj._properties.requiresContext&&_.isEmpty(cObj._dataContext)||cObj._properties.ifValue&&!cObj._evalIf(cObj._properties.ifValue))&&cObj.properties({__hidden:!0});var comp=$.makeArray(cObj._properties.htmlClass).join(" ");cObj.$contents.removeClass(comp),cObj.$contents.addClass(cObj._stringSubstitute(comp));var custComp=$.makeArray(cObj._properties.customClass).join(" ");cObj.$dom.removeClass(custComp),cObj.$dom.addClass(cObj._stringSubstitute(custComp)),cObj.$dom.css(blist.configs.styles.convertProperties(cObj._stringSubstitute(cObj._properties))),_.each(cObj._stringSubstitute(cObj._properties.htmlAttributes),function(attr){_.include(["class","id","style"],attr.key)||cObj.$dom.attr(attr.key,attr.value)})};cObj._updateDataSource(cObj._properties,finishedDCGet)||finishedDCGet()}return delete this._needsRender,this._rendered=!0,this._isDirty=!1,$.component.sizeRenderRefresh(),this._updateValidity(),!0},_arrange:function(){this._isDirty=!0},_updateValidity:function(){if(!$.isBlank(this.$dom)){var isDisabled=!this._loading&&!this.isValid();isDisabled&&!this._disInit&&(this.$dom.append($.tag([{tagName:"div",class:"disabledOverlay"},{tagName:"span",class:"disabledIcon"},{tagName:"div",class:["disabledMessage","badConfig"],contents:$.t("dataslate.component.invalid_config")},{tagName:"div",class:["disabledMessage","notReady"],contents:$.t("dataslate.component.loading")}])),this._disInit=!0),this.$dom.toggleClass("disabled",isDisabled),this.$dom.toggleClass("notRendered",!this._rendered)}},_shown:function(){this.trigger("shown")},_hidden:function(){this.trigger("hidden")},_move:function(parent,position){if(_.isNumber(position)&&(position=null),position&&position.parent!=parent)throw new Error("Illegal position -- new following sibling is not parented by new parent");if(position?position!=this&&position!=this.next:parent.last!=this){var oldParent=this.parent,oldPrev=this.prev,oldNext=this.next;oldParent==parent&&oldNext==position||(oldPrev&&(oldPrev.next=this.next),oldNext&&(oldNext.prev=this.prev),position?this.prev=position.prev:(this.prev=parent.last,delete this.next),this.prev&&(this.prev.next=this),this.next=position,position&&(position.prev=this),oldParent!=parent&&(this.parent=parent,oldParent&&oldParent._childRemoved(this,oldPrev,oldNext)),this.parent._childMoved(this,oldParent,oldPrev,oldNext))}},_propRead:function(){return $.extend({},this._properties,{type:this.typeName,id:this.id})},_propWrite:function(properties){var cObj=this;cObj._updateProperties(properties),cObj._isDirty=!0,cObj.trigger("update_properties"),$.isBlank(cObj.$dom)||(cObj.$dom.removeClass("serverRendered"),!cObj._isHidden&&cObj.$dom.hasClass("hide")?(cObj.$dom.removeClass("hide"),cObj._shown(),cObj._needsRender&&cObj._render()):cObj._isHidden&&!cObj.$dom.hasClass("hide")&&(cObj.$dom.addClass("hide"),cObj._hidden()),cObj._applyHeightProperties()),_.defer(function(){cObj._updateValidity()})},_updateProperties:function(properties){this._properties=this._properties||{},this._privateProperties=this._privateProperties||{};var privProps={};_.each(_.keys(properties||{}),function(k){k.startsWith("__")&&(privProps[k.slice(2)]=properties[k],delete properties[k])}),$.extend(!0,this._properties,properties),$.extend(!0,this._privateProperties,privProps),this._isHidden=(!this._visibility||this._properties.hidden||this._privateProperties.hidden)&&!this._designing&&!this._editing},_propertyResolver:function(){var cObj=this,parentResolver=this.parent?this.parent._propertyResolver():$.component.rootPropertyResolver,keyedDC={};_.each($.makeArray(cObj._dataContext),function(d){keyedDC[d.id]=d});var dcResolver=function(name){var result=$.deepGetStringField(keyedDC,name);return _.isFunction(result)&&(result=result.call(keyedDC[_.first(name.split(".",1))].dataset)),void 0!==result?result:(_.any($.makeArray(cObj._dataContext),function(dc){return result=$.deepGetStringField(dc,name),_.isFunction(result)&&(result=result.call(dc.dataset)),void 0!==result}),result)},entity=cObj._properties.entity;return entity?function(name){var result;return _.isEmpty(cObj._dataContext)||(result=dcResolver(name)),void 0!==result?result:void 0!==(result=$.deepGetStringField(entity,name))?result:parentResolver(name)}:_.isEmpty(cObj._dataContext)?parentResolver:function(name){var result=dcResolver(name);return void 0!==result?result:parentResolver(name)}},_substitutionHelpers:function(){return $.extend(!0,$.isBlank(this.parent)?{}:this.parent._substitutionHelpers(),this._properties.substitutionHelpers)},_getDatasetListFromContext:function(context){var datasets=[];return _.each($.makeArray(context),function(dc){switch(dc.type){case"dataset":datasets.push(dc.dataset);break;case"datasetList":datasets=datasets.concat(_.pluck(dc.datasetList,"dataset"))}}),datasets},_updateDataSource:function(properties,callback){for(var cObj=this,gotDCGen=function(count){var finishCallback=_.after(count,function(){cObj.finishLoading(),cObj._isActiveEdit&&$.cf.side.enableProperties(!0),_.isFunction(callback)&&callback.apply(cObj)});return 0===count&&finishCallback(),cObj._clearDataContext(),{success:function(dc){cObj._addDataContext(dc),finishCallback()},error:function(dcId){cObj._nullDataContexts=cObj._nullDataContexts||[],cObj._nullDataContexts.push(dcId),finishCallback()}}},startDCGet=function(){cObj.startLoading()},cxt=(properties=_.isEmpty(properties)?cObj._properties:properties).context,cIds=properties.contextId,curItem=cObj.parent;$.isBlank(cIds)&&$.isBlank(cxt)&&!$.isBlank(curItem);){var props=curItem.properties();cxt=props.context,cIds=props.childContextId||props.contextId,curItem=curItem.parent}cIds=cObj._stringSubstitute($.makeArray(cIds));var existIds=_.compact(_.pluck($.makeArray(cObj._dataContext),"id").concat(cObj._nullDataContexts)),hasNewInheritedId=!($.isBlank(cxt)&&_.isEmpty(cIds)||_.isEqual(cIds.sort(),existIds.sort()));if(!$.isBlank(cxt)&&_.isEmpty(cIds)||hasNewInheritedId){if(cObj.unbind("update_properties",null,cObj),_.isEmpty(cIds)){if(!$.isBlank(cxt)){cObj._inlineContextConfigs={};var isArr=_.isArray(cxt);cxt=$.makeArray(cxt),_.each(cObj._stringSubstitute(cxt),function(c,i){var id=c.id;if($.isBlank(id)){if(id="context-"+cObj.id+(isArr?"-"+i:""),c.id=id,!$.isBlank(properties.context))(!cObj._nullDataContexts||!_.include(cObj._nullDataContexts,id))&&(_.isArray(properties.contextId)||(properties.contextId=[]),properties.contextId.push(id));cxt[i].id=id}startDCGet();var finishedDC=gotDCGen(1);$.dataContext.loadContext(id,c,finishedDC.success,function(){finishedDC.error(id)}),cObj._inlineContextConfigs[c.id]=c}),_.isArray(properties.contextId)&&1==properties.contextId.length&&(properties.contextId=_.first(properties.contextId)),cObj.bind("update_properties",function(){_.each(cObj._stringSubstitute(cxt),function(c){_.isEqual(c,cObj._inlineContextConfigs[c.id])||($.dataContext.updateContext(c),cObj._inlineContextConfigs[c.id]=c)})},cObj)}}else{var finishDC=gotDCGen(cIds.length);_.map(cIds,function(cId){if(!$.dataContext.getContext(cId,finishDC.success,function(){finishDC.error(cId)}))if((cObj._properties.entity||{}).hasOwnProperty(cId)){var eDC={id:cObj.id+"-"+cId,type:"entity",value:cObj._properties.entity[cId]};_.defer(function(){finishDC.success(eDC)})}else{var p=cObj.parent;if($.isBlank(p))_.defer(function(){finishDC.error(cId)});else{var findContextItem=function(){var item=$.deepGetStringField(p._dataContext||{},cId);if($.isBlank(item))_.defer(function(){finishDC.error(cId)});else{var dDC={id:cObj.id+"-"+cId,type:"entity",value:item};_.defer(function(){finishDC.success(dDC)})}};p._updateDataSource(null,findContextItem)||findContextItem()}}}),startDCGet()}return!0}return $.isBlank(cxt)&&$.isBlank(cObj._properties.context)&&_.isEmpty(cIds)&&$.isBlank(cObj._properties.contextId)&&delete cObj._dataContext,!1},_clearDataContext:function(){delete this._dataContext,delete this._nullDataContexts,this._isDirty=!0,this._isActiveEdit&&$.cf.side.enableProperties(!1)},_addDataContext:function(dc){_.any($.makeArray(this._dataContext),function(curDC){return curDC.id==dc.id})||($.isBlank(this._dataContext)?this._dataContext=dc:(this._dataContext=$.makeArray(this._dataContext),this._dataContext.push(dc)),this._isDirty=!0)},listTemplateSubstitutions:function(list){_.each(_.values(this._properties),function(propertyValue){if("string"==typeof propertyValue)for(var matcher=/\{([^}]+)\}/g,match=matcher.exec(propertyValue);match;)list.push(match[1]),match=matcher.exec(propertyValue)})}});Component.extend=function(){var name,category,prop;1==arguments.length?prop=arguments[0]:2==arguments.length?(name=arguments[0],prop=arguments[1]):3==arguments.length&&(name=arguments[0],category=arguments[1],prop=arguments[2]);var result=Model.extend.call(this,prop);if(result.extend=Component.extend,name){var translatedName=result.prototype.catalogName;result.catalogName=result.prototype.catalogName=name,result.catalogCategory=result.prototype.catalogCategory=category,$.component.registerCatalogType(result),translatedName&&(result.catalogName=result.prototype.catalogName=translatedName)}return result},$.component=function(id,compSet){return"number"==typeof id&&(id="c"+id),!0===compSet?_.compact(_.map(componentSets,function(cs){return cs[id]})):componentSets[compSet||"__primary"][id]},$.comp=$.component;var winUpdateTimer,$win=$(window),$doc=$(document),prevWinPercent=0,disableWinUpdate=!1;$.extend($.component,{Component:Component,rootPropertyResolver:function(name){return"?"==name.charAt(0)?($.isBlank(queryParams)&&(queryParams=blist.configuration.pageVariables,$.isBlank(queryParams)&&(queryParams={},_.each(window.location.search.substring(1).split("&"),function(p){var s=p.split("=");queryParams[s[0]]=unescape(s[1])}))),queryParams[name.substring(1)]):name.startsWith("env.")?($.isBlank(envItems)&&(envItems=blist.configuration.env),envItems[name.substring(4)]):void 0},allocateId:function(){return"c"+nextAutoID++},sizeRenderRefresh:_.debounce(function(){getWinPercent()!=prevWinPercent&&$win.scrollTop(prevWinPercent*$doc.height()),disableWinUpdate=!0,$.waypoints("refresh"),$.isBlank(winUpdateTimer)||clearTimeout(winUpdateTimer),winUpdateTimer=setTimeout(function(){disableWinUpdate=!1,winUpdateTimer=null},500)},200),isLoading:function(){return wsCounter>0}});var catalog={};$.extend($.component,{globalNotifier:new(Model.extend({_init:function(){this._super.apply(this,arguments),this.registerEvent(["component_added","component_removed"])}})),registerCatalogType:function(type){if($.component[type.typeName=type.prototype.typeName=type.catalogName.camelize()]=type,type.catalogCategory){var category=catalog[type.catalogCategory];category||(category=catalog[type.catalogCategory]={id:type.catalogCategory,name:type.catalogCategory.camelize(),entries:[]}),category.entries.push(type)}},create:function(properties,compSet){if(void 0==properties)throw new Error("Component create without input properties");if(properties instanceof $.component.Component)return properties;if("string"==typeof properties){var type=properties;properties={}}else type=properties.type;if(void 0==type)throw new Error("Component create without type property");var ComponentClass=$.component[properties.type.camelize()];if(!ComponentClass)throw new Error("Invalid component type "+type);return new ComponentClass($.extend(!0,{},properties),compSet)},initialize:function(configRoot,componentSet){if(roots[componentSet=componentSet||"__primary"]=null,componentSets[componentSet]=componentSets[componentSet]||{},$.isPlainObject(configRoot)){$.subKeyDefined(configRoot,"bodyClass")&&$("body").addClass(configRoot.bodyClass);var component=this.create(configRoot,componentSet);if(component._render(),component._isRenderable()&&!component.dom.parentNode)throw new Error("Unparented root component "+component.id);roots[componentSet]=component}$(document).trigger("canvas_initialized")},root:function(componentSet){return!0===componentSet?roots:roots[componentSet||"__primary"]},catalog:catalog});var functionalComponents={};Component.extend("FunctionalComponent",{_init:function(){this._super.apply(this,arguments),functionalComponents[this.id]=this;var cObj=this;_.defer(function(){cObj.properties(cObj._properties)})},destroy:function(){this._super.apply(this,arguments),delete functionalComponents[this.id]},startLoading:function(){},finishLoading:function(){},remove:function(){},_initDom:function(){},_render:function(){},_arrange:function(){},_move:function(){},_isRenderable:function(){return!1}}),$win.scroll(function(){disableWinUpdate||(prevWinPercent=getWinPercent())});var getWinPercent=function(){return $win.scrollTop()/$doc.height()}}(jQuery)},1658:function(module,exports,__webpack_require__){"use strict";!function($){$.stringSubstitute=function(obj,resolver,helpers){if($.isBlank(obj))return"";if(_.isString(obj))return resolveString(obj,resolver,helpers);if(_.isArray(obj))return _.map(obj,function(t){return $.stringSubstitute(t,resolver,helpers)});if($.isPlainObject(obj)){var o;if("array"==obj.substituteType){if(o=$.stringSubstitute(obj.value,resolver,helpers),obj.isJson)try{o=JSON.parse(o||"[]")}catch(e){}else o=(o||"").split(obj.split||",");obj.compact&&_.isArray(o)&&(o=_.compact(o))}else $.subKeyDefined(obj,blist.locale)?o=$.stringSubstitute($.localize(obj),resolver,helpers):(o={},_.each(obj,function(v,k){o[k]=$.stringSubstitute(v,resolver,helpers)}));return o}return obj};var resolveCache={},resolveString=function(string,resolver,helpers){if(void 0==string&&(string=""),$.subKeyDefined(resolveCache,string))return doResolve(resolveCache[string],resolver,helpers);for(var props=[],pieces=string.match(/({|}|[^{}]+)/gm)||[],i=0;i<pieces.length;i++){var p={};"{"==pieces[i]&&"}"==pieces[i+2]?(p.orig=pieces[i+1],p.prop=p.orig,$.extend(p,parseTransforms(p.prop)),i+=2):p.orig=pieces[i],props.push(p)}return resolveCache[string]=props,doResolve(props,resolver,helpers)},doResolve=function(props,resolver,helpers){var phrases=(helpers||{}).phrases||{};if(!_.isFunction(resolver)){var obj=resolver||{};resolver=function(name){return $.deepGetStringField(obj,name)}}for(var a=[],i=0;i<props.length;i++){var p=props[i];if($.isBlank(p.prop))a.push(p.orig);else{var temp,m=p.prop.match(/^#(\w+)$/);temp=!_.isEmpty(m)&&$.subKeyDefined(phrases,m[1])?resolveString($.localize(phrases[m[1]]),resolver,helpers):resolver(p.prop),$.isBlank(temp)&&(temp=""),$.isPlainObject(temp)&&(temp=_.map(temp,function(v,k){return k+": "+v})),_.isArray(temp)&&(temp=temp.join(", ")),temp=temp.indexOf&&-1!=temp.indexOf("{")?$.stringSubstitute(temp,resolver,helpers):temp;var transResult=processTransforms(temp,p.transforms,helpers);temp=transResult.value,$.isBlank(temp)&&!transResult.fallbackResult&&(temp="{"+p.orig+"}"),a.push(temp)}}return a.join("")},transformsCache={},parseTransforms=function(str){if($.subKeyDefined(transformsCache,str))return transformsCache[str];var m,p={prop:str,transforms:[]};m=p.prop.match(/(^|(.*)\s+)\|\|\s*(.*)$/),_.isEmpty(m)||(p.prop=m[2]||"",p.transforms.push({type:"fallback",fallback:m[3]}));var checkExpr=function(){for(;!_.isEmpty(m=p.prop.match(/(^|(.*)\s+)\!(\w+)$/));)p.prop=m[2]||"",p.transforms.push({type:"subExpr",key:m[3]})};for(checkExpr();!_.isEmpty(m=p.prop.match(/(^|(.*)\s+)\/(([^\s\/]*|(\\\/)*)*)\/(([^\/]|(\\\/)*)*)\/([gim]*)$/));)p.prop=m[2]||"",p.transforms.push({type:"regex",regex:m[3].replace(/\\\//,"/"),repl:m[6].replace(/\\\//,"/"),modifiers:m[9]});for(checkExpr();!_.isEmpty(m=p.prop.match(/(^|(.*)\s+)([%@$])\[([^\]]*)\]$/));){var t;switch(p.prop=m[2]||"",m[3]){case"%":t="numberFormat";break;case"@":t="dateFormat";break;case"$":t="stringFormat"}p.transforms.push({type:t,format:m[4]})}return checkExpr(),_.isEmpty(m=p.prop.match(/(^|(.*)\s+)=\[([^\]]*)\]$/))||(p.prop=m[2]||"",p.transforms.push({type:"mathExpr",expr:m[3]})),checkExpr(),transformsCache[str]=p,p},processTransforms=function(v,transforms,helpers){var r,fallbackResult=!1;return _.each(transforms.reverse(),function(pt){_.isFunction(applyExpr[pt.type])&&(r=applyExpr[pt.type](v,pt,helpers),$.isPlainObject(r)?(v=r.value,fallbackResult=fallbackResult||r.fallbackResult):v=r)}),{value:v,fallbackResult:fallbackResult}},applyExpr={regex:function(v,transf){var r=transf.regex;return transf.modifiers.indexOf("m")>-1&&(r=r.replace(/(^|[^\\])\./,"$1[\\s\\S]")),v.toString().replace(new RegExp(r,transf.modifiers),transf.repl)},numberFormat:function(v,transf){if(_.isNaN(parseFloat(v)))return v;v=parseFloat(v);var prec=transf.format.match(/\d+/);$.isBlank(prec)||(prec=parseInt(_.first(prec)));var didFmt=!1;return transf.format.indexOf("h")>-1?(v=blist.util.toHumaneNumber(v,$.isBlank(prec)?2:prec),didFmt=!0):transf.format.indexOf("e")>-1?(v=v.toExponential(prec),didFmt=!0):(!$.isBlank(prec)||transf.format.indexOf("f")>-1)&&(v=v.toFixed($.isBlank(prec)?2:prec),didFmt=!0),v=v.toString(),didFmt&&transf.format.indexOf("p")<0&&(v=v.replace(/((\.[1-9]+)|\.)0+($|\D)/,"$2$3")),transf.format.indexOf(",")>-1&&(v=v.replace(/\d+/,$.commaify)),v},dateFormat:function(v,transf){var d=parseDate(v);if($.isBlank(d)||_.isNaN(d.valueOf()))return v;var fmt=transf.format.replace("%z","O").replace("%s","U");return d.format(fmt)},stringFormat:function(v,transf){return $.isBlank(v)?v:(transf.format.indexOf("t")>-1&&(v=v.trim()),transf.format.indexOf("l")>-1&&(v=v.toLowerCase()),transf.format.indexOf("U")>-1?v=v.toUpperCase():transf.format.indexOf("u")>-1?v=_.map(v.split(" "),function(t){return t.capitalize()}).join(" "):transf.format.indexOf("c")>-1&&(v=v.capitalize()),transf.format.indexOf("?")>-1?v=encodeURIComponent(v):(transf.format.indexOf("!")>-1||transf.format.indexOf("")>-1)&&(v=decodeURIComponent(v)),v)},mathExpr:function(v,transf){var varOpts=["-?x","t","-?[0-9]*\\.?[0-9]*"],m=transf.expr.match("^("+varOpts.join("|")+")\\s*(["+["+","\\-","*","\\/","%"].join("")+"])\\s*("+varOpts.join("|")+")$");if($.isBlank(m)||$.isBlank(v))return v;var vl=computeValue(m[1],v),vr=computeValue(m[3],v);if(!_.isNumber(vl)||_.isNaN(vl)||!_.isNumber(vr)||_.isNan(vr))return v;switch(m[2]){case"+":return vl+vr;case"-":return vl-vr;case"*":return vl*vr;case"/":return vl/vr;case"%":return vl%vr}},subExpr:function(v,transf,helpers){return processTransforms(v,parseTransforms($.localize(((helpers||{}).expressions||{})[transf.key])).transforms,helpers)},fallback:function(v,transf){var isFallback=$.isBlank(v);return{value:isFallback?transf.fallback:v,fallbackResult:isFallback}}},computeValue=function(str,v){if("x"==str)return parseFloat(v);if("-x"==str)return-parseFloat(v);if("t"==str){var d=parseDate(v);return $.isBlank(d)?null:Math.floor(d.getTime()/1e3)}return parseFloat(str)},parseDate=function(v){return _.isNumber(v)?new Date(1e3*v):_.isString(v)?Date.parse(v):void 0}}(jQuery)},1659:function(module,exports){"use strict";!function($){window.DataContext=Model.extend({_init:function(v,parSet,initCallback){var dc=this;if(initCallback=initCallback||function(){},dc._super(),this.registerEvent(["data_change"]),$.extend(dc,v),dc._parentSet=parSet,$.isBlank(dc.type)&&!$.isBlank(dc.config)&&(dc.type=dc.config.type),$.isBlank(dc.dataset)||dc.dataset instanceof Dataset||(dc.dataset=createDatasetFromView(dc.dataset),dc.dataset.isAnonymous(!blist.configuration.privateData)),$.isBlank(dc.dataset)||(dc._hookTotals(),updateGroupedCols(dc.dataset,dc.config.query)),_.isEmpty(dc.datasetList)||(dc.datasetList=_.map(dc.datasetList,function(dl){var cDc=dl;return dl instanceof DataContext||(cDc=new DataContext({id:dl.id,config:{type:"dataset",datasetId:dl.dataset.id},dataset:dl.dataset},dc._parentSet))._registerContext(),cDc})),$.isBlank(dc.column))initCallback(dc);else if(dc.column instanceof Column)dc._hookColumnAggs(),initCallback(dc);else{var finishCol=function(){dc.column=dc.dataset.columnForIdentifier(dc.config.columnId),dc._hookColumnAggs(),initCallback(dc)};$.isBlank(this.dataset)?this._loadDataset(finishCol,function(){},$.isBlank(dc.config.query)):finishCol()}},updateConfig:function(newConf){var dc=this;if(!$.isBlank(dc.type)&&newConf.type!=dc.type)return!1;switch(dc.config=newConf,dc.type=dc.config.type,dc.type){case"dataset":addQuery(dc.dataset,dc.config.query);break;case"datasetList":delete dc.datasetList,dc.getItems(null,null,function(){dc.trigger("data_change")},function(){dc.trigger("data_change")});break;default:return!1}return!0},load:function(callback,errorCallback){var dc=this;switch(dc.type){case"row":dc._loadDataset(function(){dc._loadRow(function(){callback(dc)},errorCallback)},errorCallback);break;case"column":dc._loadDataset(function(){dc.column=dc.dataset.columnForIdentifier(dc.config.columnId);var finishCol=function(){callback(dc)};if($.isBlank(dc.column))errorCallback(dc.id);else if(dc._hookColumnAggs(),$.isBlank(dc.config.aggregate))finishCol();else{var aggs={};aggs[dc.column.id]=$.makeArray(dc.config.aggregate),dc.dataset.getAggregates(finishCol,aggs)}},errorCallback,$.isBlank(dc.config.query));break;case"dataset":dc._loadDataset(function(){callback(dc)},errorCallback);break;case"datasetList":delete dc.datasetList,dc.getItems(null,null,function(){callback(dc)},errorCallback);break;case"goalDashboard":if(!$.subKeyDefined(blist,"require")){blist.util.assetLoading.loadAssets({javascripts:["/asset/js/socket.io","/asset/js/client-bridge"]},function(){dc.load(callback,errorCallback)});break}var dr=new(blist.require("govstat").models.dashboard.request.Fetch)({dashboardId:dc.config.dashboardId}),janusApp=blist.require("app");janusApp.getStore(dr).handle();var dv=dr.map(function(state){return $.isBlank(state)?null:state.successOrElse(null)});if($.subKeyDefined(dv,"extract")){dv.extract(function(d){dc.dashboard=d,callback(dc)},{app:janusApp});break}errorCallback(dc.id);break;case"goalList":if(!$.subKeyDefined(blist,"govstat.collections.Goals")){errorCallback(dc.id);break}var gl=new blist.govstat.collections.Goals;gl.fetch({data:$.param(dc.config.search||{}),success:function(){gl.length<1?errorCallback(dc.id):(dc.count=gl.length,dc.goalList=_.map(gl.models,function(goal){var gDc=new DataContext({id:dc.id+"_"+goal.id,config:{type:"goal",goalId:goal.id},goal:goal.toJSON()},dc._parentSet);return gDc._registerContext(),gDc}),callback(dc))},error:function(){errorCallback(dc.id)}});break;case"goal":dc._loadOldGoal(function(){callback(dc)},errorCallback);break;case"goal2":dc._loadGoal(function(){callback(dc)},errorCallback);break;case"govstatCategoryList":if(!$.subKeyDefined(blist,"govstat.collections.Categories")){errorCallback(dc.id);break}var catList=new blist.govstat.collections.Categories;catList.fetch({success:function(){catList.length<1?errorCallback(dc.id):(dc.count=catList.length,dc.categoryList=_.map(catList.models,function(cat){var cDc=new DataContext({id:dc.id+"_"+cat.id,config:{type:"govstatCategory",categoryId:cat.id},category:cat.toJSON()},dc._parentSet);return cDc._registerContext(),cDc}),callback(dc))},error:function(){errorCallback(dc.id)}});break;case"list":var l=dc.config.list;_.isString(l)&&(l=$.stringSubstitute("{"+l+" ||}",$.component.rootPropertyResolver).split(", ")),dc.count=l.length,dc.list=l,callback(dc);break;default:alert("Unrecognized data context type: "+dc.type+" for "+dc.id)}},getItems:function(start,count,callback,errorCallback){var dc=this;if("datasetList"==dc.type){dc.datasetList=dc.datasetList||[];var baseLimit=(dc.config.search||{}).limit||50,baseOffset=(((dc.config.search||{}).page||1)-1)*baseLimit;$.isBlank(start)&&(start=baseOffset),count=count||baseLimit;for(var curBatch,batches=[],i=start;i<start+count;i++)$.isBlank(dc.datasetList[i])?($.isBlank(curBatch)&&(curBatch={start:i,count:0},batches.push(curBatch)),curBatch.count++):curBatch=null;var gotResults=_.after(batches.length,function(){callback(dc.datasetList.slice(start,start+count))});0===batches.length&&gotResults(),_.each(batches,function(batch){var localCallback=gotResults,conf=$.extend(!0,{},dc.config.search),serverStart=batch.start+baseOffset;if(serverStart%batch.count==0)conf.limit=batch.count,conf.page=serverStart/batch.count+1;else{if(batch.count%serverStart!=0){if(serverStart<batch.count)return localCallback=_.after(2,gotResults),dc.getItems(serverStart-baseOffset,serverStart,localCallback,errorCallback),void dc.getItems(2*serverStart-baseOffset,batch.count-serverStart,localCallback,errorCallback);for(var adjCount=batch.count-1;serverStart%adjCount!=0;)adjCount--;return localCallback=_.after(2,gotResults),dc.getItems(serverStart-baseOffset,adjCount,localCallback,errorCallback),void dc.getItems(serverStart+adjCount-baseOffset,batch.count-adjCount,localCallback,errorCallback)}conf.limit=serverStart,conf.page=2,localCallback=_.after(2,gotResults),dc.getItems(2*serverStart-baseOffset,batch.count-batch.start,localCallback,errorCallback)}Dataset.search(conf,function(results){_.each(results.views,function(ds){addQuery(ds,dc.config.query)});var setResult=function(viewsList,resultCount){if(resultCount<1&&!dc.config.noFail)errorCallback(dc.id);else{var offset=(conf.page-1)*conf.limit-baseOffset;dc.count=resultCount,_.each(viewsList,function(ds,index){var dsDc,childId=dc.id+"_"+ds.id;$.subKeyDefined(dc,"_parentSet")&&(dsDc=dc._parentSet.availableContexts[childId]),$.isBlank(dsDc)&&(dsDc=new DataContext({id:dc.id+"_"+ds.id,config:{type:"dataset",datasetId:ds.id},dataset:ds},dc._parentSet))._registerContext(),dc.datasetList[offset+index]=dsDc}),localCallback()}};if(dc.config.requireData&&results.count>0){var trCallback=_.after(results.views.length,function(){var vl=_.reject(results.views,function(ds){return ds.totalRows()<1}),c=results.count-(results.views.length-vl.length);setResult(vl,c)});0===results.views.length&&trCallback(),_.each(results.views,function(ds){ds.getTotalRows(trCallback)})}else setResult(results.views,results.count)},function(){errorCallback(dc.id)},!blist.configuration.privateData)})}},_registerContext:function(){$.subKeyDefined(this,"_parentSet")&&this._parentSet.addContext(this)},_loadDataset:function(callback,errorCallback,keepOriginal){var dc=this;$.isBlank(dc.config.keepOriginal)||(keepOriginal=dc.config.keepOriginal),dc.config.useParentPrefetch&&(keepOriginal=!0);var gotDS=function(ds){dc.dataset=ds,keepOriginal||addQuery(dc.dataset,dc.config.query),dc.config.getTotal?dc.dataset.getTotalRows(function(){dc._hookTotals(),callback()},function(){errorCallback(dc.id)}):callback()};if($.subKeyDefined(dc.config,"contextId")){if($.isBlank(dc._parentSet)||!dc._parentSet.getContext(dc.config.contextId,function(context){"dataset"==context.type?gotDS(keepOriginal?context.dataset:context.dataset.clone()):errorCallback(dc.id)},errorCallback))if($.subKeyDefined(dc,"._parentSet._preLoadQueue."+dc.config.contextId)){var args=arguments;dc._parentSet._preLoadQueue[dc.config.contextId].push({success:function(){dc._loadDataset.apply(dc,args)},error:errorCallback})}else errorCallback(dc.id)}else $.subKeyDefined(dc.config,"datasetId")?Dataset.createFromViewId(dc.config.datasetId,function(dataset){gotDS(dataset)},function(){errorCallback(dc.id)},!1,!blist.configuration.privateData):$.subKeyDefined(dc.config,"datasetResourceName")?Dataset.lookupFromResourceName(dc.config.datasetResourceName,function(dataset){gotDS(dataset)},function(){errorCallback(dc.id)},!1,!blist.configuration.privateData):$.subKeyDefined(dc.config,"search")&&Dataset.search($.extend({},dc.config.search,{limit:1}),function(results){results.count<1?errorCallback(dc.id):gotDS(_.first(results.views))},function(){errorCallback(dc.id)},!blist.configuration.privateData)},_hookTotals:function(){var dc=this;!$.isBlank(dc.dataset)&&dc.config.getTotal&&dc.dataset.bind("row_count_change",function(){_.defer(function(){$.isBlank(dc.dataset.totalRows())&&dc.dataset.getTotalRows()})})},_loadRow:function(callback,errorCallback){var dc=this;if($.isBlank(dc.dataset))errorCallback(dc.id);else{var rowResult=function(r){if(r=_.first(r),$.isBlank(r))return errorCallback(dc.id),!1;dc.row=dc.dataset.rowToSODA2(r),callback()};!function doLoad(){$.isBlank(dc.config.rowId)?dc.dataset.getRows(0,1,rowResult,function(e){e.cancelled&&doLoad()}):dc.dataset.getRowsByIds($.makeArray(dc.config.rowId),rowResult,function(e){e.cancelled&&doLoad()})}()}},_hookColumnAggs:function(){var dc=this;$.isBlank(dc.config.aggregate)||dc.column.view.bind("column_totals_changed",function(){_.defer(function(){var aggs={};aggs[dc.column.id]=$.makeArray(dc.config.aggregate),dc.column.view.getAggregates(null,aggs)})})},_loadGoal:function(callback,errorCallback){var dc=this;if($.subKeyDefined(blist,"require")){var gr=new(blist.require("govstat").models.goal.request.Fetch)({goalId:dc.config.goalId}),janusApp=blist.require("app");janusApp.getStore(gr).handle();var gv=gr.map(function(state){return $.isBlank(state)?null:state.successOrElse(function(result){$.subKeyDefined(result,"error")&&errorCallback(dc.id)})});$.subKeyDefined(gv,"extract")?gv.extract(function(g){dc.goal=g,callback(dc)},{app:janusApp}):errorCallback(dc.id)}else blist.util.assetLoading.loadAssets({javascripts:["/asset/js/socket.io","/asset/js/client-bridge"]},function(){dc.load(callback,errorCallback)})},_loadOldGoal:function(callback,errorCallback){var dc=this;if($.subKeyDefined(blist,"govstat.models.Goal")){var goal=new blist.govstat.models.Goal({id:dc.config.goalId});goal.fetch({success:function(){dc.goal=goal.toJSON(),callback(dc)},error:function(){errorCallback(dc.id)}})}else errorCallback(dc.id)}}),DataContext.loadFromConfig=function(id,config,parSet){return new DataContext({id:id,config:config},parSet)},$.dataContext=new(Model.extend({availableContexts:{},_contextsQueue:{},_preLoadQueue:{},_existingContexts:{},_init:function(){this._super(),this.registerEvent(["available","unavailable","error"])},addContext:function(context){this.availableContexts[context.id]=context},load:function(configHash,existingContexts,extraConfig){var dc=this;_.isObject(existingContexts)&&$.extend(dc._existingContexts,existingContexts),_.each(configHash,function(c,id){dc._preLoadQueue[id]=dc._preLoadQueue[id]||[]}),_.each(configHash,function(c,id){$.subKeyDefined(extraConfig,id)&&$.extend(c,extraConfig[id]),dc.loadContext(id,c)})},loadContext:function(id,config,successCallback,errorCallback){var dc=this;if($.isBlank(dc.availableContexts[id]))if($.isBlank(dc._contextsQueue[id])){var doneLoading=function(newContext){dc.addContext(newContext),_.each(dc._contextsQueue[newContext.id],function(f){_.isFunction(f.success)&&f.success(dc.availableContexts[newContext.id])}),delete dc._contextsQueue[newContext.id],_.isFunction(successCallback)&&successCallback(dc.availableContexts[newContext.id]),$.dataContext.trigger("available",[newContext])};dc._contextsQueue[id]=dc._preLoadQueue[id]||[],delete dc._preLoadQueue[id],config=$.stringSubstitute(config,$.component.rootPropertyResolver),dc._existingContexts.hasOwnProperty(id)&&dc._existingContexts[id].type==config.type?new DataContext($.extend({id:id,config:config},dc._existingContexts[id]),dc,doneLoading):DataContext.loadFromConfig(id,config,dc).load(doneLoading,function(contextId){_.each(dc._contextsQueue[contextId],function(f){_.isFunction(f.error)&&f.error()}),delete dc._contextsQueue[contextId],_.isFunction(errorCallback)&&errorCallback(),$.dataContext.trigger("error",[contextId])})}else dc._contextsQueue[id].push({success:successCallback,error:errorCallback});else _.isFunction(successCallback)&&successCallback(dc.availableContexts[id])},getContext:function(id,successCallback,errorCallback){var dc=this;return $.isBlank(dc.availableContexts[id])?!$.isBlank(dc._contextsQueue[id])&&(dc._contextsQueue[id].push({success:successCallback,error:errorCallback}),!0):(_.isFunction(successCallback)&&_.defer(function(){successCallback(dc.availableContexts[id])}),!0)},updateContext:function(config,successCallback,errorCallback){return $.dataContext.getContext(config.id,function(dc){config=$.stringSubstitute(config,$.component.rootPropertyResolver),dc.updateConfig(config)?_.isFunction(successCallback)&&successCallback(dc):_.isFunction(errorCallback)&&errorCallback()},errorCallback)},currentContexts:function(){var res={};return _.each(this.availableContexts,function(dc,id){res[id]=dc.config}),res}}));var addQuery=function(ds,query){if(!$.isBlank(query)){query=$.extend(!0,{},query);var q=$.extend(!0,{orderBys:[],groupBys:[]},ds.query);_.each(query,function(v,k){_.include(["orderBys","groupBys","groupedColumns","searchString"],k)||(q[k]=$.extend(!0,_.isArray(v)?[]:{},q[k],v))}),$.isBlank(query.orderBys)||_.each(query.orderBys,function(ob){if($.subKeyDefined(ob,"expression.fieldName")){var c=ds.columnForFieldName(ob.expression.fieldName);if($.isBlank(c))return!1;ob.expression.columnId=c.id,delete ob.expression.fieldName}q.orderBys.push(ob)}),_.isEmpty(q.orderBys)&&delete q.orderBys,$.isBlank(query.groupBys)||_.each(query.groupBys,function(gb){if($.subKeyDefined(gb,"fieldName")){var c=ds.columnForFieldName(gb.fieldName);if($.isBlank(c))return!1;gb.columnId=c.id,delete gb.fieldName}q.groupBys.push(gb)}),_.isEmpty(q.groupBys)&&delete q.groupBys;var props={query:q};$.isBlank(query.searchString)||(props.searchString=query.searchString),ds.update(props),updateGroupedCols(ds,query)}},updateGroupedCols=function(ds,query){if(!($.isBlank(ds.query.groupBys)||$.isBlank(query)||_.isEmpty(query.groupedColumns))){var cols=[];_.each(ds.query.groupBys,function(g){cols.push((ds.columnForIdentifier(g.columnId)||{}).id)}),_.each(query.groupedColumns,function(gc){var c=ds.columnForIdentifier(gc.columnId);if(!$.isBlank(c)){var fmt=$.extend({},c.format);fmt.grouping_aggregate=gc.aggregate,c.update({format:fmt}),cols.push(c.id)}}),ds.setVisibleColumns(_.compact(cols),null,!0)}}}(jQuery)},1660:function(module,exports){"use strict";var $,styleConfigNS,dimensionOptions,styleOptions,styleGroups;$=jQuery,styleConfigNS=blist.namespace.fetch("blist.configs.styles"),dimensionOptions=[{text:"ems",value:"em"},{text:"points",value:"pt"},{text:"pixels",value:"px"},{text:"inches",value:"in"}],styleOptions={color:{field:{text:"Font Color",name:"styles.color",type:"color",advanced:!0,showLabel:!0}},"font-family":{field:{text:"Font Family",name:"styles.font-family",prompt:null,type:"select",options:[{text:"Arial",value:"helvetica,arial,sans-serif"},{text:"Palatino",value:"'palatino linotype',palatino,'book antiqua',serif"},{text:"Times",value:"times,'times new roman',serif"},{text:"Verdana",value:"verdana,sans-serif"},{text:"Georgia",value:"georgia,serif"},{text:"Trebuchet",value:"'trebuchet ms',sans-serif"}]}},"font-size":{specialType:"dimensions",text:"Font Size"},"font-style":{field:{text:"Italics",name:"styles.font-style",type:"checkbox",trueValue:"italic",falseValue:"normal"}},"font-weight":{field:{text:"Bold",name:"styles.font-weight",type:"checkbox",trueValue:"bold",falseValue:"normal"},convertFrom:function(v){return"700"==v?"bold":"400"==v?"normal":v}},"padding-bottom":{specialType:"dimensions",text:"Bottom"},"padding-left":{specialType:"dimensions",text:"Left"},"padding-right":{specialType:"dimensions",text:"Right"},"padding-top":{specialType:"dimensions",text:"Top"},"text-align":{field:{text:"Alignment",name:"styles.text-align",type:"select",prompt:null,options:[{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]}},"text-decoration":{field:{text:"Underline",name:"styles.text-decoration",type:"checkbox",trueValue:"underline",falseValue:"none"}}},styleGroups={padding:{title:"Padding",options:["padding-top","padding-bottom","padding-left","padding-right"]},text:{title:"Text Styles",options:["font-size","font-family","color","text-align","font-weight","font-style","text-decoration"]}},styleConfigNS.getStyles=function(group,$elem){var g=styleGroups[group];if(_.isEmpty(g))return null;var sect={title:g.title,fields:[]};return _.each(g.options,function(k){var styleDef,name,defaults,s=styleOptions[k],def=function($elem,propertyName,type,convert){if($.isBlank($elem))return null;var def=$elem.css(propertyName);if("color"==type&&(def="#"+$.rgbToHex($.colorToObj(def))),"dimensions"==type){var value,unit,m=($elem.attr("style")||"").match(new RegExp(propertyName+":\\s*(-?[0-9.]+)\\s*(em|px|pt|in);"));_.isArray(m)?(value=m[1],unit=m[2]):(value=def.slice(0,-2),"px"==(unit=def.slice(-2))&&(value/=10,unit="em")),def={value:value,unit:unit}}return _.isFunction(convert)&&(def=convert(def)),def}($elem,k,s.specialType||s.field.type,s.convertFrom),field=(name=k,defaults=def,"dimensions"==(styleDef=s).specialType?{type:"group",text:styleDef.text,includeLabel:!0,lineClass:"dimensions",options:[{type:"text",name:"styleDimensions."+name+".value",inputOnly:!0,defaultValue:(defaults||{}).value},{type:"select",name:"styleDimensions."+name+".unit",inputOnly:!0,prompt:null,options:dimensionOptions,defaultValue:(defaults||{}).unit}]}:$.extend(!0,{},styleDef.field,{defaultValue:defaults}));sect.fields.push(field)}),sect},styleConfigNS.convertProperties=function(props){var styles=props.styles||{};return _.each(props.styleDimensions,function(v,k){$.isBlank(v.value)||$.isBlank(v.unit)||(styles[k]=v.value+v.unit)}),styles}},1661:function(module,exports,__webpack_require__){__webpack_require__(268),__webpack_require__(513),__webpack_require__(267),__webpack_require__(1660),__webpack_require__(1659),__webpack_require__(1658),__webpack_require__(1657),__webpack_require__(1656),__webpack_require__(1655),__webpack_require__(1654),__webpack_require__(1653),__webpack_require__(1652),__webpack_require__(1651),__webpack_require__(1650),__webpack_require__(1649),__webpack_require__(1648),__webpack_require__(1647),__webpack_require__(1646),__webpack_require__(1645),__webpack_require__(1644),__webpack_require__(1643),__webpack_require__(1642),__webpack_require__(1641),__webpack_require__(1640),__webpack_require__(1639),__webpack_require__(1638),__webpack_require__(1637),__webpack_require__(1636),__webpack_require__(1635),__webpack_require__(1634),__webpack_require__(1633),__webpack_require__(1632),__webpack_require__(1631),__webpack_require__(1630),__webpack_require__(1629),__webpack_require__(1628),__webpack_require__(1627),__webpack_require__(1626),__webpack_require__(1625),__webpack_require__(1624),__webpack_require__(1623),__webpack_require__(1622),__webpack_require__(1621),module.exports=__webpack_require__(1620)},6:function(module,exports){module.exports=jQuery}});
//# sourceMappingURL=canvas.js.map